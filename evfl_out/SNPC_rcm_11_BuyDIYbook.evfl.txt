flow RcmDIYbookBought:
    run Event7
    return

flow RcmDIYbookBuySel:
    MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:104', false)
    fEvent65 = EventFlowSystemActor.GeneralTalkChoice3()
    if fEvent65 == 0:
        run SNPC_rcm_00_Common::Rcm_Common_BuyCheckUI
        event_flags_system['cPlayerTemp:RcmBoughtGrocery'] = true
        EventFlowSystemActor.UIShopBuyDisappear()
        if EventFlowSystemActor.NetIsConnected():
            Player.PlayerChangeStateDemoTalk()
            Player.TurnBody(0, 0.0)
            Player.PlayerWaitTurn()
            MainNpc.SmartPhone(0)
            MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:107_01', true)
            EventFlowSystemActor.WaitFrame(15)
            Player.SmartPhone(0)
            fork:
                branch0:
                branch1:
                    Player.SmartPhone(4)
                branch2:
                    MainNpc.CharacterEmoticonAction('Smiling', '', 30, true, false)
            EventFlowSystemActor.WaitFrame(20)
            MainNpc.CharacterEmoticonAction('EmotEnd', '', 30, true, false)
            MainNpc.SmartPhone(4)
            EventFlowSystemActor.WaitFrame(30)
            MainNpc.SmartPhoneSE('Phone_Sending', 2)
            EventFlowSystemActor.WaitFrame(30)
            Player.SmartPhoneSE('Phone_Recieving', 2)
            EventFlowSystemActor.WaitFrame(15)
            MainNpc.SmartPhone(5)
            Player.SmartPhone(5)
        else:
            fEvent14 = EventFlowSystemActor.ShopLevel()
            if fEvent14 == InResServiceTent:
                Player.PlayerChangeStateDemoTalk()
                Player.TurnBody(0, 0.0)
                Player.PlayerWaitTurn()
                MainNpc.SmartPhone(0)
                MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:107_01', true)
                EventFlowSystemActor.WaitFrame(15)
                Player.SmartPhone(0)
                fork:
                    branch0:
                    branch1:
                        Player.SmartPhone(4)
                    branch2:
                        MainNpc.CharacterEmoticonAction('Smiling', '', 30, true, false)
                EventFlowSystemActor.WaitFrame(20)
                MainNpc.CharacterEmoticonAction('EmotEnd', '', 30, true, false)
                MainNpc.SmartPhone(4)
                EventFlowSystemActor.WaitFrame(30)
                MainNpc.SmartPhoneSE('Phone_Sending', 2)
                EventFlowSystemActor.WaitFrame(30)
                Player.SmartPhoneSE('Phone_Recieving', 2)
                EventFlowSystemActor.WaitFrame(15)
                MainNpc.SmartPhone(5)
                Player.SmartPhone(5)
            elif fEvent14 in (NooksCrannyInitial, NooksCrannyUpgraded):
                MainNpc.NpcMoveToPlayer()
                Player.PlayerChangeStateDemoTalk()
                Player.TurnBody(0, 0.0)
                Player.PlayerWaitTurn()
                MainNpc.SmartPhone(0)
                MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:107_01', true)
                EventFlowSystemActor.WaitFrame(15)
                Player.SmartPhone(0)
                fork:
                    branch0:
                    branch1:
                        Player.SmartPhone(4)
                    branch2:
                        MainNpc.CharacterEmoticonAction('Smiling', '', 30, true, false)
                EventFlowSystemActor.WaitFrame(20)
                MainNpc.CharacterEmoticonAction('EmotEnd', '', 30, true, false)
                MainNpc.SmartPhone(4)
                EventFlowSystemActor.WaitFrame(30)
                MainNpc.SmartPhoneSE('Phone_Sending', 2)
                EventFlowSystemActor.WaitFrame(30)
                Player.SmartPhoneSE('Phone_Recieving', 2)
                EventFlowSystemActor.WaitFrame(15)
                MainNpc.SmartPhone(5)
                Player.SmartPhone(5)
    elif fEvent65 == 1:
        if any (5603, 65534, 65534, 65534, 65534, 65534, 65534, 65534) in EventFlowSystemActor.ItemSelect('cItemSelect'):
            MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:106_01_01', false)
        else:
            if any (5604, 65534, 65534, 65534, 65534, 65534, 65534, 65534) in EventFlowSystemActor.ItemSelect('cItemSelect'):
                MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:106_01_02', false)
            else:
                MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:106_01_03', false)
        MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:106_02', false)
        run RcmDIYbookBuySel
    elif fEvent65 == 2:
        run SNPC_rcm_00_Common::Rcm_Groceries_Buy_Cancel
    return

flow Rcm_Cmn_DisableDIY:
    if EventFlowSystemActor.IsMyVillage():
        MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:104_01_01', false)
        fEvent24 = EventFlowSystemActor.ShopLevel()
        if fEvent24 == InResServiceTent:
            MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:104_01_02', false)
        elif fEvent24 in (NooksCrannyInitial, NooksCrannyUpgraded):
            MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:104_01_03', false)
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:108', false)
    return

flow Root:
    MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:105_01', false)
    if not event_flags_system['cPlayer:MainmenuRecipe']:
        run Rcm_Cmn_DisableDIY
        run SNPC_rcm_00_Common::BuyCancelNoAsk
    elif any (5603, 65534, 65534, 65534, 65534, 65534, 65534, 65534) in EventFlowSystemActor.ItemSelect('cItemSelect'):
        if EventFlowSystemActor.PlayerHasCraftRecipe(65534, 'DIYbook1'):
entrypoint Event7:
            MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:104_02', false)
            run SNPC_rcm_00_Common::BuyCancelNoAsk
        else:
            run RcmDIYbookBuySel
            EventFlowSystemActor.PlayerSetCraftRecipe(65534, 'DIYbook1')
            MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:107_02', false)
            fork:
                branch0:
                branch1:
                    MainNpc.SmartPhone(1)
                branch2:
                    EventFlowSystemActor.WaitFrame(15)
                    Player.SmartPhone(1)
            event_flags_system['cPlayerTemp:RcmBoughtGrocery'] = true
            MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:092', false)
            fEvent56 = EventFlowSystemActor.ShopLevel()
            if fEvent56 == InResServiceTent:
                run SNPC_rcm_00_Common::Rcm_Common_BuyAgain2
            elif fEvent56 in (NooksCrannyInitial, NooksCrannyUpgraded):
                Player.TurnBody(13, 0.0)
                Player.PlayerWaitTurn()
                run SNPC_rcm_00_Common::Rcm_Common_BuyAgain2
    elif any (5604, 65534, 65534, 65534, 65534, 65534, 65534, 65534) in EventFlowSystemActor.ItemSelect('cItemSelect'):
        if EventFlowSystemActor.PlayerHasCraftRecipe(65534, 'DIYbook2'):
            run RcmDIYbookBought
        else:
            run RcmDIYbookBuySel
            EventFlowSystemActor.PlayerSetCraftRecipe(65534, 'DIYbook2')
            MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:107_02', false)
            fork:
                branch0:
                branch1:
                    MainNpc.SmartPhone(1)
                branch2:
                    EventFlowSystemActor.WaitFrame(15)
                    Player.SmartPhone(1)
            event_flags_system['cPlayerTemp:RcmBoughtGrocery'] = true
            MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:092', false)
            fEvent56 = EventFlowSystemActor.ShopLevel()
            if fEvent56 == InResServiceTent:
                run SNPC_rcm_00_Common::Rcm_Common_BuyAgain2
            elif fEvent56 in (NooksCrannyInitial, NooksCrannyUpgraded):
                Player.TurnBody(13, 0.0)
                Player.PlayerWaitTurn()
                run SNPC_rcm_00_Common::Rcm_Common_BuyAgain2
    elif EventFlowSystemActor.PlayerHasCraftRecipe(65534, 'DIYbook3'):
        run RcmDIYbookBought
    else:
        run RcmDIYbookBuySel
        EventFlowSystemActor.PlayerSetCraftRecipe(65534, 'DIYbook3')
        MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:107_02', false)
        fork:
            branch0:
            branch1:
                MainNpc.SmartPhone(1)
            branch2:
                EventFlowSystemActor.WaitFrame(15)
                Player.SmartPhone(1)
        event_flags_system['cPlayerTemp:RcmBoughtGrocery'] = true
        MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:092', false)
        fEvent56 = EventFlowSystemActor.ShopLevel()
        if fEvent56 == InResServiceTent:
            run SNPC_rcm_00_Common::Rcm_Common_BuyAgain2
        elif fEvent56 in (NooksCrannyInitial, NooksCrannyUpgraded):
            Player.TurnBody(13, 0.0)
            Player.PlayerWaitTurn()
            run SNPC_rcm_00_Common::Rcm_Common_BuyAgain2
    return


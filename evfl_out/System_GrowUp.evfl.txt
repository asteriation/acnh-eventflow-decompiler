flow AfterNet:
    run DateCheckWithSave
    EventFlowSystemActor.TimeLock('cLock')
    run CallGrowUpGameWeatherProcess
    EventFlowSystemActor.SaveGrowUp('cAfterNet')
    run CallGrowUpPatchProcess
    EventFlowSystemActor.TimeLock('cUnlock')
    EventFlowSystemActor.NetReceiveMail()
    run Save
    EventFlowSystemActor.SpecialDemoStart('cReturnMulti')
    EventFlowSystemActor.ReserveSystemFlowDemo('VisitEndMileGet', 'System_Network')
    EventFlowSystemActor.SystemRequestChangeStage('cFrontOfAirPort', 'cCircle', 'cCircle', 'cBlack', 1.0, 1.0)
    return

flow BCATProcess:
    EventFlowSystemActor.SetBcatProcess()
    EventFlowSystemActor.NetConnectInit('cConnectInet', true)
    if not EventFlowSystemActor.CheckErrorType(2):
        EventFlowSystemActor.NetReceiveBcat()
    return

flow CallGrowUpGameWeatherProcess:
    if EventFlowSystemActor.PassDaysSincePreviousGrowUp():
        run System_GrowUp_GameProcess::Root
        run System_GrowUp_WeatherControl::FirstLive
    elif EventFlowSystemActor.BackDaysSincePreviousGrowUp():
        run System_GrowUp_GameProcess::Root_RewindDay
    run System_GrowUp_WeatherControl::Always
    return

flow CallGrowUpPatchProcess:
    event_flags_system['cLand:GrowUpAfterPatch1_1'] = true
    event_flags_system['cLand:GrowUpAfterPatch1_2'] = true
    event_flags_system['cLand:GrowUpAfterPatch1_3'] = true
    return

flow Continue:
    run DateCheck
    EventFlowSystemActor.TimeLock('cLock')
    run CallGrowUpGameWeatherProcess
    run ContinueCommon
    return

flow ContinueCommon:
    run BCATProcess
    EventFlowSystemActor.SaveGrowUp('cStart')
    run CallGrowUpPatchProcess
    EventFlowSystemActor.TimeLock('cUnlock')
    run NSOProcess
    run NSOOptimizeEnd
    run Save
    if not event_flags_system['cPlayer:TownNewsReserve']:
        EventFlowSystemActor.SystemRequestChangeStage('cMainFieldPlayerHouse', 'cCircle', 'cCircle', 'cBlack', 1.0, 1.0)
    elif (event_flags_system['cLand:BuiltTownOffice']) and (not event_flags_system['cLand:BuiltTownOfficeToday']):
        EventFlowSystemActor.SystemRequestChangeStage('cGrowUpTalk', 'cCircle', 'cCircle', 'cBlack', 1.0, 1.0)
    else:
        EventFlowSystemActor.SystemRequestChangeStage('cGrowUpTalkEventPlaza', 'cCircle', 'cCircle', 'cBlack', 1.0, 1.0)
    return

flow DateCheck:
    if not EventFlowSystemActor.IsGamePlayTime():
        run System_DateTimeNg::NoSave
    return

flow DateCheckWithSave:
    if not EventFlowSystemActor.IsGamePlayTime():
        run System_DateTimeNg::Root
    return

flow InGame:
    run DateCheckWithSave
    EventFlowSystemActor.TimeLock('cLock')
    run CallGrowUpGameWeatherProcess
    run BCATProcess
    run NSOOptimizeBegin
    EventFlowSystemActor.SaveGrowUp('cInGame')
    run CallGrowUpPatchProcess
    EventFlowSystemActor.TimeLock('cUnlock')
    run NSOProcess
    run NSOOptimizeEnd
    run Save
    if (not event_flags_system['cLand:BuiltTownOffice']) or (event_flags_system['cLand:BuiltTownOfficeToday']):
        EventFlowSystemActor.OverWriteFadeSetting('cCircle', 'cNormalFader', 'cBlack', 1.0, 1.0)
    EventFlowSystemActor.SaveAfterGrowUp()
    return

flow NSOOptimizeBegin:
    if (EventFlowSystemActor.GrowUpInterval(1)) and (not EventFlowSystemActor.GrowUpInterval(2)):
        event_flags_system['cPlayerTemp:GrowupNsoServerOptimization'] = true
    return

flow NSOOptimizeEnd:
    event_flags_system['cPlayerTemp:GrowupNsoServerOptimization'] = false
    return

flow NSOProcess:
    EventFlowSystemActor.NetConnectInit('cConnectInet', true)
    if not EventFlowSystemActor.CheckErrorType(2):
        EventFlowSystemActor.NetCheckNSA('cCheckNSA', true)
        if (not EventFlowSystemActor.CheckErrorType(2)) and (EventFlowSystemActor.NetHasPOPID(false)):
            EventFlowSystemActor.NetUpdateFriendList('cBestFriend')
            EventFlowSystemActor.NetReceiveMail()
            EventFlowSystemActor.NetUpdateFriendLandWithInterval(1)
            run System_ServerRegistration::UploadProfileCore
    return

flow NewGame:
    run DateCheck
    if EventFlowSystemActor.PassDaysSincePreviousGrowUp():
        run System_GrowUp_GameProcess::Root
    run System_GrowUp_GameProcess::FirstDay
    run System_GrowUp_WeatherControl::FirstDay
    EventFlowSystemActor.SaveGrowUp('cStart')
    run CallGrowUpPatchProcess
    EventFlowSystemActor.TimeLock('cUnlock')
    EventFlowSystemActor.SystemRequestChangeStage('cMainFieldDemoLanding', 'cCircle', 'cCircle', 'cBlack', 1.0, 1.0)
    return

flow PlayerSwitch:
    EventFlowSystemActor.ReserveSystemFlowDemo('PostPlayerSwitch', 'System_GrowUp')
    run DateCheckWithSave
    EventFlowSystemActor.TimeLock('cLock')
    run CallGrowUpGameWeatherProcess
    EventFlowSystemActor.SetupSharePlay(false)
    return

flow PostPlayerSwitch:
    if not EventFlowSystemActor.IsSharePlay(0):
        run Save
        EventFlowSystemActor.SaveSimpleLoad('cAll')
    EventFlowSystemActor.SaveGrowUp('cInGame')
    run CallGrowUpPatchProcess
    EventFlowSystemActor.TimeLock('cUnlock')
    if not EventFlowSystemActor.IsSharePlay(0):
        EventFlowSystemActor.NetUpdateFriendList('cBestFriend')
        EventFlowSystemActor.NetReceiveMail()
    run Save
    EventFlowSystemActor.DemoSetShareStartFlag()
    EventFlowSystemActor.ReserveSystemFlowDemo('Root', 'System_SharePlay_Controller')
    if EventFlowSystemActor.IsSharePlay(0):
        EventFlowSystemActor.SystemRequestChangeStage('cEventPlaza', 'cCircle', 'cCircle', 'cBlack', 1.0, 1.0)
    else:
        EventFlowSystemActor.SystemRequestChangeStage('cMainFieldPlayerHouse', 'cCircle', 'cCircle', 'cBlack', 1.0, 1.0)
    return

flow Save:
    EventFlowSystemActor.UISaveIconAppear()
    EventFlowSystemActor.SaveSimpleSave('cAll')
    EventFlowSystemActor.UISaveIconDisappear()
    return

flow SharePlayForceBreakup:
    EventFlowSystemActor.SaveSimpleLoad('cAll')
    event_flags_system['cPlayer:EquipLicenseHelmet'] = false
    EventFlowSystemActor.ReserveSystemFlowDemo('PostPlayerSwitch', 'System_GrowUp')
    run DateCheckWithSave
    EventFlowSystemActor.TimeLock('cLock')
    run CallGrowUpGameWeatherProcess
    EventFlowSystemActor.SetupSharePlay(true)
    return

flow Title:
    run DateCheck
    EventFlowSystemActor.TimeLock('cUpdateAndLock')
    if not EventFlowSystemActor.IsDoneBcatProcess():
        run BCATProcess
    run CallGrowUpGameWeatherProcess
    EventFlowSystemActor.SaveGrowUp('cTitle')
    run CallGrowUpPatchProcess
    EventFlowSystemActor.TimeLock('cUnlock')
    if EventFlowSystemActor.PlayAccountIsPlayerVillager():
        EventFlowSystemActor.SystemRequestChangeStage('cTitle', 'cCircle', 'cCircle', 'cBlack', 1.0, 1.0)
    else:
        EventFlowSystemActor.SystemRequestChangeStage('cDateCheck', 'cCircle', 'cCircle', 'cBlack', 1.0, 1.0)
    return

flow TitleAfterSharePlay:
    run DateCheck
    EventFlowSystemActor.TimeLock('cUpdateAndLock')
    run CallGrowUpGameWeatherProcess
    EventFlowSystemActor.SaveGrowUp('cTitle')
    run CallGrowUpPatchProcess
    EventFlowSystemActor.TimeLock('cUnlock')
    EventFlowSystemActor.SystemRequestChangeStage('cTitle', 'cCircle', 'cCircle', 'cBlack', 1.0, 1.0)
    return


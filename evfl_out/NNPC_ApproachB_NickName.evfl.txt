flow Retype:
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Approach/BO_ApproachB_NickName:107', true)
    run Event21
    return

flow NewName:
    fork:
        branch0:
        branch1:
            EventFlowSystemActor.CandNicknamePattern()
        branch2:
            if MainNpc.CheckNpcApproachType():
                if event_flag_npc['cNpcMemory:InputNickname']:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Approach/BO_ApproachB_NickName:002', false)
                else:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Approach/BO_ApproachB_NickName:001', false)
            elif event_flag_npc['cNpcMemory:InputNickname']:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Approach/BO_ApproachB_NickName:005', false)
            else:
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Approach/BO_ApproachB_NickName:004', false)
    if EventFlowSystemActor.GeneralTalkChoice2() == 0:
        MainNpc.NpcSetNicknameToTag('cPattern')
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Approach/BO_ApproachB_NickName:100', false)
        if EventFlowSystemActor.GeneralTalkChoice2() == 0:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Approach/BO_ApproachB_NickName:102', false)
            MainNpc.NpcSaveNickname('cPattern')
            event_flags_npc['cNpcMemory:InputNickname'] = true
        elif EventFlowSystemActor.PercentChoice(50):
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Approach/BO_ApproachB_NickName:103', true)
entrypoint Event21:
            EventFlowSystemActor.UISoftwareKeyboardHandling('cNicname', true)
            if EventFlowSystemActor.UIResultMenuDecide():
                EventFlowSystemActor.SetTagFromUIResult(0, 'cNickname')
                if MainNpc.NpcCheckSameWordFromSwkbd('cNickname'):
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Approach/BO_ApproachB_NickName:105', false)
                    if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Approach/BO_ApproachB_NickName:108', false)
                    else:
                        run Retype
                else:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Approach/BO_ApproachB_NickName:106', false)
                    if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Approach/BO_ApproachB_NickName:109', false)
                        EventFlowSystemActor.SaveSetFromUIResult('cNickname')
                        event_flags_npc['cNpcMemory:InputNickname'] = true
                    else:
                        run Retype
            else:
                run Cancell
        else:
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Approach/BO_ApproachB_NickName:104', false)
    else:
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Approach/BO_ApproachB_NickName:101', false)
    return

flow CopyName:
    MainNpc.NpcSetNicknameToTag('cOtherNpc')
    if MainNpc.CheckNpcApproachType():
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Approach/BO_ApproachB_NickName:003', false)
    else:
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Approach/BO_ApproachB_NickName:006', false)
    if EventFlowSystemActor.GeneralTalkChoice2() == 0:
        MainNpc.NpcSaveNickname('cOtherNpc')
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Approach/BO_ApproachB_NickName:200', false)
        event_flags_npc['cNpcMemory:InputNickname'] = true
    else:
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Approach/BO_ApproachB_NickName:201', true)
    return

flow Cancell:
    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Approach/BO_ApproachB_NickName:110', true)
    run Event21
    return


flow Action_CurrentPlayer_Chk:
    if MainNpc.CanSelectRumorMessage(2):
        run NNPC_FreeD_RumorAction::RumorP_Action_CurrentPlayer
        event_flags_system['cPlayer:TalkRumorPActionTodayAnyone'] = true
        EventFlowSystemActor.ExitFlowchart()
    return

flow Action_Villager_Chk:
    if (EventFlowSystemActor.PlayerVillagerCount(2)) and (not EventFlowSystemActor.IsSharePlay(1)) and (MainNpc.HasPlayerActivitySinceMoveIn(0)):
        run NNPC_FreeD_RumorAction::RumorOP_Action_Villager
        event_flags_system['cPlayer:TalkRumorOActionTodayAnyone'] = true
        EventFlowSystemActor.ExitFlowchart()
    return

flow Action_Visitor_Chk:
    if (EventFlowSystemActor.IsMyVillage()) and (not EventFlowSystemActor.NetHasVisitor()) and (MainNpc.HasPlayerActivitySinceMoveIn(1)):
        run NNPC_FreeD_RumorAction::RumorOP_Action_Visitor
        event_flags_npc['cNpcMemory:TalkRumorVActionToday'] = true
        EventFlowSystemActor.ExitFlowchart()
    return

flow KeywordA:
    if event_flags_system['cPlayer:HeardAboutFreeDKeywordA'] == 0:
        MainNpc.DecideHandleNameMemory(0)
        if (MainNpc.HasHandleNameMemory()) and (MainNpc.HandleNameTalkDayInterval(3, 1)):
            MainNpc.SetHandleNameTag(0)
            MainNpc.SetPlayerName(5)
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Free/BO_FreeD_Keyword:001', false)
            event_flags_system['cPlayer:HeardAboutFreeDKeywordA'] = 3
            EventFlowSystemActor.ExitFlowchart()
    return

flow KeywordB:
    if event_flags_system['cPlayer:HeardAboutFreeDKeywordB'] == 0:
        MainNpc.DecideHandleNameMemory(1)
        if (MainNpc.HasHandleNameMemory()) and (MainNpc.HandleNameTalkDayInterval(3, 1)):
            MainNpc.SetHandleNameTag(0)
            MainNpc.SetPlayerName(5)
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Free/BO_FreeD_Keyword:002', false)
            event_flags_system['cPlayer:HeardAboutFreeDKeywordB'] = 3
            EventFlowSystemActor.ExitFlowchart()
    return

flow KeywordC:
    if (event_flags_system['cPlayer:HeardAboutFreeDKeywordC'] == 0) and (not EventFlowSystemActor.IsMyVillage()):
        MainNpc.DecideHandleNameMemory(2)
        if MainNpc.HasHandleNameMemory():
            MainNpc.SetHandleNameTag(0)
            MainNpc.SetPlayerName(5)
            MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Free/BO_FreeD_Keyword:003', false)
            event_flags_system['cPlayer:HeardAboutFreeDKeywordC'] = 3
            EventFlowSystemActor.ExitFlowchart()
    return

flow Moving_Chk:
    if (not event_flag_npc['cNpcMemory:TalkFreeMovingNow']) and (MainNpc.NpcMoveOutState() == 3) and (event_flag_npc['cNpcMemory:NextMoveOutTalk']):
        MainNpc.NpcSelectFreeTalk('cWildCard', '', '', '', 'TalkNNpc/B1_Bo/Free/BO_FreeD_Moving', '', '', '', true)
        event_flags_npc['cNpcMemory:TalkFreeMovingNow'] = true
        EventFlowSystemActor.ExitFlowchart()
    return

flow RumorN1_Chk:
    if (not event_flag_npc['cNpcMemory:TalkRumorNToday']) and (not ((MainNpc.NpcBirthType('cFirst')) and ((event_flag_npc['cNpcTemp:AppWelcomeMigrantsTalk']) or (event_flag_npc['cNpcSave:AppE_WelcomeMigrantsToday'])))):
        run sub_grp!Event74
    return

flow RumorN2_Chk:
    if (not event_flags_system['cPlayer:TalkRumorN2TodayAnyone']) and (MainNpc.NpcHasFreeMessage('cFreeDRumorN2')):
        MainNpc.NpcOpenFreeMessage('cFreeDRumorN2')
        event_flags_system['cPlayer:TalkRumorN2TodayAnyone'] = true
        EventFlowSystemActor.ExitFlowchart()
    return

flow RumorN_Chk:
    if MainNpc.NpcMoveOutState() in (0, 1, 2, 4):
        if EventFlowSystemActor.RandomChoice2(2) != 0:
            run RumorN2_Chk
        run RumorN1_Chk
    return

flow RumorO_Favorite_Chk:
    if (MainNpc.NpcMoveOutState() in (0, 1, 2, 4)) and (EventFlowSystemActor.NpcHouseNum('cConstructed') < 5):
        if EventFlowSystemActor.IsMyVillage():
            if (not event_flags_system['cPlayer:TalkRumorOVlgFavoriteToday']) and (EventFlowSystemActor.PlayerVillagerCount(2)) and (not EventFlowSystemActor.IsSharePlay(1)):
                run NNPC_FreeD_RumorFavorite::RumorOP_Favorite_Villager
                event_flags_system['cPlayer:TalkRumorOVlgFavoriteToday'] = true
                EventFlowSystemActor.ExitFlowchart()
        elif not event_flag_npc['cNpcMemory:TalkRumorOFavoriteToday']:
            run NNPC_FreeD_RumorFavorite::RumorOP_Favorite_Host
            event_flags_npc['cNpcMemory:TalkRumorOFavoriteToday'] = true
            EventFlowSystemActor.ExitFlowchart()
    return

flow RumorP_Favorite_Chk:
    if (not event_flags_system['cPlayer:TalkRumorPFavoriteTodayAnyone']) and (event_flags_system['cPlayer:RumorPFavoriteProgressDays'] >= 5) and (MainNpc.NpcMoveOutState() in (0, 1, 2, 4)) and (EventFlowSystemActor.NpcHouseNum('cConstructed') < 5):
        run NNPC_FreeD_RumorFavorite::RumorP_Favorite_CurrentPlayer
    return

flow RumorP_Favorite_End:
    event_flags_system['cPlayer:TalkRumorPFavoriteTodayAnyone'] = true
    event_flags_system['cPlayer:RumorPFavoriteProgressDays'] = 0
    EventFlowSystemActor.ExitFlowchart()
    return

flow Rumor_Action_Chk:
    if (EventFlowSystemActor.NpcHouseNum('cConstructed') < 5) and (MainNpc.NpcLivingDays(3)):
        if not event_flags_system['cPlayer:TalkRumorOActionTodayAnyone']:
            run Action_Villager_Chk
        if not event_flag_npc['cNpcMemory:TalkRumorVActionToday']:
            run Action_Visitor_Chk
        if not event_flags_system['cPlayer:TalkRumorPActionTodayAnyone']:
            run Action_CurrentPlayer_Chk
    return

flow sub_grp!Event74:
    if MainNpc.NpcHasFreeMessage('cFreeDRumorN1'):
        MainNpc.NpcOpenFreeMessage('cFreeDRumorN1')
        event_flags_npc['cNpcMemory:TalkRumorNToday'] = true
        EventFlowSystemActor.ExitFlowchart()


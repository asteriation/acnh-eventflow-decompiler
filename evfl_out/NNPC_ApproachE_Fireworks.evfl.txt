flow Root:
    if MainNpc.IsFirewoksApproachNpc():
        MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Approach/BO_ApproachE_Fireworks:001', false)
entrypoint Event12:
        if EventFlowSystemActor.PercentChoice(50):
            run FireworksSet_Red
            if EventFlowSystemActor.ShoppingCapacity(5743, 'cNpcTrade'):
                MainNpc.NpcDelivery('Default', 1)
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Approach/BO_ApproachE_Fireworks:002', false)
                event_flags_npc['cNpcMemory:FireworksGetItemFlag'] = true
            else:
                run FireworksSet_Blue
                if EventFlowSystemActor.ShoppingCapacity(12974, 'cNpcTrade'):
                    MainNpc.NpcDelivery('Default', 1)
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Approach/BO_ApproachE_Fireworks:002', false)
                    event_flags_npc['cNpcMemory:FireworksGetItemFlag'] = true
                else:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Approach/BO_ApproachE_Fireworks:003', false)
                    event_flags_npc['cNpcMemory:FireworksCannotGetNnpcItemFlag'] = true
                    event_flags_system['cPlayer:FireworkCannotGetNnpcItemFlag'] = true
        else:
            run FireworksSet_Blue
            if EventFlowSystemActor.ShoppingCapacity(12974, 'cNpcTrade'):
                MainNpc.NpcDelivery('Default', 1)
                MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Approach/BO_ApproachE_Fireworks:002', false)
                event_flags_npc['cNpcMemory:FireworksGetItemFlag'] = true
            else:
                run FireworksSet_Red
                if EventFlowSystemActor.ShoppingCapacity(5743, 'cNpcTrade'):
                    MainNpc.NpcDelivery('Default', 1)
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Approach/BO_ApproachE_Fireworks:002', false)
                    event_flags_npc['cNpcMemory:FireworksGetItemFlag'] = true
                else:
                    MainNpc.OpenMessageWindow('TalkNNpc/B1_Bo/Approach/BO_ApproachE_Fireworks:003', false)
                    event_flags_npc['cNpcMemory:FireworksCannotGetNnpcItemFlag'] = true
                    event_flags_system['cPlayer:FireworkCannotGetNnpcItemFlag'] = true
    return

flow GetFireworksItem:
    run Event12
    return

flow FireworksSet_Red:
    MainNpc.SetDeliveryItemAtRandom(5743, true, 'cVillageRemakePattern', 0)
    return

flow FireworksSet_Blue:
    MainNpc.SetDeliveryItemAtRandom(12974, true, 'cVillageRemakePattern', 0)
    return


flow Chy_ObjEntryCount:
    if not event_flags_system['cPlayer:ChyDaily_ObjEntry3']:
        if event_flags_system['cPlayer:ChyDaily_ObjEntry2']:
            event_flags_system['cPlayer:ChyDaily_ObjEntry3'] = true
        elif event_flags_system['cPlayer:ChyDaily_ObjEntry1']:
            event_flags_system['cPlayer:ChyDaily_ObjEntry2'] = true
        else:
            event_flags_system['cPlayer:ChyDaily_ObjEntry1'] = true
    return

flow DailySell_Cancel:
    run Event40
    return

flow Daily_ReqObj:
    if event_flags_system['cPlayer:ChyDaily_ReqObj']:
        MainNpc.NpcDecideOrderBeforeItem('cChyInsect')
        MainNpc.SetItemName(1, 28, 0)
        if MainNpc.ChyIfSpecialInsect():
            MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:111', false)
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:100', false)
    elif event_flags_system['cPlayer:ChyDaily_ExplainReqObj_First']:
        run sub_grp!Event87
    else:
        event_flags_system['cPlayer:ChyDaily_ExplainReqObj_First'] = true
        MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:101', false)
entrypoint Event8:
        MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:102', false)
        fEvent89 = EventFlowSystemActor.GeneralTalkChoice3()
        if fEvent89 == 2:
            MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:110', false)
        elif fEvent89 == 1:
            run Ex_Obj2
        elif fEvent89 == 0:
            run sub_grp!Event87
    return

flow Daily_SellCancel_Talk:
    run Event29
    return

flow Daily_SellInsect:
    if EventFlowSystemActor.HasKindItem('cKind', 'Insect', ''):
        MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:016', false)
        EventFlowSystemActor.UIItemSelectWindowHandling(65534, 'Insect', 'cItemSelect', '', 'cInsectSell', false)
        if (EventFlowSystemActor.UIResultMenuDecide()) and (EventFlowSystemActor.UIResultItemWindowNumCheck('cItemSelect', 1)):
            MainNpc.SetDeliveryItem(4, false)
            MainNpc.NpcDelivery('Keep', 0)
            MainNpc.ShopSellCalc('SellTotal', false, 1.5, true)
            EventFlowSystemActor.SetTagFromSystem(2, 'cFlow', 'cMoney', '""', 'SellTotal')
            EventFlowSystemActor.UIMoneyAppear()
            if EventFlowSystemActor.UIResultItemWindowNumCheck('cItemSelect', 2):
                MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:025', false)
            else:
                EventFlowSystemActor.SetTagFromUIResult(0, 'cItemName')
                MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:024', false)
            if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:027', false)
                MainNpc.MessageSuspend()
                MainNpc.NpcDelivery('Default', 7)
                MainNpc.ShopSellDone(1.5, false)
                EventFlowSystemActor.UIMoneyDisappear()
                if (EventFlowSystemActor.ChyWeekEndEvent() in (0, 1)) and (not event_flags_system['cPlayer:ChyDaily_AnnounceEvent']):
                    event_flags_system['cPlayer:ChyDaily_AnnounceEvent'] = true
                    MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:033', false)
                else:
                    MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:028', false)
            else:
entrypoint Event40:
                MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:020', false)
                MainNpc.NpcDelivery('Default', 10)
                EventFlowSystemActor.UIMoneyDisappear()
                run Daily_SellCancel_Talk
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:021', false)
entrypoint Event29:
            fEvent29 = EventFlowSystemActor.EnvTimeZone()
            if fEvent29 in (Morning0, Morning1, Afternoon0, Afternoon1, Evening0):
                MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:022', false)
            elif fEvent29 == Evening1:
                MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:023', false)
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:011', false)
        fEvent13 = EventFlowSystemActor.EnvTimeZone()
        if fEvent13 in (Morning0, Morning1, Afternoon0, Afternoon1, Evening0):
            MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:012', true)
        elif fEvent13 == Evening1:
            MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:013', true)
    return

flow Ex_Obj2:
    MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:103', false)
    run Event8
    return

flow Root:
    run Tag_Num_daily
    run Tag_SET_HOUR_daily
    EventFlowSystemActor.SetTagFromSystem(3, 'cNowCatchInsect', 'cDegit', '', 0)
    if not EventFlowSystemActor.IsMyVillage():
        if event_flags_system['cPlayerVisit:DC_ChyDaily_TalkFirst']:
            fEvent76 = EventFlowSystemActor.RandomChoiceExcludePrevious3(true, 3)
            if fEvent76 == 0:
                MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:073', false)
            elif fEvent76 == 1:
                MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:072', false)
            elif fEvent76 == 2:
                MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:071', false)
        else:
            event_flags_system['cPlayerVisit:DC_ChyDaily_TalkFirst'] = true
            MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:070', false)
    elif event_flags_system['cPlayer:ChyDaily_TalkFirstDay']:
        fEvent110 = EventFlowSystemActor.RandomChoice3(3)
        if fEvent110 == 0:
            fEvent1 = EventFlowSystemActor.RandomChoiceExcludePrevious3(true, 3)
            if fEvent1 == 2:
                MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:042', false)
            elif fEvent1 == 1:
                MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:041', false)
            elif fEvent1 == 0:
                MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:040', false)
        elif fEvent110 == 1:
            fEvent124 = EventFlowSystemActor.RandomChoiceExcludePrevious3(true, 3)
            if fEvent124 == 2:
                MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:045', false)
            elif fEvent124 == 0:
                MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:043', false)
            elif fEvent124 == 1:
                MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:044', false)
        elif fEvent110 == 2:
            fEvent125 = EventFlowSystemActor.RandomChoiceExcludePrevious4(4, true)
            if fEvent125 == 0:
                MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:046', false)
            elif fEvent125 == 1:
                MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:047', false)
            elif fEvent125 == 2:
                MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:048', false)
            elif fEvent125 == 3:
                MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:049', false)
        if event_flags_system['cPlayer:ChyDaily_ReqObj']:
            MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:014', false)
            fEvent44 = EventFlowSystemActor.GeneralTalkChoice3()
            if fEvent44 == 1:
                run Daily_ReqObj
            elif fEvent44 == 2:
                run TalkCancel
            elif fEvent44 == 0:
                run Daily_SellInsect
        elif event_flags_system['cPlayer:ChyDaily_ExplainReqObj_First']:
            MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:015', false)
            run sub_grp!Event74
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:010', false)
            run sub_grp!Event4
    else:
        event_flags_system['cPlayer:ChyDaily_TalkFirstDay'] = true
        if event_flags_system['cPlayer:ChyDaily_TalkFirst']:
            MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:004', false)
            if event_flags_system['cPlayer:ChyDaily_ExplainReqObj_First']:
                MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:006', false)
                run sub_grp!Event74
            else:
                MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:005', false)
                run sub_grp!Event4
        else:
            event_flags_system['cPlayer:ChyDaily_TalkFirst'] = true
            MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:000', false)
            MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:005', false)
            run sub_grp!Event4
    return

flow Tag_Num_daily:
    fEvent151 = EventFlowSystemActor.EnvSeason()
    if fEvent151 in (Spring, Summer, Autumn):
        EventFlowSystemActor.SetTagFromSystem(0, 'cFlow', 'cDegit', 'cPlayerTemp:CatchInsectFesGetNum', 6)
        EventFlowSystemActor.SetTagFromSystem(3, 'cFlow', 'cDegit', 'cPlayerTemp:CatchInsectFesGetNum', 3)
    elif fEvent151 == Winter:
        EventFlowSystemActor.SetTagFromSystem(0, 'cFlow', 'cDegit', 'cPlayerTemp:CatchInsectFesGetNum', 4)
        EventFlowSystemActor.SetTagFromSystem(3, 'cFlow', 'cDegit', 'cPlayerTemp:CatchInsectFesGetNum', 3)
    return

flow Tag_SET_HOUR_daily:
    EventFlowSystemActor.SetTagFromSystem(0, 'cFlow', 'cHour', 'cPlayer:CatchInsectFesCount', 5)
    return

flow TalkCancel:
    fEvent81 = EventFlowSystemActor.EnvTimeZone()
    if fEvent81 in (Morning0, Morning1, Afternoon0, Afternoon1, Evening0):
        MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:002', false)
    elif fEvent81 == Evening1:
        MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:003', false)
    return

flow sub_grp!Event4:
    fEvent4 = EventFlowSystemActor.GeneralTalkChoice3()
    if fEvent4 == 0:
        run Daily_SellInsect
    elif fEvent4 == 2:
        run TalkCancel
    elif fEvent4 == 1:
        run Daily_ReqObj

flow sub_grp!Event74:
    fEvent74 = EventFlowSystemActor.GeneralTalkChoice3()
    if fEvent74 == 1:
        run Daily_ReqObj
    elif fEvent74 == 0:
        run Daily_SellInsect
    elif fEvent74 == 2:
        run TalkCancel

flow sub_grp!Event87:
    if MainNpc.ChyHaveThreeOrMoreSameInsect():
        MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:106', false)
        EventFlowSystemActor.UIItemSelectWindowHandling(65534, 'Insect', 'cItemSelect', '', 'cInsectToyExchange', false)
        if EventFlowSystemActor.UIResultItemWindowNumCheck('cItemSelect', 1):
            EventFlowSystemActor.SetTagFromUIResult(2, 'cItemName')
            MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:107', false)
            if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                MainNpc.MessageSuspend()
                MainNpc.SetDeliveryItem(4, false)
                MainNpc.NpcDelivery('Default', 0)
                event_flags_system['cPlayer:ChyDaily_ReqObj'] = true
                run Chy_ObjEntryCount
                MainNpc.ChySetInsectToy()
                MainNpc.SetOrderBeforeItem('cChyInsect')
                EventFlowSystemActor.DeleteSelectUIItem(3)
                EventFlowSystemActor.SetTagFromUIResult(1, 'cItemName')
                if MainNpc.ChyIfSpecialInsect():
                    EventFlowSystemActor.SystemMailSend('cChy', 'MAIL_SNpc_chy_daily', 'cFastTomorrow', 'cReward', 'cChyInsect', false, 2)
                    fEvent140 = MainNpc.ChyCheckSpecialInsect()
                    if fEvent140 == 0:
                        MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:150', false)
                    elif fEvent140 == 1:
                        MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:151', false)
                    elif fEvent140 == 2:
                        MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:152', false)
                    elif fEvent140 == 3:
                        MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:153', false)
                    elif fEvent140 == 4:
                        MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:154', false)
                    elif fEvent140 == 5:
                        MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:155', false)
                    MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:156', false)
                else:
                    EventFlowSystemActor.SystemMailSend('cChy', 'MAIL_SNpc_chy_daily', 'cFastTomorrow', 'cReward', 'cChyInsect', false, 1)
                    MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:108', false)
            else:
                MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:109', false)
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:109', false)
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/chy/SP_chy_daily:105', false)


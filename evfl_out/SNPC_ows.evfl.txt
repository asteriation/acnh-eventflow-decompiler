flow AfterSetZociacRecipe:
    event_flags_system['cPlayer:OwsPresentThisZodiacRecipe'] = true
    run Event33
    return

flow Chat:
    MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:010', false)
    return

flow ChkHaveZodiacPiece:
    run Event200
    return

flow ChkZodiacRecipe:
    fEvent34 = EventFlowSystemActor.EnvConstellation('cGrowUpTime')
    if fEvent34 == Pisces:
        if EventFlowSystemActor.PlayerHasCraftRecipe(5963, ''):
            run NotSetZodiacRecipe
        else:
            MainNpc.NpcSetRewardRecipe(5963, false)
            run AfterSetZociacRecipe
    elif fEvent34 == Aries:
        if EventFlowSystemActor.PlayerHasCraftRecipe(5954, ''):
            run NotSetZodiacRecipe
        else:
            MainNpc.NpcSetRewardRecipe(5954, false)
            run AfterSetZociacRecipe
    elif fEvent34 == Taurus:
        if EventFlowSystemActor.PlayerHasCraftRecipe(5961, ''):
            run NotSetZodiacRecipe
        else:
            MainNpc.NpcSetRewardRecipe(5961, false)
            run AfterSetZociacRecipe
    elif fEvent34 == Gemini:
        if EventFlowSystemActor.PlayerHasCraftRecipe(5960, ''):
            run NotSetZodiacRecipe
        else:
            MainNpc.NpcSetRewardRecipe(5960, false)
            run AfterSetZociacRecipe
    elif fEvent34 == Cancer:
        if EventFlowSystemActor.PlayerHasCraftRecipe(5959, ''):
            run NotSetZodiacRecipe
        else:
            MainNpc.NpcSetRewardRecipe(5959, false)
            run AfterSetZociacRecipe
    elif fEvent34 == Leo:
        if EventFlowSystemActor.PlayerHasCraftRecipe(5964, ''):
            run NotSetZodiacRecipe
        else:
            MainNpc.NpcSetRewardRecipe(5964, false)
            run AfterSetZociacRecipe
    elif fEvent34 == Virgo:
        if EventFlowSystemActor.PlayerHasCraftRecipe(5955, ''):
            run NotSetZodiacRecipe
        else:
            MainNpc.NpcSetRewardRecipe(5955, false)
            run AfterSetZociacRecipe
    elif fEvent34 == Libra:
        if EventFlowSystemActor.PlayerHasCraftRecipe(3774, ''):
            run NotSetZodiacRecipe
        else:
            MainNpc.NpcSetRewardRecipe(3774, false)
            run AfterSetZociacRecipe
    elif fEvent34 == Scorpius:
        if EventFlowSystemActor.PlayerHasCraftRecipe(5962, ''):
            run NotSetZodiacRecipe
        else:
            MainNpc.NpcSetRewardRecipe(5962, false)
            run AfterSetZociacRecipe
    elif fEvent34 == Sagittarius:
        if EventFlowSystemActor.PlayerHasCraftRecipe(5958, ''):
            run NotSetZodiacRecipe
        else:
            MainNpc.NpcSetRewardRecipe(5958, false)
            run AfterSetZociacRecipe
    elif fEvent34 == Capricorn:
        if EventFlowSystemActor.PlayerHasCraftRecipe(5957, ''):
            run NotSetZodiacRecipe
        else:
            MainNpc.NpcSetRewardRecipe(5957, false)
            run AfterSetZociacRecipe
    elif fEvent34 == Aquarius:
        if EventFlowSystemActor.PlayerHasCraftRecipe(5956, ''):
            run NotSetZodiacRecipe
        else:
            MainNpc.NpcSetRewardRecipe(5956, false)
            run AfterSetZociacRecipe
    return

flow GetStarPiece:
    MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:014', false)
    fEvent145 = EventFlowSystemActor.PercentChoice3(60, 20, 20)
    if fEvent145 == 0:
        MainNpc.SetDeliveryItemAtRandom(5983, false, 'cVillageRemakePattern', 0)
        EventFlowSystemActor.SetItemToPocket(5983, 5)
        run Event36
    elif fEvent145 == 1:
        MainNpc.SetDeliveryItemAtRandom(5984, true, 'cVillageRemakePattern', 0)
        run Event36
    elif fEvent145 == 2:
        run SetZodiacStarPiece
        run Event36
    return

flow HaveZodiacChk:
    subflow_results[2] = 1
    if (not EventFlowSystemActor.HasTargetItem(5985, 1)) and (not EventFlowSystemActor.HasTargetItem(5957, 1)) and (not EventFlowSystemActor.HasTargetItem(5986, 1)) and (not EventFlowSystemActor.HasTargetItem(5956, 1)) and (not EventFlowSystemActor.HasTargetItem(5987, 1)) and (not EventFlowSystemActor.HasTargetItem(5963, 1)) and (not EventFlowSystemActor.HasTargetItem(5988, 1)) and (not EventFlowSystemActor.HasTargetItem(5954, 1)) and (not EventFlowSystemActor.HasTargetItem(5989, 1)) and (not EventFlowSystemActor.HasTargetItem(5961, 1)) and (not EventFlowSystemActor.HasTargetItem(5990, 1)) and (not EventFlowSystemActor.HasTargetItem(5960, 1)) and (not EventFlowSystemActor.HasTargetItem(5991, 1)) and (not EventFlowSystemActor.HasTargetItem(5959, 1)) and (not EventFlowSystemActor.HasTargetItem(5992, 1)) and (not EventFlowSystemActor.HasTargetItem(5964, 1)) and (not EventFlowSystemActor.HasTargetItem(5993, 1)) and (not EventFlowSystemActor.HasTargetItem(5955, 1)) and (not EventFlowSystemActor.HasTargetItem(5994, 1)) and (not EventFlowSystemActor.HasTargetItem(3774, 1)) and (not EventFlowSystemActor.HasTargetItem(5995, 1)) and (not EventFlowSystemActor.HasTargetItem(5962, 1)) and (not EventFlowSystemActor.HasTargetItem(5996, 1)) and (not EventFlowSystemActor.HasTargetItem(5958, 1)):
        subflow_results[2] = 0
    return

flow NotSetZodiacRecipe:
    run Event39
    return

flow PresentRecipe:
    if not event_flags_system['cPlayer:OwsPresentFirstRecipe']:
        MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:108', false)
        MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:109', false)
        MainNpc.NpcSetRewardRecipe(2544, false)
        MainNpc.SetDeliveryItem(1, true)
        MainNpc.NpcDelivery('Default', 1)
        MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:110', false)
        MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:111', false)
        event_flags_system['cPlayer:OwsPresentFirstRecipe'] = true
        event_flags_system['cPlayer:OwsPresentTodayRecipe'] = true
    elif event_flags_system['cPlayer:OwsPresentThisZodiacRecipe']:
entrypoint Event39:
        if EventFlowSystemActor.PlayerHasCraftRecipe(65534, 'Ows01'):
            run GetStarPiece
        else:
            MainNpc.DecideEventRewardDIYRecipe('Ows01')
entrypoint Event33:
            MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:003', false)
            MainNpc.SetDeliveryItem(1, true)
entrypoint Event36:
            MainNpc.NpcDelivery('Default', 1)
            MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:004', false)
            event_flags_system['cPlayer:OwsPresentTodayRecipe'] = true
    else:
        run ChkZodiacRecipe
    return

flow Root:
    if not event_flags_system['cPlayer:OwsFirstTalk']:
        event_flags_system['cPlayer:OwsTalkedToday'] = true
        event_flags_system['cPlayer:OwsFirstTalk'] = true
        MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:101', false)
        MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:102', false)
        MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:103', false)
        fEvent0 = EventFlowSystemActor.EnvSpecialWeather()
        if fEvent0 == HeavyShowerEvening:
            MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:104_01', false)
            MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:105', false)
            MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:106_01', false)
            MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:107', false)
            if EventFlowSystemActor.SystemHasBaggageSpace(1, 'cPocketBag'):
                run PresentRecipe
            else:
                MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:112', false)
        elif fEvent0 in (Normal0, HeavyShowerMorning, HeavyShowerAfternoon, Rainbow, DoubleRainbow, AuroraBorealis0, AuroraBorealis1, Normal8, Normal9):
            MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:104', false)
            MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:105', false)
            MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:106', false)
            MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:107', false)
            if EventFlowSystemActor.SystemHasBaggageSpace(1, 'cPocketBag'):
                run PresentRecipe
            else:
                MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:112', false)
    elif not event_flags_system['cPlayer:OwsTalkedToday']:
        event_flags_system['cPlayer:OwsTalkedToday'] = true
        fEvent27 = EventFlowSystemActor.EnvSpecialWeather()
        if fEvent27 in (Normal0, HeavyShowerMorning, HeavyShowerAfternoon, Rainbow, DoubleRainbow, AuroraBorealis0, AuroraBorealis1, Normal8, Normal9):
            MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:001', false)
            if EventFlowSystemActor.SystemHasBaggageSpace(1, 'cPocketBag'):
                run PresentRecipe
            else:
                MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:004', false)
        elif fEvent27 == HeavyShowerEvening:
            MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:002', false)
            if EventFlowSystemActor.SystemHasBaggageSpace(1, 'cPocketBag'):
                run PresentRecipe
    elif event_flags_system['cPlayer:OwsPresentTodayRecipe']:
entrypoint Event200:
        run HaveZodiacChk
        if subflow_results[2] == 0:
            run Chat
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:011', false)
            if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                EventFlowSystemActor.UIItemSelectWindowHandling(65534, '', 'cItemSelect', '', 'cAsterism', false)
                if EventFlowSystemActor.UIResultMenuDecide():
                    MainNpc.SetDeliveryItem(4, false)
                    MainNpc.NpcDelivery('Keep', 0)
                    EventFlowSystemActor.SetTagFromUIResult(0, 'cItemName')
                    MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:012', false)
                    run TalkAboutZodiac
                    MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:063', false)
                    MainNpc.NpcDelivery('Default', 10)
                    MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:064', false)
                else:
                    MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:013', false)
            else:
                run Chat
    elif EventFlowSystemActor.SystemHasBaggageSpace(1, 'cPocketBag'):
        run PresentRecipe
    else:
        run ChkHaveZodiacPiece
    return

flow SetZodiacStarPiece:
    fEvent161 = EventFlowSystemActor.EnvConstellation('cGrowUpTime')
    if fEvent161 == Capricorn:
        MainNpc.SetDeliveryItemAtRandom(5985, true, 'cVillageRemakePattern', 0)
    elif fEvent161 == Aquarius:
        MainNpc.SetDeliveryItemAtRandom(5986, true, 'cVillageRemakePattern', 0)
    elif fEvent161 == Sagittarius:
        MainNpc.SetDeliveryItemAtRandom(5996, true, 'cVillageRemakePattern', 0)
    elif fEvent161 == Pisces:
        MainNpc.SetDeliveryItemAtRandom(5987, true, 'cVillageRemakePattern', 0)
    elif fEvent161 == Aries:
        MainNpc.SetDeliveryItemAtRandom(5988, true, 'cVillageRemakePattern', 0)
    elif fEvent161 == Taurus:
        MainNpc.SetDeliveryItemAtRandom(5989, true, 'cVillageRemakePattern', 0)
    elif fEvent161 == Gemini:
        MainNpc.SetDeliveryItemAtRandom(5990, true, 'cVillageRemakePattern', 0)
    elif fEvent161 == Cancer:
        MainNpc.SetDeliveryItemAtRandom(5991, true, 'cVillageRemakePattern', 0)
    elif fEvent161 == Leo:
        MainNpc.SetDeliveryItemAtRandom(5992, true, 'cVillageRemakePattern', 0)
    elif fEvent161 == Virgo:
        MainNpc.SetDeliveryItemAtRandom(5993, true, 'cVillageRemakePattern', 0)
    elif fEvent161 == Libra:
        MainNpc.SetDeliveryItemAtRandom(5994, true, 'cVillageRemakePattern', 0)
    elif fEvent161 == Scorpius:
        MainNpc.SetDeliveryItemAtRandom(5995, true, 'cVillageRemakePattern', 0)
    return

flow ShowZodiacChk:
    subflow_results[1] = 0
    subflow_results[0] = 0
    if (EventFlowSystemActor.UIPocketMenuItemSelected(5985)) or (EventFlowSystemActor.UIPocketMenuItemSelected(5957)):
        subflow_results[0] = 1
    elif (EventFlowSystemActor.UIPocketMenuItemSelected(5986)) or (EventFlowSystemActor.UIPocketMenuItemSelected(5956)):
        subflow_results[0] = 2
    elif (EventFlowSystemActor.UIPocketMenuItemSelected(5987)) or (EventFlowSystemActor.UIPocketMenuItemSelected(5963)):
        subflow_results[0] = 3
    elif (EventFlowSystemActor.UIPocketMenuItemSelected(5988)) or (EventFlowSystemActor.UIPocketMenuItemSelected(5954)):
        subflow_results[0] = 4
    elif (EventFlowSystemActor.UIPocketMenuItemSelected(5989)) or (EventFlowSystemActor.UIPocketMenuItemSelected(5961)):
        subflow_results[0] = 5
    elif (EventFlowSystemActor.UIPocketMenuItemSelected(5990)) or (EventFlowSystemActor.UIPocketMenuItemSelected(5960)):
        subflow_results[0] = 6
    elif (EventFlowSystemActor.UIPocketMenuItemSelected(5991)) or (EventFlowSystemActor.UIPocketMenuItemSelected(5959)):
        subflow_results[0] = 7
    elif (EventFlowSystemActor.UIPocketMenuItemSelected(5992)) or (EventFlowSystemActor.UIPocketMenuItemSelected(5964)):
        subflow_results[0] = 8
    elif (not EventFlowSystemActor.UIPocketMenuItemSelected(5993)) and (not EventFlowSystemActor.UIPocketMenuItemSelected(5955)):
        subflow_results[1] = 1
        if (EventFlowSystemActor.UIPocketMenuItemSelected(5994)) or (EventFlowSystemActor.UIPocketMenuItemSelected(3774)):
            subflow_results[0] = 0
        elif (EventFlowSystemActor.UIPocketMenuItemSelected(5995)) or (EventFlowSystemActor.UIPocketMenuItemSelected(5962)):
            subflow_results[0] = 1
        elif (not EventFlowSystemActor.UIPocketMenuItemSelected(5996)) and (not EventFlowSystemActor.UIPocketMenuItemSelected(5958)):
            subflow_results[1] = 0
            subflow_results[0] = 0
        else:
            subflow_results[0] = 2
    else:
        subflow_results[0] = 9
    return

flow TalkAboutZodiac:
    run ShowZodiacChk
    if subflow_results[1] == 0:
        fEvent174 = subflow_results[0]
        if fEvent174 == 9:
            MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:059', false)
        elif fEvent174 == 8:
            MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:058', false)
        elif fEvent174 == 7:
            MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:057', false)
        elif fEvent174 == 6:
            MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:056', false)
        elif fEvent174 == 5:
            MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:055', false)
        elif fEvent174 == 4:
            MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:054', false)
        elif fEvent174 == 3:
            MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:053', false)
        elif fEvent174 == 2:
            MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:052', false)
        elif fEvent174 == 1:
            MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:051', false)
    else:
        fEvent175 = subflow_results[0]
        if fEvent175 == 2:
            MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:062', false)
        elif fEvent175 == 1:
            MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:061', false)
        elif fEvent175 == 0:
            MainNpc.OpenMessageWindow('TalkSNpc/ows/SP_ows:060', false)
    return


flow Root:
    MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_01_MainField:001_01', true)
    event_flags_system['cPlayer:SpnInviteEventJuneBride'] = false
    event_flags_system['cPlayer:SpnInvitedEventJuneBride'] = true
    if EventFlowSystemActor.IsExistPHouseVisitNpcYet():
        EventFlowSystemActor.SystemRequestChangeStage('cMainFieldPlayerHouse', 'cCircle', 'cCircle', 'cBlack', 1.0, 1.0)
    else:
        EventFlowSystemActor.FadeOut('cCircle', 'cCircle', 'cBlack', 1.0, 1.0, true)
        EventFlowSystemActor.WaitFrame(30)
        EventFlowSystemActor.CameraSetDemoParam('Player', 'cNormal', '', false, false, false, 0)
        MainNpc.NpcAISetting(12, false)
        Player.TurnBody(11, 0.0)
        EventFlowSystemActor.SetHideObjectVisible()
        EventFlowSystemActor.FadeIn(true)
    return

flow Spn_FirstJuneBride:
    event_flags_system['cPlayer:SpnFirstTalkedAtCommuneIsland'] = true
    event_flags_system['cPlayer:SpnTalkAtCommuneToday'] = true
    EventFlowSystemActor.CameraSetDemoParam('Npc:spn', 'DemoJB_Cut1', 'cDefault', false, false, false, 0)
    MainNpc.TurnBody(1, 0.0)
    Npc_1.TurnBody(0, 0.0)
    Npc_2.TurnBody(0, 0.0)
    MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:000_01', false)
    fork:
        branch0:
        branch1:
            Npc_1.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:000_02', false)
        branch2:
            EventFlowSystemActor.WaitFrame(30)
            Npc_2.CharacterEmoticonAction('Worried', '', 0, true, false)
    EventFlowSystemActor.WaitFrame(10)
    MainNpc.CharacterEmoticonAction('Shocked', '', 0, true, false)
    EventFlowSystemActor.WaitFrame(15)
    MainNpc.TurnBody(10, 0.0)
    fork:
        branch0:
        branch1:
            if event_flags_system['cPlayer:StandByPhoneCallJuneBrideSpn']:
                MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:001', false)
            else:
                MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:001_00', false)
        branch2:
            EventFlowSystemActor.WaitFrame(10)
            Npc_1.TurnBody(10, 0.0)
        branch3:
            EventFlowSystemActor.WaitFrame(10)
            Npc_2.TurnBody(10, 0.0)
    fork:
        branch0:
        branch1:
            MainNpc.TurnBody(1, 0.0)
            MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:001_01', false)
        branch2:
            EventFlowSystemActor.WaitFrame(10)
            Npc_1.CharacterEmoticonAction('Greeting', '', 0, true, false)
        branch3:
            Player.TurnBody(1, 0.0)
        branch4:
            EventFlowSystemActor.WaitFrame(30)
            EventFlowSystemActor.BGMPropertyControl(91)
    fork:
        branch0:
        branch1:
            MainNpc.TurnBody(2, 0.0)
            MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:001_02', false)
        branch2:
            EventFlowSystemActor.WaitFrame(10)
            Npc_2.CharacterEmoticonAction('Greeting', '', 0, true, false)
        branch3:
            Player.TurnBody(2, 0.0)
    MainNpc.TurnBody(10, 0.0)
    fork:
        branch0:
        branch1:
            Player.TurnBody(0, 0.0)
        branch2:
            Npc_1.TurnNeck(2)
            Npc_1.CharacterEmoticonAction('FaintSmile', '', 0, true, true)
        branch3:
            Npc_2.TurnNeck(1)
            Npc_2.CharacterEmoticonAction('FaintSmile', '', 0, true, true)
    MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:001_03', false)
    fork:
        branch0:
        branch1:
            MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:002', false)
        branch2:
            Npc_1.TurnBody(10, 0.0)
            Npc_1.CharacterEmoticonAction('EmotEnd', '', 0, true, true)
        branch3:
            Npc_2.TurnBody(10, 0.0)
            Npc_2.CharacterEmoticonAction('EmotEnd', '', 0, true, true)
    fork:
        branch0:
        branch1:
            MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:003', true)
        branch2:
            Npc_1.CharacterEmoticonAction('Smiling', '', 0, true, true)
        branch3:
            Npc_2.CharacterEmoticonAction('FaintSmile', '', 0, true, true)
    EventFlowSystemActor.WaitFrame(10)
    EventFlowSystemActor.MessageSuspend()
    EventFlowSystemActor.SystemRequestChangeStage('cFirstJuneBrideStudio', 'cCircle', 'cCircle', 'cBlack', 1.0, 1.0)
    return

flow Spn_FirstJuneBride_Init:
    if (EventFlowSystemActor.TermEventNow('JuneBride', false)) and (event_flags_system['cPlayer:CommuneIslandAvailable']) and (not event_flags_system['cPlayer:SpnJuneBrideTalkEventFrag']):
        MainNpc.NpcAITalkSubCastEntry(1, 'alw')
        MainNpc.NpcAITalkSubCastEntry(2, 'alp')
    run sub_tm!Spn_FirstJuneBride_Init

flow sub_tm!Spn_FirstJuneBride_Init:
    return


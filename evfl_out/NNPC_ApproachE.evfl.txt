flow ForMarketBuilding:
    event_flags_npc['cNpcSave:MarketBuildingSupport'] = true
    fEvent1 = MainNpc.CheckNpcLook()
    if fEvent1 == 3:
        run ForMarketBuilding_AN
    elif fEvent1 == 5:
        run ForMarketBuilding_HA
    return

flow ForMarketBuilding_HA:
    if not event_flags_system['cLand:RcmShopMaterialComplete']:
        MainNpc.OpenMessageWindow('TalkNNpc/B2_Ha/Approach/HA_ApproachE_MainSeq:001', false)
entrypoint Event11:
        if EventFlowSystemActor.ShoppingCapacity(2511, 'cItemName'):
            MainNpc.SetDeliveryItemAtRandom(2511, false, 'cVillageRemakePattern', 0)
            MainNpc.OpenMessageWindow('TalkNNpc/B2_Ha/Approach/HA_ApproachE_MainSeq:002_02', true)
            MainNpc.NpcDelivery('Keep', 1)
            if EventFlowSystemActor.SystemHasBaggageSpace(1, 'cPocketBag'):
                MainNpc.OpenMessageWindow('TalkNNpc/B2_Ha/Approach/HA_ApproachE_MainSeq:003_01', true)
                EventFlowSystemActor.SetItemToPocket(2511, 5)
            else:
                MainNpc.OpenMessageWindow('TalkNNpc/B2_Ha/Approach/HA_ApproachE_MainSeq:003_02', true)
                EventFlowSystemActor.SetItemToPocket(2511, 1)
            MainNpc.NpcDelivery('Default', 2)
        else:
            MainNpc.OpenMessageWindow('TalkNNpc/B2_Ha/Approach/HA_ApproachE_MainSeq:002_01', false)
    elif event_flags_system['cPlayer:DecideShopArea']:
        MainNpc.OpenMessageWindow('TalkNNpc/B2_Ha/Approach/HA_ApproachE_MainSeq:012', false)
entrypoint Event24:
        if EventFlowSystemActor.ShoppingCapacity(2511, 'cItemName'):
            MainNpc.SetDeliveryItemAtRandom(2511, false, 'cVillageRemakePattern', 0)
            MainNpc.OpenMessageWindow('TalkNNpc/B2_Ha/Approach/HA_ApproachE_MainSeq:013_02', false)
            MainNpc.NpcDelivery('Keep', 1)
            if EventFlowSystemActor.SystemHasBaggageSpace(1, 'cPocketBag'):
                MainNpc.OpenMessageWindow('TalkNNpc/B2_Ha/Approach/HA_ApproachE_MainSeq:014_01', true)
                EventFlowSystemActor.SetItemToPocket(2511, 5)
            else:
                MainNpc.OpenMessageWindow('TalkNNpc/B2_Ha/Approach/HA_ApproachE_MainSeq:014_02', true)
                EventFlowSystemActor.SetItemToPocket(2511, 1)
            MainNpc.NpcDelivery('Default', 2)
        else:
            MainNpc.OpenMessageWindow('TalkNNpc/B2_Ha/Approach/HA_ApproachE_MainSeq:013_01', false)
    else:
        MainNpc.OpenMessageWindow('TalkNNpc/B2_Ha/Approach/HA_ApproachE_MainSeq:011', false)
entrypoint Event11:
        if EventFlowSystemActor.ShoppingCapacity(2511, 'cItemName'):
            MainNpc.SetDeliveryItemAtRandom(2511, false, 'cVillageRemakePattern', 0)
            MainNpc.OpenMessageWindow('TalkNNpc/B2_Ha/Approach/HA_ApproachE_MainSeq:002_02', true)
            MainNpc.NpcDelivery('Keep', 1)
            if EventFlowSystemActor.SystemHasBaggageSpace(1, 'cPocketBag'):
                MainNpc.OpenMessageWindow('TalkNNpc/B2_Ha/Approach/HA_ApproachE_MainSeq:003_01', true)
                EventFlowSystemActor.SetItemToPocket(2511, 5)
            else:
                MainNpc.OpenMessageWindow('TalkNNpc/B2_Ha/Approach/HA_ApproachE_MainSeq:003_02', true)
                EventFlowSystemActor.SetItemToPocket(2511, 1)
            MainNpc.NpcDelivery('Default', 2)
        else:
            MainNpc.OpenMessageWindow('TalkNNpc/B2_Ha/Approach/HA_ApproachE_MainSeq:002_01', false)
    return

flow ForMarketBuilding_AN:
    if event_flags_system['cLand:RcmShopMaterialComplete']:
        MainNpc.OpenMessageWindow('TalkNNpc/G4_An/Approach/AN_ApproachE_MainSeq:011', false)
entrypoint Event54:
        if EventFlowSystemActor.GeneralTalkChoice2() == 0:
            MainNpc.OpenMessageWindow('TalkNNpc/G4_An/Approach/AN_ApproachE_MainSeq:002_01', false)
        else:
            MainNpc.OpenMessageWindow('TalkNNpc/G4_An/Approach/AN_ApproachE_MainSeq:002_02', false)
        if EventFlowSystemActor.SystemHasBaggageSpace(1, 'cPocketBag'):
            MainNpc.OpenMessageWindow('TalkNNpc/G4_An/Approach/AN_ApproachE_MainSeq:012_01', false)
            if EventFlowSystemActor.PlayerHasCraftRecipe(65534, 'DIYbookNormalTools'):
                MainNpc.SetDeliveryItemAtRandom(5856, true, 'cRemakePattern0', 0)
                MainNpc.NpcDelivery('Keep', 1)
                MainNpc.OpenMessageWindow('TalkNNpc/G4_An/Approach/AN_ApproachE_MainSeq:012_02', true)
                MainNpc.NpcDelivery('Default', 2)
            else:
                run AN_Got_Shovel
    else:
        MainNpc.OpenMessageWindow('TalkNNpc/G4_An/Approach/AN_ApproachE_MainSeq:001', false)
entrypoint Event27:
        if EventFlowSystemActor.GeneralTalkChoice2() == 0:
            MainNpc.OpenMessageWindow('TalkNNpc/G4_An/Approach/AN_ApproachE_MainSeq:002_01', false)
        else:
            MainNpc.OpenMessageWindow('TalkNNpc/G4_An/Approach/AN_ApproachE_MainSeq:002_02', false)
        if EventFlowSystemActor.SystemHasBaggageSpace(1, 'cPocketBag'):
            MainNpc.OpenMessageWindow('TalkNNpc/G4_An/Approach/AN_ApproachE_MainSeq:004_01', true)
            if EventFlowSystemActor.PlayerHasCraftRecipe(65534, 'DIYbookNormalTools'):
                MainNpc.SetDeliveryItemAtRandom(5856, true, 'cRemakePattern0', 0)
                MainNpc.NpcDelivery('Keep', 1)
                MainNpc.OpenMessageWindow('TalkNNpc/G4_An/Approach/AN_ApproachE_MainSeq:004_03', true)
            else:
entrypoint Event45:
                MainNpc.SetDeliveryItemAtRandom(2099, true, 'cRemakePattern0', 0)
                MainNpc.NpcDelivery('Keep', 1)
                MainNpc.OpenMessageWindow('TalkNNpc/G4_An/Approach/AN_ApproachE_MainSeq:004_02', true)
            MainNpc.NpcDelivery('Default', 2)
        elif not EventFlowSystemActor.PlayerHasCraftRecipe(65534, 'DIYbookNormalTools'):
            MainNpc.OpenMessageWindow('TalkNNpc/G4_An/Approach/AN_ApproachE_MainSeq:003_01', false)
            MainNpc.OpenMessageWindow('TalkNNpc/G4_An/Approach/AN_ApproachE_MainSeq:003_02', false)
    return

flow AN_Got_Shovel:
    run Event45
    return

flow FromFreeH_HA1:
    run Event11
    return

flow FromFreeH_HA2:
    run Event24
    return

flow FromFreeH_AN1:
    run Event27
    return

flow FromFreeH_AN2:
    run Event54
    return


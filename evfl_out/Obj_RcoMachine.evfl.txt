flow ChkRcoMachineSel:
    if event_flags_system['cPlayer:RcoPaid1stCharge']:
        if event_flags_system['cPlayer:RcoMachineAmiiboCamperUnlock']:
            subflow_results[0] = 3
        else:
            subflow_results[0] = 1
    elif event_flags_system['cPlayer:RcoMachineAmiiboCamperUnlock']:
        subflow_results[0] = 2
    else:
        subflow_results[0] = 0
    return

flow Cmn_WabiMilage:
    event_flags_system['cPlayer:RcoMachineDailyLoginDays'] = 6
    event_flags_system['cPlayer:RcoMachineDailyLoginCheck'] = true
    Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:104', false)
    EventFlowSystemActor.LifeSupportPointCountDown(500, false)
    EventFlowSystemActor.WaitFrame(10)
    Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:105', false)
    return

flow DeliverFriend:
    EventFlowSystemActor.CheckFreeCommunication(true)
    if EventFlowSystemActor.IsApprovedFreeCommunication():
        EventFlowSystemActor.NetUpdateFriendList('cFriendOnly')
entrypoint Event99:
        EventFlowSystemActor.UIAddresseeFriendHandling()
        if EventFlowSystemActor.UIResultMenuDecide():
            EventFlowSystemActor.UIMsgCardSelectHandling()
            if EventFlowSystemActor.UIResultMenuDecide():
                EventFlowSystemActor.UIMsgCardEditTextHandling('cMessageCard')
                if EventFlowSystemActor.UIResultMenuDecide():
                    EventFlowSystemActor.SaveSetFromUIResult('cMsgCard')
entrypoint Event87:
                    EventFlowSystemActor.OpenMessageWindow('Dialog/DIALOG_Msg:1117', false)
                    fork:
                        branch0:
                        branch1:
                            EventFlowSystemActor.NetConnectInit('cConnectInet', true)
                        branch2:
                            EventFlowSystemActor.WaitFrame(30)
                    if EventFlowSystemActor.CheckErrorType(2):
                        run DeliveryError
                    else:
                        EventFlowSystemActor.NetCheckNSA('cCheckNSA', true)
                        if EventFlowSystemActor.CheckErrorType(2):
                            run DeliveryError
                        else:
                            EventFlowSystemActor.MessageSuspend()
                            EventFlowSystemActor.OpenMessageWindow('Dialog/DIALOG_Msg:1118', false)
                            EventFlowSystemActor.SuspendSharePlayCtrlCheck()
                            EventFlowSystemActor.NetSendMailPreProc('cCatalogGift')
                            EventFlowSystemActor.SaveSimpleSave('cAll')
                            fork:
                                branch0:
                                branch1:
                                    EventFlowSystemActor.NetSendMail()
                                branch2:
                                    EventFlowSystemActor.WaitFrame(30)
                            if EventFlowSystemActor.CheckErrorType(2):
                                EventFlowSystemActor.NetSendMailAfterFailProc()
                                EventFlowSystemActor.ResumeSharePlayCtrlCheck()
                                run DeliveryError
                            else:
                                EventFlowSystemActor.MessageSuspend()
                                EventFlowSystemActor.ClearCatalogShoppingMsgCardSetting()
                                EventFlowSystemActor.UICatalogRestartHandling(true)
                                EventFlowSystemActor.ResumeSharePlayCtrlCheck()
                                run Restart
                else:
                    run DeliveryCancel
            else:
                run ReSelectDestinationFriend
        else:
            run DeliveryCancel
    else:
        run DeliveryCancel
    return

flow DeliverVillager:
entrypoint Event221:
    EventFlowSystemActor.UIMsgCardAdrHandling('cPlayerResident')
    if EventFlowSystemActor.UIResultMenuDecide():
        EventFlowSystemActor.UIMsgCardSelectHandling()
        if EventFlowSystemActor.UIResultMenuDecide():
            EventFlowSystemActor.UIMsgCardEditTextHandling('cMessageCard')
            if EventFlowSystemActor.UIResultMenuDecide():
                EventFlowSystemActor.SaveSetFromUIResult('cMsgCard')
                EventFlowSystemActor.CatalogMailSend()
                EventFlowSystemActor.ClearCatalogShoppingMsgCardSetting()
                EventFlowSystemActor.UICatalogRestartHandling(true)
                run Restart
            else:
                EventFlowSystemActor.ClearCatalogShoppingMsgCardSetting()
                EventFlowSystemActor.UICatalogRestartHandling(false)
                run Restart
        else:
            run ReSelectDestination
    else:
        EventFlowSystemActor.ClearCatalogShoppingMsgCardSetting()
        EventFlowSystemActor.UICatalogRestartHandling(false)
        run Restart
    return

flow DeliveryCancel:
    EventFlowSystemActor.ClearCatalogShoppingMsgCardSetting()
    EventFlowSystemActor.UICatalogRestartHandling(false)
    run Restart
    return

flow DeliveryError:
    EventFlowSystemActor.MessageSuspend()
    EventFlowSystemActor.OpenMessageWindow('Dialog/DIALOG_Msg:1116', true)
    if EventFlowSystemActor.GeneralTalkChoice2() == 0:
        EventFlowSystemActor.UIMoneyAppear()
        EventFlowSystemActor.SetTagFromUIResult(0, 'cCatalogItemPrice')
        EventFlowSystemActor.OpenMessageWindow('Dialog/DIALOG_Msg:1119', true)
        EventFlowSystemActor.CountDownCatalogItemPrice(1)
        run DeliveryCancel
    else:
        run RetryDeliverFriend
    return

flow LoginNormal:
    run Event103
    return

flow RcoMachineATM:
    EventFlowSystemActor.UIAtmHandling()
    if not event_flags_system['cPlayer:PlayerLoanRepaying']:
        run RcoSelSeq
    elif EventFlowSystemActor.PlayerHasLoan():
        EventFlowSystemActor.ReservePlayerMutterDemo('Get_FinishLoan', 'cNowDemoEnd', 'Player_GetDemo_Once', false)
    else:
        run RcoSelSeq
    return

flow RcoMachineDailyLogin:
    event_flags_system['cPlayer:RcoGotLoginBonusToday'] = true
    if event_flags_system['cPlayer:ObjRcoMachineCheck1st']:
        fEvent74 = EventFlowSystemActor.OfficeLevel()
        if fEvent74 in (ResServiceTent0, ResServiceTent1):
            run LoginNormal
        elif fEvent74 == ResServiceBuilding:
            if event_flags_system['cLand:BuiltTownOfficeToday']:
                Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:102_01', false)
                Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:103_01', false)
                run Cmn_WabiMilage
                Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:106_01', false)
            else:
                if EventFlowSystemActor.EnvSameDate('cNewYear', 'cGrowUpTime'):
                    if event_flags_system['cLand:CountOfficeAfterBuild'] == 2:
                        run LoginNormal
                    else:
                        Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:102_02', false)
                        Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:103_02', false)
                        run Cmn_WabiMilage
                        Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:106_02', false)
                else:
entrypoint Event103:
                    event_flags_system['cPlayer:RcoMachineDailyLoginCheck'] = true
                    if event_flags_system['cPlayer:RcoMachineDailyLoginDays'] == 0:
                        Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:101_01', false)
                        EventFlowSystemActor.LifeSupportPointCountDown(50, false)
                    elif event_flags_system['cPlayer:RcoMachineDailyLoginDays'] == 1:
                        Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:101_02', false)
                        EventFlowSystemActor.LifeSupportPointCountDown(80, false)
                    elif event_flags_system['cPlayer:RcoMachineDailyLoginDays'] == 2:
                        Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:101_03', false)
                        EventFlowSystemActor.LifeSupportPointCountDown(100, false)
                    elif event_flags_system['cPlayer:RcoMachineDailyLoginDays'] == 3:
                        Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:101_04', false)
                        EventFlowSystemActor.LifeSupportPointCountDown(150, false)
                    elif event_flags_system['cPlayer:RcoMachineDailyLoginDays'] == 4:
                        Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:101_05', false)
                        EventFlowSystemActor.LifeSupportPointCountDown(200, false)
                    elif event_flags_system['cPlayer:RcoMachineDailyLoginDays'] == 5:
                        Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:101_06', false)
                        EventFlowSystemActor.LifeSupportPointCountDown(250, false)
                    else:
                        Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:101_07', false)
                        EventFlowSystemActor.LifeSupportPointCountDown(300, false)
    else:
entrypoint Event103:
        event_flags_system['cPlayer:RcoMachineDailyLoginCheck'] = true
        if event_flags_system['cPlayer:RcoMachineDailyLoginDays'] == 0:
            Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:101_01', false)
            EventFlowSystemActor.LifeSupportPointCountDown(50, false)
        elif event_flags_system['cPlayer:RcoMachineDailyLoginDays'] == 1:
            Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:101_02', false)
            EventFlowSystemActor.LifeSupportPointCountDown(80, false)
        elif event_flags_system['cPlayer:RcoMachineDailyLoginDays'] == 2:
            Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:101_03', false)
            EventFlowSystemActor.LifeSupportPointCountDown(100, false)
        elif event_flags_system['cPlayer:RcoMachineDailyLoginDays'] == 3:
            Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:101_04', false)
            EventFlowSystemActor.LifeSupportPointCountDown(150, false)
        elif event_flags_system['cPlayer:RcoMachineDailyLoginDays'] == 4:
            Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:101_05', false)
            EventFlowSystemActor.LifeSupportPointCountDown(200, false)
        elif event_flags_system['cPlayer:RcoMachineDailyLoginDays'] == 5:
            Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:101_06', false)
            EventFlowSystemActor.LifeSupportPointCountDown(250, false)
        else:
            Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:101_07', false)
            EventFlowSystemActor.LifeSupportPointCountDown(300, false)
    return

flow RcoMachineOnlineShopping:
    EventFlowSystemActor.UICatalogHandling()
entrypoint Event82:
    fEvent82 = EventFlowSystemActor.IsDeliveryToOthers()
    if fEvent82 == 0:
        run DeliverVillager
    elif fEvent82 == 1:
        if not EventFlowSystemActor.UIIsCatalogBootSmartPhone():
            if event_flags_system['cLifeSupportAchievement:BuyItemCatalog'] < 100:
                run RcoSelSeq
            elif event_flags_system['cPlayer:MainmenuOnlineShopping']:
                run RcoSelSeq
            else:
                Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:071', true)
                run Obj_RcoMachine_MileExchange::RecipeReceiveing1_Receive
                event_flags_system['cPlayer:MainmenuOnlineShopping'] = true
                EventFlowSystemActor.UIMenuDeviceAppear('cInstall', 'cCatalog')
                Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:072', false)
                run Obj_RcoMachine_MileExchange::RecipeReceiveing2_End
                EventFlowSystemActor.ReservePlayerMutterDemo('Get_ShoppingAppli', 'cNowDemoEnd', 'Player_GetDemo_Once', false)
                EventFlowSystemActor.ExitFlowchart()
    elif fEvent82 == 2:
        run DeliverFriend
    return

flow RcoSelSeq:
    run ChkRcoMachineSel
    fEvent49 = subflow_results[0]
    if fEvent49 == 0:
        Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:002_01', false)
        fEvent97 = EventFlowSystemActor.GeneralTalkChoice3()
        if fEvent97 == 0:
            run RcoMachineOnlineShopping
        elif fEvent97 == 1:
            run RcoMachineATM
        elif fEvent97 == 2:
            run SelExit
    elif fEvent49 == 1:
        Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:002', false)
        fEvent6 = EventFlowSystemActor.GeneralTalkChoice4()
        if fEvent6 == 0:
            run Obj_RcoMachine_MileExchange::Root
        elif fEvent6 == 1:
            run RcoMachineOnlineShopping
        elif fEvent6 == 2:
            run RcoMachineATM
        elif fEvent6 == 3:
            run SelExit
    elif fEvent49 == 2:
        Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:008', false)
        fEvent67 = EventFlowSystemActor.GeneralTalkChoice4()
        if fEvent67 == 0:
            run RcoMachineOnlineShopping
        elif fEvent67 == 1:
            run RcoMachineATM
        elif fEvent67 == 2:
            run Obj_RcoMachine_Amiibo::Root
        elif fEvent67 == 3:
            run SelExit
    elif fEvent49 == 3:
        Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:007', false)
        fEvent194 = EventFlowSystemActor.GeneralTalkChoice5()
        if fEvent194 == 0:
            run Obj_RcoMachine_MileExchange::Root
        elif fEvent194 == 1:
            run RcoMachineOnlineShopping
        elif fEvent194 == 2:
            run RcoMachineATM
        elif fEvent194 == 3:
            run Obj_RcoMachine_Amiibo::Root
        elif fEvent194 == 4:
            run SelExit
    return

flow ReSelectDestination:
    run Event221
    return

flow ReSelectDestinationFriend:
    run Event99
    return

flow Restart:
    run Event82
    return

flow RetryDeliverFriend:
    run Event87
    return

flow Root:
    Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:001', false)
    if not EventFlowSystemActor.IsMyVillage():
        Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:001_03', false)
    elif EventFlowSystemActor.PlayerHouseLevel() == 0:
        Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:001_02', false)
    else:
        if not event_flags_system['cPlayer:RcoGotLoginBonusToday']:
            EventFlowSystemActor.UISonkatsuPointAppear()
            run RcoMachineDailyLogin
            EventFlowSystemActor.UISonkatsuPointDisappear()
        event_flags_system['cPlayer:ObjRcoMachineCheck1st'] = true
        if not event_flags_system['cPlayer:RcoPaid1stCharge']:
            run RcoSelSeq
        elif not event_flags_system['cPlayer:RcoMachineEnableExchange']:
            Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:016', false)
            if event_flags_system['cPlayer:MainmenuRndDailyQuest']:
                event_flags_system['cPlayer:OBJRcoMachineChkPlusEnable'] = true
            event_flags_system['cPlayer:RcoMachineEnableExchange'] = true
            run RcoSelSeq
        elif not event_flags_system['cPlayer:MainmenuRndDailyQuest']:
            run RcoSelSeq
        elif not event_flags_system['cPlayer:OBJRcoMachineChkPlusEnable']:
            Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:016_01', false)
            event_flags_system['cPlayer:OBJRcoMachineChkPlusEnable'] = true
            run RcoSelSeq
        elif not event_flags_system['cPlayer:TanuportAmiiboBromideUnlock']:
            run RcoSelSeq
        elif event_flags_system['cPlayer:PrintServiceExplain']:
            run RcoSelSeq
        else:
            Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:581', false)
            event_flags_system['cPlayer:PrintServiceExplain'] = true
            run RcoSelSeq
    return

flow SelExit:
entrypoint Event4:
    EventFlowSystemActor.UISonkatsuPointDisappear()
    Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:003', false)
    return

flow SelExitFromMileExchange:
    run Event4
    return

flow SmaphoCatalogOpenErrorOutsideArea:
    MainNpc.OpenMessageWindow('TalkSys/SYS_PhoneApp:311', false)
    return


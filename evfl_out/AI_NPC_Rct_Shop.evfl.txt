flow Check_Goods:
    MainNpc.NpcAISetting(9, false)
    MainNpc.NpcAISetting(5, false)
    MainNpc.SetNpcSpeakFlow('Root', 'SNPC_rcm_00_Groceries')
    return

flow Check_rct:
    if MainNpc.NpcBlackBoard('CheckItemIndex', 0):
        MainNpc.NpcAISetting(9, false)
        MainNpc.NpcAISetting(5, false)
        MainNpc.SetNpcSpeakFlow('Check', 'SNPC_rcm')
    return

flow Init:
    MainNpc.SetSightRange(64, 0)
    MainNpc.NpcRegistAIBlackBoard('CheckItemIndex', -1)
    MainNpc.NpcAISetting(0, true)
    MainNpc.NpcAISetting(1, true)
    if EventFlowSystemActor.ShopLevel() in (NooksCrannyInitial, NooksCrannyUpgraded):
        MainNpc.NpcRegistAIBlackBoard('GoodsRail', 2)
        MainNpc.NpcAISetRequestSpeakFunc('cEnterRct', true)
        MainNpc.NpcAISetRequestSpeakFunc('cLeaveRct', true)
        MainNpc.NpcAISetRequestSpeakFunc('cItemCheck', true)
        if EventFlowSystemActor.NetIsConnected():
            MainNpc.NpcAISetting(8, true)
            MainNpc.NpcChangeHeadCtrlMode('cPlayer', false)
            fEvent10 = EventFlowSystemActor.ShopLevel()
            if fEvent10 == NooksCrannyInitial:
                MainNpc.NpcAISetPosByRail(6, 1, 0.0, false)
                run sub_grp!Event24
            elif fEvent10 == NooksCrannyUpgraded:
                MainNpc.NpcAISetPosByRail(3, 1, -100.0, true)
                run sub_grp!Event24
        else:
            MainNpc.NpcAISetting(8, false)
            run sub_grp!Event24
    return

flow Rct_Wait:
    MainNpc.NpcChangeAIState('cRct', 'SNPC_rcm', 'Root', '', false, true)
    MainNpc.NpcAISetting(3, true)
    MainNpc.NpcAISetting(2, true)
    MainNpc.NpcChangeHeadCtrlMode('cPlayer', false)
    return

flow Root:
    if (MainNpc.NpcCheckStateSelectTiming('cInit')) and (MainNpc.HghFreeQuery2('cHghQueryType_HghStayMarket')):
        MainNpc.NpcAISetting(3, false)
        MainNpc.NpcAISetting(2, false)
        MainNpc.NpcChangeConversationPretenseState('cConversationPretense', 'Root', 'SNPC_rcm', '', false, true, 0, 'hgh')
    else:
        run Rct_Wait
    return

flow sub_grp!Event24:
    if MainNpc.HghFreeQuery2('cHghQueryType_HghStayMarket'):
        MainNpc.NpcAISetPosByRail(5, 1, 0.0, false)


flow Root:
    event_flags_system['cLand:PortableRadioControl'] = true
    run Tkk_Dream_BeforeTalk
    run Tkk_Dream_Talk
    run Tkk_Dream_AfterTalk
    return

flow Tkk_Dream_BeforeTalk:
    EventFlowSystemActor.BGMPropertyControl(14)
    EventFlowSystemActor.CameraSetDemoParam('CameraTag:Root', 'CutSpotlight', '', false, false, false, 0)
    MainNpc.NpcRequestAction(1)
    EventFlowSystemActor.WaitFrame(150)
    EventFlowSystemActor.SystemFaderRelease()
    EventFlowSystemActor.WaitFrame(120)
    EventFlowSystemActor.BGMPropertyControl(18)
    MainNpc.RequestSimple('TkkAGuitarPlayEnd', false)
    EventFlowSystemActor.WaitFrame(30)
    MainNpc.NpcRequestAction(0)
    return

flow Tkk_Dream_Talk:
    MainNpc.OpenMessageWindow('TalkSNpc/tkk/SP_tkk_dream:001', false)
    MainNpc.OpenMessageWindow('TalkSNpc/tkk/SP_tkk_dream:002', false)
    MainNpc.OpenMessageWindow('TalkSNpc/tkk/SP_tkk_dream:003', false)
    MainNpc.OpenMessageWindow('TalkSNpc/tkk/SP_tkk_dream:004', false)
    MainNpc.OpenMessageWindow('TalkSNpc/tkk/SP_tkk_dream:005', false)
    MainNpc.OpenMessageWindow('TalkSNpc/tkk/SP_tkk_dream:006', false)
    MainNpc.OpenMessageWindow('TalkSNpc/tkk/SP_tkk_dream:007', true)
    return

flow Tkk_Dream_AfterTalk:
    EventFlowSystemActor.BGMPropertyControl(14)
    MainNpc.NpcRequestAction(1)
    EventFlowSystemActor.WaitFrame(120)
    EventFlowSystemActor.BGMPropertyControl(15)
    EventFlowSystemActor.SoundTriggerEmit('ReturnFromDream', -1)
    EventFlowSystemActor.ReserveNpcCommand('PrologueNextDayAwake')
    event_flags_system['cPlayer:PrologueFinishTkkDream'] = true
    if event_flags_system['cPlayer:MakeVillagePlayerFlag']:
        MainNpc.NpcSetRewardRecipe(7142, false)
        EventFlowSystemActor.SystemMailSendDirect('cNintendo', 'MAIL_SP_Nintendo', 'cReward', 1)
        EventFlowSystemActor.StartupMailSend(true, true, true)
    event_flags_system['cLand:Tutorial1PTentLightON'] = true
    EventFlowSystemActor.TimeLock('cUnlockDemo')
    EventFlowSystemActor.ReturnStage('', 'cNormalFader', 'cNormalFader', 'cBlack', 0.10000000149011612, 0.10000000149011612)
    return


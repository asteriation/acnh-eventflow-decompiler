flow Init:
    MainNpc.NpcRegistAIBlackBoard('CheckRobResult', 0)
    MainNpc.NpcRegistAIBlackBoard('Visible', 1)
    if not event_flags_system['cLandTemp:IsFirstPrologue']:
        MainNpc.NpcRegistAIBlackBoard('TalkCount', 0)
        MainNpc.NpcRegistAIBlackBoard('isSpeak', 0)
        MainNpc.NpcAISetting(8, true)
        MainNpc.NpcAISetting(1, true)
    elif event_flags_system['cLand:SetPrologueBonfire']:
        MainNpc.NpcRegistAIBlackBoard('TalkCount', 1)
        if event_flags_system['cLandTemp:PrologueStartedCampfire']:
            MainNpc.NpcRegistAIBlackBoard('isSpeak', 0)
            MainNpc.NpcAISetting(8, true)
            MainNpc.NpcAISetting(1, true)
            if EventFlowSystemActor.SystemCheckNowStage('cField'):
                MainNpc.NpcAISetCheckRobFunc('System_Door_TanukichiTent', 'Message', '', 'cTanukichiDoorRob', false, false)
                MainNpc.NpcAISetCheckRobFunc('Tutorials_Prologue3_Orientation1', 'Root', 'CheckRobTalk', 'cTanukichiPrologueTalkRob', false, false)
                MainNpc.NpcAISetCheckRobFunc('Tutorials_Prologue_Rco_Stop', 'Rco_StopBbs', '', 'cTanukichiPrologueBulletinBoard', false, false)
                MainNpc.NpcAISetRequestSpeakFunc('cKeepBackPlaza', false)
        else:
            MainNpc.NpcRegistAIBlackBoard('isSpeak', 1)
            MainNpc.NpcAISetting(8, true)
            MainNpc.NpcAISetting(1, true)
            if EventFlowSystemActor.SystemCheckNowStage('cField'):
                MainNpc.NpcAISetCheckRobFunc('System_Door_TanukichiTent', 'Message', '', 'cTanukichiDoorRob', false, false)
                MainNpc.NpcAISetCheckRobFunc('Tutorials_Prologue3_Orientation1', 'Root', 'CheckRobTalk', 'cTanukichiPrologueTalkRob', false, false)
                MainNpc.NpcAISetCheckRobFunc('Tutorials_Prologue_Rco_Stop', 'Rco_StopBbs', '', 'cTanukichiPrologueBulletinBoard', false, false)
                MainNpc.NpcAISetRequestSpeakFunc('cKeepBackPlaza', false)
    else:
        MainNpc.NpcRegistAIBlackBoard('TalkCount', 0)
        MainNpc.NpcRegistAIBlackBoard('isSpeak', 0)
        MainNpc.NpcAISetting(8, true)
        MainNpc.NpcAISetting(1, true)
        if EventFlowSystemActor.SystemCheckNowStage('cField'):
            MainNpc.NpcAISetCheckRobFunc('System_Door_TanukichiTent', 'Message', '', 'cTanukichiDoorRob', false, false)
            MainNpc.NpcAISetCheckRobFunc('Tutorials_Prologue3_Orientation1', 'Root', 'CheckRobTalk', 'cTanukichiPrologueTalkRob', false, false)
            MainNpc.NpcAISetCheckRobFunc('Tutorials_Prologue_Rco_Stop', 'Rco_StopBbs', '', 'cTanukichiPrologueBulletinBoard', false, false)
            MainNpc.NpcAISetRequestSpeakFunc('cKeepBackPlaza', false)
    return

flow Root:
    if not MainNpc.NpcBlackBoard('Visible', 1):
        MainNpc.NpcChangeAIState('cInvisible', '', '', '', false, true)
    elif MainNpc.NpcBlackBoard('TalkCount', 1):
        MainNpc.NpcAISetCheckRobFunc('Tutorials_Prologue_Rco', 'Prologue4_AfterBuiltTent', 'CheckRobTalk2', 'cTanukichiPrologueTalkRob', false, false)
        if MainNpc.NpcBlackBoard('isSpeak', 1):
            MainNpc.NpcSetAIBlackBoard('isSpeak', 0)
            MainNpc.NpcAISetting(4, false)
            MainNpc.NpcAISetting(2, false)
            MainNpc.NpcAISetting(3, false)
            MainNpc.NpcAISetting(5, false)
            MainNpc.NpcAISetting(7, false)
            MainNpc.NpcAddBlackBoard('isSpeak', 0)
            if event_flags_system['cPlayer:HaveTownFruit4CampFire']:
                EventFlowSystemActor.CameraSetDemoParam('Npc:rco', 'EventPlazaCampFire', '', true, false, false, 0)
                run AI_NPC_Common::ContinueSpeak
            else:
                run AI_NPC_Common::ContinueSpeak
        else:
            MainNpc.NpcAISetting(7, true)
            if not event_flags_system['cLandTemp:PrologueStartedCampfire']:
                MainNpc.NpcChangeTurnDefaultState('cTurn', '', 'Root', 'Tutorials_Prologue_Rco', true, false, true, 2, 0.0, '')
            elif MainNpc.NpcCheckStateSelectTiming('cTalkEnd'):
                MainNpc.NpcChangeTurnDefaultState('cTurn', '', 'Root', 'Tutorials_Prologue_Rco', false, false, false, 1, 0.0, '')
            else:
                MainNpc.NpcChangeAIStateCstm('Tutorials_Prologue_Rco', 'Root', 1, 'Angle:0')
    elif MainNpc.NpcBlackBoard('isSpeak', 1):
        MainNpc.NpcSetAIBlackBoard('isSpeak', 0)
        run AI_NPC_Common::ContinueSpeak
    else:
        MainNpc.NpcAISetting(6, false)
        MainNpc.NpcChangeTurnDefaultState('cTurn', '', 'Root', 'Tutorials_Prologue3_Orientation1', true, false, true, 2, 0.0, '')
    return

flow CheckRobTalk:
    if event_flags_system['cPlayerTemp:PrologueArrivalTalked']:
        MainNpc.NpcSetAIBlackBoard('CheckRobResult', 1)
    else:
        MainNpc.NpcSetAIBlackBoard('CheckRobResult', 0)
    return

flow CheckRobTalk2:
    if (event_flags_system['cLand:Prologue4BuiltPlayer']) and (not event_flags_system['cPlayer:PrologueAfterBuiltTentTalk']):
        MainNpc.NpcSetAIBlackBoard('CheckRobResult', 1)
    else:
        MainNpc.NpcSetAIBlackBoard('CheckRobResult', 0)
    return


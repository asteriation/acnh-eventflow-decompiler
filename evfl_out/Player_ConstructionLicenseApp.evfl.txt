flow CheckCliffNotice:
    run Event35
    return

flow CheckManualList:
    if event_flags_system['cPlayer:GetLicenseRiver']:
        if event_flags_system['cPlayer:GetLicenseCliff']:
            subflow_results[0] = 3
        else:
            subflow_results[0] = 1
    elif event_flags_system['cPlayer:GetLicenseCliff']:
        subflow_results[0] = 2
    else:
        subflow_results[0] = 0
    return

flow CheckNotice:
    if not event_flags_system['cPlayer:Mobile1stBoot_IslandCreater']:
        EventFlowSystemActor.OpenMessageWindow('Dialog/DIALOG_Msg:5111', false)
        event_flags_system['cPlayer:Mobile1stBoot_IslandCreater'] = true
    if event_flags_system['cPlayer:ConstructionWorkToday']:
        if event_flags_system['cPlayer:NoticeAboutLicenseRiver']:
entrypoint Event35:
            if (not event_flags_system['cPlayer:NoticeAboutLicenseCliff']) and (event_flags_system['cPlayer:GetLicenseCliff']):
                MainNpc.OpenMessageWindow('TalkSys/SYS_PhoneApp:223', false)
                event_flags_system['cPlayer:NoticeAboutLicenseCliff'] = true
                run sub_grp!Event114
        elif not event_flags_system['cPlayer:GetLicenseRiver']:
            run CheckCliffNotice
        elif event_flags_system['cPlayer:NoticeAboutLicenseCliff']:
entrypoint Event41:
            MainNpc.OpenMessageWindow('TalkSys/SYS_PhoneApp:222', false)
            event_flags_system['cPlayer:NoticeAboutLicenseRiver'] = true
            run sub_grp!Event114
        elif event_flags_system['cPlayer:GetLicenseCliff']:
            MainNpc.OpenMessageWindow('TalkSys/SYS_PhoneApp:224', false)
            event_flags_system['cPlayer:NoticeAboutLicenseCliff'] = true
            event_flags_system['cPlayer:NoticeAboutLicenseRiver'] = true
            run sub_grp!Event114
        else:
            run OnlyRiverNotice
    return

flow CheckWhere:
    if EventFlowSystemActor.SystemCheckNowStage('cField'):
        subflow_results[1] = 0
    elif (not EventFlowSystemActor.SystemCheckNowStage('cPhotoStudioIsland')) and (not EventFlowSystemActor.SystemCheckNowStage('cMysteryTourIsland')):
        subflow_results[1] = 1
    else:
        subflow_results[1] = 2
    return

flow CleanService:
    if subflow_results[1] != 0:
        MainNpc.OpenMessageWindow('TalkSys/SYS_PhoneApp:266', false)
        run Restart
    elif event_flags_system['cPlayer:1stBootIslandCreaterCleanService']:
        MainNpc.OpenMessageWindow('TalkSys/SYS_PhoneApp:262', false)
        if EventFlowSystemActor.GeneralTalkChoice2() == 0:
            MainNpc.OpenMessageWindow('TalkSys/SYS_PhoneApp:263', true)
            EventFlowSystemActor.FadeOut('cCircle', 'cCircle', 'cBlack', 1.2000000476837158, 1.2000000476837158, true)
            EventFlowSystemActor.ItemRemove()
            EventFlowSystemActor.WaitFrame(20)
            if EventFlowSystemActor.ItemRemove():
                EventFlowSystemActor.SoundTriggerEmit('CleanFinish', -1)
            EventFlowSystemActor.FadeIn(true)
            if EventFlowSystemActor.ItemRemove():
                MainNpc.OpenMessageWindow('TalkSys/SYS_PhoneApp:264', false)
            else:
                MainNpc.OpenMessageWindow('TalkSys/SYS_PhoneApp:265', false)
            Player.SmartPhone(1)
        else:
            run Restart
    else:
        MainNpc.OpenMessageWindow('TalkSys/SYS_PhoneApp:261', false)
        event_flags_system['cPlayer:1stBootIslandCreaterCleanService'] = true
        MainNpc.OpenMessageWindow('TalkSys/SYS_PhoneApp:262', false)
        if EventFlowSystemActor.GeneralTalkChoice2() == 0:
            MainNpc.OpenMessageWindow('TalkSys/SYS_PhoneApp:263', true)
            EventFlowSystemActor.FadeOut('cCircle', 'cCircle', 'cBlack', 1.2000000476837158, 1.2000000476837158, true)
            EventFlowSystemActor.ItemRemove()
            EventFlowSystemActor.WaitFrame(20)
            if EventFlowSystemActor.ItemRemove():
                EventFlowSystemActor.SoundTriggerEmit('CleanFinish', -1)
            EventFlowSystemActor.FadeIn(true)
            if EventFlowSystemActor.ItemRemove():
                MainNpc.OpenMessageWindow('TalkSys/SYS_PhoneApp:264', false)
            else:
                MainNpc.OpenMessageWindow('TalkSys/SYS_PhoneApp:265', false)
            Player.SmartPhone(1)
        else:
            run Restart
    return

flow Construction_Manual:
    run CheckManualList
    fEvent52 = subflow_results[0]
    if fEvent52 == 0:
        MainNpc.OpenMessageWindow('TalkSys/SYS_PhoneApp:251', false)
        fEvent83 = EventFlowSystemActor.GeneralTalkChoice4()
        if fEvent83 == 3:
            run Restart
        elif fEvent83 == 2:
            run Manual_CleanService
        elif fEvent83 == 0:
            run Manual_Basic
        elif fEvent83 == 1:
            run Manual_Ground
    elif fEvent52 == 1:
        MainNpc.OpenMessageWindow('TalkSys/SYS_PhoneApp:251_01', false)
        fEvent81 = EventFlowSystemActor.GeneralTalkChoice5()
        if fEvent81 == 3:
            run Manual_CleanService
        elif fEvent81 == 0:
            run Manual_Basic
        elif fEvent81 == 1:
            run Manual_Ground
        elif fEvent81 == 2:
            run Manual_River
        elif fEvent81 == 4:
            run Restart
    elif fEvent52 == 2:
        MainNpc.OpenMessageWindow('TalkSys/SYS_PhoneApp:251_02', false)
        fEvent82 = EventFlowSystemActor.GeneralTalkChoice5()
        if fEvent82 == 4:
            run Restart
        elif fEvent82 == 3:
            run Manual_CleanService
        elif fEvent82 == 0:
            run Manual_Basic
        elif fEvent82 == 1:
            run Manual_Ground
        elif fEvent82 == 2:
            run Manual_Cliff
    elif fEvent52 == 3:
        MainNpc.OpenMessageWindow('TalkSys/SYS_PhoneApp:251_03', false)
        fEvent73 = EventFlowSystemActor.GeneralTalkChoice6()
        if fEvent73 == 4:
            run Manual_CleanService
        elif fEvent73 == 0:
            run Manual_Basic
        elif fEvent73 == 1:
            run Manual_Ground
        elif fEvent73 == 2:
            run Manual_River
        elif fEvent73 == 3:
            run Manual_Cliff
        elif fEvent73 == 5:
            run Restart
    return

flow End_Construction:
    MainNpc.OpenMessageWindow('TalkSys/SYS_PhoneApp:210', false)
    MainNpc.OpenMessageWindow('TalkSys/SYS_PhoneApp:211', true)
    Player.PlayerChangeDemoState('cEndSmartPhoneMenuDucking')
    Player.SmartPhone(1)
    event_flags_system['cPlayer:EquipLicenseHelmet'] = false
    Player.PlayerOutfitFieldMakeToolKit('cOff')
    return

flow EquipLicense:
    if event_flags_system['cPlayer:LastUseLicense'] == 3:
        Player.PlayerOutfitFieldMakeToolKit('cCliff')
    elif event_flags_system['cPlayer:LastUseLicense'] == 2:
        Player.PlayerOutfitFieldMakeToolKit('cRiver')
    else:
        event_flags_system['cPlayer:LastUseLicense'] = 1
        Player.PlayerOutfitFieldMakeToolKit('cGround')
    return

flow Manual_Basic:
    MainNpc.OpenMessageWindow('TalkSys/SYS_PhoneApp:241', false)
    if EventFlowSystemActor.IsSoloPlayController():
        MainNpc.OpenMessageWindow('TalkSys/SYS_PhoneApp:241_01_00', false)
    else:
        MainNpc.OpenMessageWindow('TalkSys/SYS_PhoneApp:241_01_01', false)
    MainNpc.OpenMessageWindow('TalkSys/SYS_PhoneApp:241_02', false)
entrypoint Event93:
    run Construction_Manual
    return

flow Manual_CleanService:
    MainNpc.OpenMessageWindow('TalkSys/SYS_PhoneApp:245', false)
    run Event93
    return

flow Manual_Cliff:
    if EventFlowSystemActor.IsSoloPlayController():
        MainNpc.OpenMessageWindow('TalkSys/SYS_PhoneApp:244', false)
        run Event93
    else:
        MainNpc.OpenMessageWindow('TalkSys/SYS_PhoneApp:244_01', false)
        run Event93
    return

flow Manual_Ground:
    if EventFlowSystemActor.IsSoloPlayController():
        MainNpc.OpenMessageWindow('TalkSys/SYS_PhoneApp:242', false)
        MainNpc.OpenMessageWindow('TalkSys/SYS_PhoneApp:242_01_00', false)
        run Event93
    else:
        MainNpc.OpenMessageWindow('TalkSys/SYS_PhoneApp:242_00_01', false)
        MainNpc.OpenMessageWindow('TalkSys/SYS_PhoneApp:242_01_01', false)
        run Event93
    return

flow Manual_River:
    if EventFlowSystemActor.IsSoloPlayController():
        MainNpc.OpenMessageWindow('TalkSys/SYS_PhoneApp:243', false)
        run Event93
    else:
        MainNpc.OpenMessageWindow('TalkSys/SYS_PhoneApp:243_01', false)
        run Event93
    return

flow NotServiceArea:
    run sub_Event20
    return

flow OnlyRiverNotice:
    run Event41
    return

flow Restart:
    run Event74
    return

flow Root:
    if EventFlowSystemActor.IsMyVillage():
        run CheckWhere
        fEvent160 = subflow_results[1]
        if fEvent160 == 1:
            if event_flags_system['cPlayer:EquipLicenseHelmet']:
                run sub_grp!Event3
            else:
                run sub_Event20
        elif fEvent160 == 2:
            run sub_Event20
        elif fEvent160 == 0:
            run sub_grp!Event3
    else:
        run sub_Event20
    return

flow SaveEquipLicense:
    fEvent102 = Player.PlayerOutfitFieldMakeToolKit()
    if fEvent102 == 0:
        event_flags_system['cPlayer:LastUseLicense'] = 0
    elif fEvent102 == 3:
        event_flags_system['cPlayer:LastUseLicense'] = 1
    elif fEvent102 == 2:
        event_flags_system['cPlayer:LastUseLicense'] = 2
    elif fEvent102 == 1:
        event_flags_system['cPlayer:LastUseLicense'] = 3
    return

flow Start_Construction:
    if EventFlowSystemActor.SystemCheckNowStage('cField'):
        MainNpc.OpenMessageWindow('TalkSys/SYS_PhoneApp:202', false)
        if event_flags_system['cPlayer:ConstructionWorkToday']:
            MainNpc.OpenMessageWindow('TalkSys/SYS_PhoneApp:202_01', true)
        else:
            MainNpc.OpenMessageWindow('TalkSys/SYS_PhoneApp:221', false)
            if EventFlowSystemActor.IsSoloPlayController():
                MainNpc.OpenMessageWindow('TalkSys/SYS_PhoneApp:221_01', true)
            else:
                MainNpc.OpenMessageWindow('TalkSys/SYS_PhoneApp:221_02', false)
            if event_flags_system['cPlayer:GetLicenseRiver']:
                event_flags_system['cPlayer:NoticeAboutLicenseRiver'] = true
            if event_flags_system['cPlayer:GetLicenseCliff']:
                event_flags_system['cPlayer:NoticeAboutLicenseCliff'] = true
            event_flags_system['cPlayer:ConstructionWorkToday'] = true
        Player.PlayerChangeDemoState('cEndSmartPhoneMenuDucking')
        Player.SmartPhone(1)
        event_flags_system['cPlayer:EquipLicenseHelmet'] = true
        run EquipLicense
    else:
        MainNpc.OpenMessageWindow('TalkSys/SYS_PhoneApp:206', false)
        MainNpc.OpenMessageWindow('TalkSys/SYS_PhoneApp:209', false)
    return

flow sub_Event20:
    MainNpc.OpenMessageWindow('TalkSys/SYS_PhoneApp:209', false)
    return

flow sub_grp!Event114:
    if EventFlowSystemActor.IsSoloPlayController():
        MainNpc.OpenMessageWindow('TalkSys/SYS_PhoneApp:225', false)
    else:
        MainNpc.OpenMessageWindow('TalkSys/SYS_PhoneApp:225_01', false)

flow sub_grp!Event3:
    if EventFlowSystemActor.NetHasVisitor():
        Player.OpenMessageWindow('TalkSys/SYS_PhoneApp:213', false)
    elif EventFlowSystemActor.NetIsConnected():
        if EventFlowSystemActor.IsVillageGateOpened():
            Player.OpenMessageWindow('TalkSys/SYS_PhoneApp:212', false)
        else:
            Player.OpenMessageWindow('TalkSys/SYS_PhoneApp:214', false)
    elif Player.PlayerCheckWaitType('cStand'):
        if subflow_results[1] == 0:
            run CheckNotice
entrypoint Event74:
        if event_flags_system['cPlayer:EquipLicenseHelmet']:
            run SaveEquipLicense
            Player.OpenMessageWindow('TalkSys/SYS_PhoneApp:205', false)
            fEvent76 = EventFlowSystemActor.GeneralTalkChoice4()
            if fEvent76 == 1:
                run CleanService
            elif fEvent76 == 0:
                run End_Construction
            elif fEvent76 == 2:
                run Construction_Manual
        else:
            Player.OpenMessageWindow('TalkSys/SYS_PhoneApp:201', false)
            fEvent63 = EventFlowSystemActor.GeneralTalkChoice4()
            if fEvent63 == 1:
                run CleanService
            elif fEvent63 == 0:
                run Start_Construction
            elif fEvent63 == 2:
                run Construction_Manual
    elif Player.PlayerCheckWaitType('cSwim'):
        MainNpc.OpenMessageWindow('TalkSys/SYS_PhoneApp:206', false)
        MainNpc.OpenMessageWindow('TalkSys/SYS_PhoneApp:207_01', false)
    else:
        MainNpc.OpenMessageWindow('TalkSys/SYS_PhoneApp:206', false)
        Player.OpenMessageWindow('TalkSys/SYS_PhoneApp:207', false)


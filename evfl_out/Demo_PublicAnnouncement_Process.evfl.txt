flow BGMChangeCheck:
    if event_flags_system['cLand:BuiltTownOffice']:
        event_flags_system['cLand:SzaTaled1stTimeAnyPlayer'] = true
        event_flags_system['cLand:OpeningSeqBGMChangeCounter'] = 99
    elif event_flags_system['cLand:OpeningSeqBGMChangeCounter'] <= 8:
        if EventFlowSystemActor.PlayerHouseLevel() in (2, 3, 4, 5, 6, 7, 8):
            event_flags_system['cLand:OpeningSeqBGMChangeCounter'] = 9
    elif EventFlowSystemActor.NpcHouseNum('cConstructed') < 3:
        if not EventFlowSystemActor.NpcHouseNum('cConstructed') < 4:
            event_flags_system['cLand:OpeningSeqBGMChangeCounter'] = 12
        elif not EventFlowSystemActor.NpcHouseNum('cConstructed') < 5:
            event_flags_system['cLand:OpeningSeqBGMChangeCounter'] = 13
        elif event_flags_system['cLand:OpeningSeqBGMChangeCounter'] <= 14:
            event_flags_system['cLand:OpeningSeqBGMChangeCounter'] = 14
    elif EventFlowSystemActor.ShopLevel() in (NooksCrannyInitial, NooksCrannyUpgraded):
        event_flags_system['cLand:OpeningSeqBGMChangeCounter'] = 11
    return

flow BocKabuBuyCount:
    if event_flags_system['cPlayer:BocAllowAddBuyCount']:
        event_flags_system['cPlayer:BocBuyCount'] += 1
        event_flags_system['cPlayer:BocAllowAddBuyCount'] = false
    return

flow CheckPhoneCallIslandCreater:
    if (event_flags_system['cLand:TkkFirstLive']) and (not event_flags_system['cPlayer:MainmenuConstructLicense']):
        fEvent212 = EventFlowSystemActor.EventBranch(false, 0)
        if fEvent212 == 3:
            event_flags_system['cPlayer:StandByPhoneCallIslandCreater'] = false
            event_flags_system['cPlayer:StandByGameStartPhoneCall'] = false
        elif fEvent212 in (0, 1, 2, 4, 5, 6, 7):
            if not event_flags_system['cPlayer:StandByRcoVisitMyHomeAfterTkkFirstLive']:
                event_flags_system['cPlayer:StandByPhoneCallIslandCreater'] = true
                event_flags_system['cPlayer:StandByGameStartPhoneCall'] = true
            elif EventFlowSystemActor.PlayerHouseLevel() == 0:
                event_flags_system['cPlayer:StandByRcoVisitMyHomeAfterTkkFirstLive'] = false
                event_flags_system['cPlayer:StandByPhoneCallIslandCreater'] = true
                event_flags_system['cPlayer:StandByGameStartPhoneCall'] = true
                EventFlowSystemActor.SelectRewardItemDirect(4318, 1, 'cVillageRemakePattern', 0)
                EventFlowSystemActor.SystemMailSend('cRco', 'MAIL_SNpc_rco', 'cFastToday', 'cReward', 'cNone', false, 4)
    return

flow CheckPhoneCallJuneBride:
    if (EventFlowSystemActor.TermEventNow('JuneBride', false)) and (event_flags_system['cPlayer:CommuneIslandAvailable']) and ((not event_flags_system['cPlayer:SpnTalkAtHomelandToday']) or (event_flags_system['cPlayer:VisitedCommune'])):
        run sub_grp!Event242
    return

flow CheckPhoneCallPrintService:
    if event_flags_system['cPlayer:StandByPhoneCallPrintService']:
        event_flags_system['cPlayer:StandByGameStartPhoneCall'] = true
    return

flow CheckPhoneCallPurchaseBox:
    if event_flags_system['cPlayer:StandByPhoneCallPurchaseBox']:
        event_flags_system['cPlayer:StandByGameStartPhoneCall'] = true
    return

flow CheckPhoneCallSharePlay:
    if (EventFlowSystemActor.PlayerVillagerCount(2)) and (not event_flags_system['cPlayer:MainmenuCall']):
        event_flags_system['cPlayer:StandByPhoneCallSharePlay'] = true
        event_flags_system['cPlayer:StandByGameStartPhoneCall'] = true
    return

flow ChkGoldenToolRecipe_GoldenNet:
    if (not event_flags_system['cPlayer:GoldenNetRecipeSent']) and (event_flags_system['cPlayer:CompleteInsects']):
        EventFlowSystemActor.NpcSetRewardRecipe(8179, false)
        EventFlowSystemActor.SystemMailSend('cFarwayMuseum', 'MAIL_SP_FarawayMuseum', 'cFastToday', 'cReward', 'cNone', false, 1)
        event_flags_system['cPlayer:GoldenNetRecipeSent'] = true
    return

flow ChkGoldenToolRecipe_GoldenRod:
    if (not event_flags_system['cPlayer:GoldenRodRecipeSent']) and (event_flags_system['cPlayer:CompleteFish']):
        EventFlowSystemActor.NpcSetRewardRecipe(8660, false)
        EventFlowSystemActor.SystemMailSend('cFarwayMuseum', 'MAIL_SP_FarawayMuseum', 'cFastToday', 'cReward', 'cNone', false, 2)
        event_flags_system['cPlayer:GoldenRodRecipeSent'] = true
    return

flow ChkStartGamePhoneCall:
    run CheckPhoneCallIslandCreater
    run CheckPhoneCallSharePlay
    run CheckPhoneCallPrintService
    run CheckPhoneCallPurchaseBox
    run CheckPhoneCallJuneBride
    return

flow EnableTailorBuild:
    if (event_flags_system['cLand:CountTailorBuild'] >= 3) and (event_flags_system['cPlayer:MakeVillagePlayerFlag']) and (event_flags_system['cPlayer:KinuyoTalkBoforeFlag']):
        event_flags_system['cLand:EnableTailorBuild'] = true
    return

flow Enable_BuildOfficeIntroduction:
    if (event_flags_system['cLand:RcmImmQuestComplete']) and (EventFlowSystemActor.NpcHouseNum('cConstructed') < 5) and (EventFlowSystemActor.MuseumLevel() in (BlathersTent, BlathersMuseumNoArt, BlathersMuseumArt)):
        event_flags_system['cLand:RcoNoticeBuildInfomationOffice'] = true
    return

flow FixMcat11233:
    if (event_flags_system['cPlayer:MainmenuRecipe']) and (not EventFlowSystemActor.PlayerHasCraftRecipe(4376, '')):
        event_flags_system['cPlayer:PAnnounce_SummerShell'] = false
    return

flow Flag_Autumn:
    event_flags_system['cPlayer:PAnnounce_AutumnMushroom'] = false
    event_flags_system['cPlayer:PAnnounce_AutumnRedLeaf'] = false
    return

flow Flag_Nuts:
    if not MainNpc.EnvPublicAnnouncement('cEnvAnnounceQueryType_Acorn'):
        event_flags_system['cPlayer:PAnnounce_AutumnNuts'] = false
    return

flow Flag_Ornaments:
    event_flags_system['cPlayer:PAnnounce_WinterOrnament'] = false
    return

flow Flag_Spring:
    event_flags_system['cPlayer:PAnnounce_SpringSakura'] = false
    return

flow Flag_SpringBamboo:
    if not MainNpc.EnvPublicAnnouncement('cEnvAnnounceQueryType_BambooSpring'):
        event_flags_system['cPlayer:PAnnounce_SpringBamboo'] = false
    return

flow Flag_Summer:
    event_flags_system['cPlayer:PAnnounce_SummerShell'] = false
    return

flow Flag_Winter:
    event_flags_system['cPlayer:PAnnounce_WinterSnowFlake'] = false
    event_flags_system['cPlayer:PAnnounce_WinterSnowball'] = false
    return

flow HgsFriendship:
    if event_flags_system['cPlayer:HgsAllowAddFriendship']:
        event_flags_system['cPlayer:HgsCloseness'] += 1
        event_flags_system['cPlayer:HgsAllowAddFriendship'] = false
    return

flow HouseFacilityMoveReset:
    if event_flags_system['cPlayer:RcoMoveHousingSetSomeBuild']:
        event_flags_system['cPlayer:RcoMoveHouseReserved'] = false
        event_flags_system['cPlayer:RcoMoveSomeBuiding'] = false
        event_flags_system['cPlayer:RcoMoveHousingSetSomeBuild'] = false
    return

flow ImmQEndChk:
    if (event_flags_system['cLand:ImmQ_A_Complete']) and (event_flags_system['cLand:ImmQ_B_Complete']) and (event_flags_system['cLand:ImmQ_C_Complete']):
        event_flags_system['cLand:RcmImmQuestComplete'] = true
        event_flags_system['cLand:RcmImmQuestRunning'] = false
        if not event_flags_system['cLand:TodayImmQNotClear']:
            event_flags_system['cLand:ImmQClearNextDay'] = true
            if (event_flags_system['cPlayer:ImmQRunningForPlayer']) and (not event_flags_system['cPlayer:ImmQTalkAboutPrize']):
                event_flags_system['cPlayer:RcoStayMyHouseImmQClear'] = true
    else:
        event_flags_system['cLand:TodayImmQNotClear'] = true
    return

flow ImmQFtrChk:
    if event_flags_system['cLand:RcmImmQuestRunning']:
        run ImmQFtrChkA
        run ImmQFtrChkB
        run ImmQFtrChkC
    run ImmQEndChk
    return

flow ImmQFtrChkA:
    if (not event_flags_system['cLand:ImmQ_A_Complete']) and (EventFlowSystemActor.IsSettlerQuestOutsideComplete(0, 3)) and (event_flags_system['cLand:ImmQ_A_Interior1Donate']) and (event_flags_system['cLand:ImmQ_A_Interior2Donate']) and (event_flags_system['cLand:ImmQ_A_Interior3Donate']) and (not event_flags_system['cLand:TodayImmQNotClear']):
        EventFlowSystemActor.CompleteSettlerQuestSubject(0)
        EventFlowSystemActor.DecideSettlerNpc(0)
    return

flow ImmQFtrChkB:
    if (not event_flags_system['cLand:ImmQ_B_Complete']) and (EventFlowSystemActor.IsSettlerQuestOutsideComplete(1, 3)) and (event_flags_system['cLand:ImmQ_B_Interior1Donate']) and (event_flags_system['cLand:ImmQ_B_Interior2Donate']) and (event_flags_system['cLand:ImmQ_B_Interior3Donate']) and (not event_flags_system['cLand:TodayImmQNotClear']):
        EventFlowSystemActor.CompleteSettlerQuestSubject(1)
        EventFlowSystemActor.DecideSettlerNpc(1)
    return

flow ImmQFtrChkC:
    if (not event_flags_system['cLand:ImmQ_C_Complete']) and (EventFlowSystemActor.IsSettlerQuestOutsideComplete(2, 3)) and (event_flags_system['cLand:ImmQ_C_Interior1Donate']) and (event_flags_system['cLand:ImmQ_C_Interior2Donate']) and (event_flags_system['cLand:ImmQ_C_Interior3Donate']) and (not event_flags_system['cLand:TodayImmQNotClear']):
        EventFlowSystemActor.CompleteSettlerQuestSubject(2)
        EventFlowSystemActor.DecideSettlerNpc(2)
    return

flow IslandEvaluationUpdateChk:
    if (event_flags_system['cLand:IslandEvaluationUnlock']) and (not event_flags_system['cLand:SzaIslandEvaluationTodayRankUpdate']):
        run System_IslandEvaluationCheck::ChkEvaluationImprovement
        event_flags_system['cLand:SzaIslandEvaluationTodayRankUpdate'] = true
    return

flow MuseumGrouUpChk:
    if (event_flags_system['cLand:MuseumConstructionToday']) or (EventFlowSystemActor.MuseumLevel() in (BlathersMuseumNoArt, BlathersMuseumArt)):
        event_flags_system['cLand:MarketSellRecipeScoopStick'] = true
    return

flow MyHomeChk:
    if EventFlowSystemActor.PlayerHouseLevel() in (2, 3, 4, 5, 6, 7, 8):
        event_flags_system['cPlayer:BuiltMyHome'] = true
    return

flow OwsChkMonthlyFlag:
    fEvent24 = EventFlowSystemActor.EnvConstellation('cGrowUpTime')
    if fEvent24 == Capricorn:
        if event_flags_system['cPlayer:OwsThisZodiac'] != 1:
            event_flags_system['cPlayer:OwsPresentThisZodiacRecipe'] = false
            event_flags_system['cPlayer:OwsThisZodiac'] = 1
    elif fEvent24 == Aquarius:
        if event_flags_system['cPlayer:OwsThisZodiac'] != 2:
            event_flags_system['cPlayer:OwsPresentThisZodiacRecipe'] = false
            event_flags_system['cPlayer:OwsThisZodiac'] = 2
    elif fEvent24 == Pisces:
        if event_flags_system['cPlayer:OwsThisZodiac'] != 3:
            event_flags_system['cPlayer:OwsPresentThisZodiacRecipe'] = false
            event_flags_system['cPlayer:OwsThisZodiac'] = 3
    elif fEvent24 == Aries:
        if event_flags_system['cPlayer:OwsThisZodiac'] != 4:
            event_flags_system['cPlayer:OwsPresentThisZodiacRecipe'] = false
            event_flags_system['cPlayer:OwsThisZodiac'] = 4
    elif fEvent24 == Taurus:
        if event_flags_system['cPlayer:OwsThisZodiac'] != 5:
            event_flags_system['cPlayer:OwsPresentThisZodiacRecipe'] = false
            event_flags_system['cPlayer:OwsThisZodiac'] = 5
    elif fEvent24 == Gemini:
        if event_flags_system['cPlayer:OwsThisZodiac'] != 6:
            event_flags_system['cPlayer:OwsPresentThisZodiacRecipe'] = false
            event_flags_system['cPlayer:OwsThisZodiac'] = 6
    elif fEvent24 == Cancer:
        if event_flags_system['cPlayer:OwsThisZodiac'] != 7:
            event_flags_system['cPlayer:OwsPresentThisZodiacRecipe'] = false
            event_flags_system['cPlayer:OwsThisZodiac'] = 7
    elif fEvent24 == Leo:
        if event_flags_system['cPlayer:OwsThisZodiac'] != 8:
            event_flags_system['cPlayer:OwsPresentThisZodiacRecipe'] = false
            event_flags_system['cPlayer:OwsThisZodiac'] = 8
    elif fEvent24 == Virgo:
        if event_flags_system['cPlayer:OwsThisZodiac'] != 9:
            event_flags_system['cPlayer:OwsPresentThisZodiacRecipe'] = false
            event_flags_system['cPlayer:OwsThisZodiac'] = 9
    elif fEvent24 == Libra:
        if event_flags_system['cPlayer:OwsThisZodiac'] != 10:
            event_flags_system['cPlayer:OwsPresentThisZodiacRecipe'] = false
            event_flags_system['cPlayer:OwsThisZodiac'] = 10
    elif fEvent24 == Scorpius:
        if event_flags_system['cPlayer:OwsThisZodiac'] != 11:
            event_flags_system['cPlayer:OwsPresentThisZodiacRecipe'] = false
            event_flags_system['cPlayer:OwsThisZodiac'] = 11
    elif fEvent24 == Sagittarius:
        if event_flags_system['cPlayer:OwsThisZodiac'] != 12:
            event_flags_system['cPlayer:OwsPresentThisZodiacRecipe'] = false
            event_flags_system['cPlayer:OwsThisZodiac'] = 12
    return

flow Process_Anytime:
    run MyHomeChk
    run ChkGoldenToolRecipe_GoldenNet
    run ChkGoldenToolRecipe_GoldenRod
    run RemakeUnlock
    run EnableTailorBuild
    return

flow Process_Daily:
    run HgsFriendship
    run BocKabuBuyCount
    run RcoMachineDailyLoginChk
    run OwsChkMonthlyFlag
    run HouseFacilityMoveReset
    run System_AirlineNoveltySendCheck::Root
    run FixMcat11233
    run SendTapBedLetter
    run SendTapThankyouLetter
    return

flow Process_Only_PAnnounce:
    run SeasonMaterialHintReset
    run ChkStartGamePhoneCall
    run BGMChangeCheck
    run ImmQFtrChk
    run Enable_BuildOfficeIntroduction
    run ShopGrowUpCheck
    run IslandEvaluationUpdateChk
    run MuseumGrouUpChk
    return

flow RcoMachineDailyLoginChk:
    if EventFlowSystemActor.PlayerPastDaysFromLastPlay(2):
        event_flags_system['cPlayer:RcoMachineDailyLoginDays'] = 0
        event_flags_system['cPlayer:RcoMachineDailyLoginCheck'] = false
    elif event_flags_system['cPlayer:RcoMachineDailyLoginCheck']:
        event_flags_system['cPlayer:RcoMachineDailyLoginDays'] += 1
        event_flags_system['cPlayer:RcoMachineDailyLoginCheck'] = false
    else:
        event_flags_system['cPlayer:RcoMachineDailyLoginDays'] = 0
    return

flow RemakeUnlock:
    if (event_flags_system['cLand:ImmQClearNextDay']) and (event_flags_system['cPlayer:MainmenuRecipe']) and (not event_flags_system['cPlayer:EnableDiyRemake']) and (not event_flags_system['cPlayer:RcoHeardInviteRemakeWS']):
        event_flags_system['cPlayer:RcoTalkAboutRemakeTrial'] = true
    return

flow ResetFlag_Autumn:
    run Flag_Spring
    run Flag_Summer
    run Flag_Winter
    run Flag_SpringBamboo
    return

flow ResetFlag_Spring:
    run Flag_Summer
    run Flag_Autumn
    run Flag_Winter
    run Flag_Nuts
    return

flow ResetFlag_Summer:
    run Flag_Spring
    run Flag_Autumn
    run Flag_Winter
    run Flag_Nuts
    run Flag_SpringBamboo
    return

flow ResetFlag_Winter:
    run Flag_Spring
    run Flag_Summer
    run Flag_Autumn
    run Flag_Nuts
    run Flag_SpringBamboo
    return

flow Root:
    run Process_Anytime
    if not event_flags_system['cPlayer:PAnnouceProcessDoneToday']:
        run Process_Daily
        event_flags_system['cPlayer:PAnnouceProcessDoneToday'] = true
    if not ((event_flags_system['cLand:PAnnounceToday']) and (EventFlowSystemActor.IsSharePlay(0))):
        run Process_Only_PAnnounce
    return

flow SeasonMaterialHintReset:
    fEvent215 = EventFlowSystemActor.EnvWeatherArea()
    if fEvent215 == cWeatherArea_North:
        fEvent214 = EventFlowSystemActor.EnvMonth()
        if fEvent214 in (March, April, May):
            run ResetFlag_Spring
            run Flag_Ornaments
        elif fEvent214 in (June, July, August):
            run ResetFlag_Summer
            run Flag_Ornaments
        elif fEvent214 in (September, October, November):
            run ResetFlag_Autumn
            run Flag_Ornaments
        elif fEvent214 == January:
            run ResetFlag_Winter
        elif fEvent214 == December:
            run ResetFlag_Winter
        elif fEvent214 == February:
            run Flag_Ornaments
            run ResetFlag_Winter
    elif fEvent215 == cWeatherArea_South:
        fEvent216 = EventFlowSystemActor.EnvMonth()
        if fEvent216 in (September, October, November):
            run ResetFlag_Spring
            run Flag_Ornaments
        elif fEvent216 == December:
            run ResetFlag_Summer
        elif fEvent216 == January:
            run ResetFlag_Summer
        elif fEvent216 in (March, April, May):
            run ResetFlag_Autumn
            run Flag_Ornaments
        elif fEvent216 in (June, July, August):
            run ResetFlag_Winter
            run Flag_Ornaments
        elif fEvent216 == February:
            run Flag_Ornaments
            run ResetFlag_Summer
    return

flow SendTapBedLetter:
    if (not event_flags_system['cPlayer:ReceiveTapBedLetter']) and (EventFlowSystemActor.PlayerHouseLevel() in (2, 3, 4, 5, 6, 7, 8)) and (not event_flags_system['cPlayer:PlayerHouseBuiltToday']):
        EventFlowSystemActor.SelectRewardItemDirect(13221, 1, 'cVillageRemakePattern', 0)
        if event_flags_system['cPlayer:TapDreamFirstTalk']:
            EventFlowSystemActor.SystemMailSend('cTap', 'MAIL_SNpc_tap', 'cFastToday', 'cReward', 'cNone', false, 3)
        else:
            EventFlowSystemActor.SystemMailSend('cTap', 'MAIL_SNpc_tap', 'cFastToday', 'cReward', 'cNone', false, 2)
        event_flags_system['cPlayer:ReceiveTapBedLetter'] = true
    return

flow SendTapThankyouLetter:
    if event_flags_system['cPlayer:TapSendThankyouLetter']:
        EventFlowSystemActor.SelectRewardItemDirect(13228, 1, 'cVillageRemakePattern', 0)
        EventFlowSystemActor.SystemMailSend('cTap', 'MAIL_SNpc_tap', 'cFastToday', 'cReward', 'cNone', false, 1)
        event_flags_system['cPlayer:TapSendThankyouLetter'] = false
    return

flow ShopGrowUpCheck:
    if EventFlowSystemActor.ShopLevel() == NooksCrannyUpgraded:
        event_flags_system['cLand:Market2Built'] = true
    return

flow sub_grp!Event242:
    if (not event_flags_system['cPlayer:StandByPhoneCallJuneBrideSpn']) and (not event_flags_system['cPlayer:SpnJuneBrideTalkEventFrag']):
        event_flags_system['cPlayer:StandByPhoneCallJuneBride'] = true
        event_flags_system['cPlayer:StandByGameStartPhoneCall'] = true


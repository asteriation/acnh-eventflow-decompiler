flow AmiiboPhone_Camp:
    run AmiiboPhone_Camp_PreCheck
    if EventFlowSystemActor.IsCampSiteOccupied():
        Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:514', false)
    Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:512', false)
entrypoint Event115:
    if EventFlowSystemActor.GeneralTalkChoice2() == 0:
entrypoint Event127:
        run AmiiboPhone_Camp_NfcPreCheck
        Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:521', false)
        if EventFlowSystemActor.NfcDisabled():
            Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:544', false)
            run AmiiboPhone_Exit_SeeYouNext
        else:
            EventFlowSystemActor.CheckNfpController('NpadId')
            entry_variables['ReadPadId'] = 'NpadId'
            EventFlowSystemActor.ReadAmiibo('ReadPadId')
            if not EventFlowSystemActor.UIResultMenuDecide():
                Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:529', false)
                if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                    run AmiiboPhone_Exit_SeeYouNext
                else:
                    run AmiiboPhone_RetryFromUI
            elif EventFlowSystemActor.CheckErrorType(1):
                run AmiiboPhone_Camp_NfcResultCheck
            elif not EventFlowSystemActor.IsAcceptableAmiibo():
                Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:545', false)
                run ReloadAmiibo
            elif EventFlowSystemActor.CheckAmiiboNPC('cSNPC'):
                run Flow_SNPC
            elif EventFlowSystemActor.CheckAmiiboNPC('cNNPC'):
                run Flow_NNPC
            else:
                run Flow_Others
    else:
        run AmiiboPhone_Exit_SeeYouNext
    return

flow AmiiboPhone_Camp_NfcPreCheck:
    if EventFlowSystemActor.NfcDisabled():
        Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:544', false)
        run AmiiboPhone_Exit_SeeYouNext
    else:
        EventFlowSystemActor.CheckNfpController('NpadId')
        if entry_variables['NpadId'] >= 0:
            Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:547', false)
            run AmiiboPhone_Exit_SeeYouNext
    return

flow AmiiboPhone_Camp_NfcResultCheck:
    fEvent136 = EventFlowSystemActor.NfpErrorType()
    if fEvent136 == 0:
        Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:545', false)
        run AmiiboPhone_Exit_SeeYouNext
    elif fEvent136 == 1:
        Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:546', false)
        run AmiiboPhone_Exit_SeeYouNext
    elif fEvent136 == 2:
        Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:548', false)
        run AmiiboPhone_Retry
    return

flow AmiiboPhone_Camp_PreCheck:
    if event_flags_system['cLand:AmiiboCampSiteCall']:
        Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:541', false)
        run AmiiboPhone_Exit_Thankyou
    elif EventFlowSystemActor.NetHasVisitor():
        Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:542', false)
        run AmiiboPhone_Exit_SeeYouNext
    elif EventFlowSystemActor.NetIsConnected():
        if EventFlowSystemActor.IsVillageGateOpened():
            Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:543', false)
            run AmiiboPhone_Exit_SeeYouNext
        else:
            Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:543_01', false)
            run AmiiboPhone_Exit_SeeYouNext
    return

flow AmiiboPhone_Exit_SeeYouNext:
    Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:515', false)
    EventFlowSystemActor.ExitFlowchart()
    return

flow AmiiboPhone_Exit_Thankyou:
    Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:516', false)
    EventFlowSystemActor.ExitFlowchart()
    return

flow AmiiboPhone_Retry:
    Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:549', false)
    run Event115
    return

flow AmiiboPhone_RetryFromUI:
    run Event127
    return

flow Flow_NNPC:
    EventFlowSystemActor.SetTagFromSystem(0, 'cAmiiboCallNpcName', 'cDegit', '', 0)
    if EventFlowSystemActor.IsAlreadyCalledAmiiboNpc('cCamp'):
        Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:525', false)
        run ReloadAmiibo
    else:
        Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:522', false)
        if EventFlowSystemActor.GeneralTalkChoice2() != 0:
            run ReloadAmiibo
        elif EventFlowSystemActor.IsCallableAmiiboNpc('cCamp'):
            if EventFlowSystemActor.IsAmiiboNpcMigrated():
                if EventFlowSystemActor.IsAmiiboNpcLiving():
                    fEvent21 = EventFlowSystemActor.IsAmiiboNpcMoveOut()
                    if fEvent21 == 1:
                        Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:524', false)
                        EventFlowSystemActor.SwapSpeaker('cAmiiboPhone', true)
                        EventFlowSystemActor.AmiiboNpcOpenMessage('TalkNNpc/B1_Bo/Spot/BO_Spot_Camp_Amiibo:001')
                        EventFlowSystemActor.SwapSpeaker('cNone', true)
                        run ReloadAmiibo
                    elif fEvent21 == 0:
                        if (EventFlowSystemActor.IsAcquaintanceAmiiboNPC()) and (not EventFlowSystemActor.IsAmiiboNpcSick()):
                            EventFlowSystemActor.MessageSuspend()
                            EventFlowSystemActor.SoundTriggerEmit('GotoAmiiboPhone', -1)
                            EventFlowSystemActor.StartAmiiboPhone('cNormalFader', 'cNormalFader', 'cWhite', 0.5, 0.5)
                        else:
                            Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:526', false)
                            run ReloadAmiibo
                    elif fEvent21 == 2:
                        Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:526', false)
                        run ReloadAmiibo
                else:
                    Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:524', false)
                    EventFlowSystemActor.SwapSpeaker('cAmiiboPhone', true)
                    EventFlowSystemActor.AmiiboNpcOpenMessage('TalkNNpc/B1_Bo/Spot/BO_Spot_Camp_Amiibo:001')
                    EventFlowSystemActor.SwapSpeaker('cNone', true)
                    run ReloadAmiibo
            else:
                if EventFlowSystemActor.IsAmiiboNpcLiving():
                    fEvent21 = EventFlowSystemActor.IsAmiiboNpcMoveOut()
                    if fEvent21 == 1:
                        Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:524', false)
                        EventFlowSystemActor.SwapSpeaker('cAmiiboPhone', true)
                        EventFlowSystemActor.AmiiboNpcOpenMessage('TalkNNpc/B1_Bo/Spot/BO_Spot_Camp_Amiibo:001')
                        EventFlowSystemActor.SwapSpeaker('cNone', true)
                        run ReloadAmiibo
                    elif fEvent21 == 0:
                        if (EventFlowSystemActor.IsAcquaintanceAmiiboNPC()) and (not EventFlowSystemActor.IsAmiiboNpcSick()):
                            EventFlowSystemActor.MessageSuspend()
                            EventFlowSystemActor.SoundTriggerEmit('GotoAmiiboPhone', -1)
                            EventFlowSystemActor.StartAmiiboPhone('cNormalFader', 'cNormalFader', 'cWhite', 0.5, 0.5)
                        else:
                            Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:526', false)
                            run ReloadAmiibo
                    elif fEvent21 == 2:
                        Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:526', false)
                        run ReloadAmiibo
                else:
                    EventFlowSystemActor.MessageSuspend()
                    EventFlowSystemActor.SoundTriggerEmit('GotoAmiiboPhone', -1)
                    EventFlowSystemActor.StartAmiiboPhone('cNormalFader', 'cNormalFader', 'cWhite', 0.5, 0.5)
        else:
            Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:526', false)
            run ReloadAmiibo
    return

flow Flow_Others:
    EventFlowSystemActor.SetTagFromSystem(0, 'cAmiiboCallNpcName', 'cDegit', '', 0)
    if EventFlowSystemActor.CheckAmiiboNPC('cVillager'):
        Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:527', false)
        run ReloadAmiibo
    else:
        Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:545', false)
        run ReloadAmiibo
    return

flow Flow_SNPC:
    EventFlowSystemActor.SetTagFromSystem(0, 'cAmiiboCallNpcName', 'cDegit', '', 0)
    if EventFlowSystemActor.CheckAmiiboNPC('cRcmAndRct'):
        Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:523', false)
        fEvent57 = EventFlowSystemActor.GeneralTalkChoice3()
        if fEvent57 == 2:
            run ReloadAmiibo
        elif fEvent57 == 1:
            EventFlowSystemActor.ChangeAmiiboNPC('cRct')
            run sub_grp!Event87
        elif fEvent57 == 0:
            EventFlowSystemActor.ChangeAmiiboNPC('cRcm')
            run sub_grp!Event87
    else:
        if EventFlowSystemActor.AmiiboNameWithTitle() == 0:
            Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:530', false)
        else:
            Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:522', false)
        if EventFlowSystemActor.GeneralTalkChoice2() == 0:
            run sub_grp!Event87
        else:
            run ReloadAmiibo
    return

flow ReloadAmiibo:
    Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:550', false)
    run Event115
    return

flow Root:
    run Obj_RcoMachine::ChkRcoMachineSel
    if subflow_results[0] in (2, 3):
        if not event_flags_system['cPlayer:AmiiboPhoneTalkFirst']:
            event_flags_system['cPlayer:AmiiboPhoneTalkFirst'] = true
            Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:501', false)
        run AmiiboPhone_Camp
    return

flow sub_grp!Event87:
    if (EventFlowSystemActor.IsCallableAmiiboNpc('cCamp')) and (not EventFlowSystemActor.IsAmiiboNpcVisiting()) and (EventFlowSystemActor.IsAcquaintanceAmiiboNPC()):
        EventFlowSystemActor.MessageSuspend()
        EventFlowSystemActor.SoundTriggerEmit('GotoAmiiboPhone', -1)
        EventFlowSystemActor.StartAmiiboPhone('cNormalFader', 'cNormalFader', 'cWhite', 0.5, 0.5)
    else:
        if EventFlowSystemActor.AmiiboNameWithTitle() == 0:
            Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:531', false)
        else:
            Player.OpenMessageWindow('TalkObj/OBJ_RcoMachine:526', false)
        run ReloadAmiibo


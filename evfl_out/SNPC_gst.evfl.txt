flow GstGiveSpirits:
    run Event36
    return

flow Gst_Choose_Category:
    if EventFlowSystemActor.PlayerHouseLevel() in (Homeless, PlacedTent):
        if EventFlowSystemActor.PercentChoice(75):
            subflow_results[0] = 0
        else:
            subflow_results[0] = 3
    elif EventFlowSystemActor.PercentChoice(40):
        subflow_results[0] = 0
    else:
        fEvent97 = EventFlowSystemActor.PercentChoice3(40, 40, 20)
        if fEvent97 == 0:
            subflow_results[0] = 1
        elif fEvent97 == 1:
            subflow_results[0] = 2
        elif fEvent97 == 2:
            subflow_results[0] = 3
    return

flow Gst_Choose_Item_NotHave:
    fEvent127 = subflow_results[0]
    if fEvent127 == 0:
        MainNpc.GstDecideReward(true, Furniture, 300, 3000)
    elif fEvent127 == 1:
        MainNpc.GstDecideReward(true, Wallpaper, 300, 2500)
    elif fEvent127 == 2:
        MainNpc.GstDecideReward(true, Flooring, 300, 2500)
    elif fEvent127 == 3:
        MainNpc.GstDecideReward(true, Clothing, 300, 2000)
    return

flow Gst_Choose_Item_Rich:
    if EventFlowSystemActor.PercentChoice(90):
        fEvent99 = subflow_results[0]
        if fEvent99 == 0:
            MainNpc.GstDecideReward(false, Furniture, 2000, 15000)
        elif fEvent99 == 1:
            MainNpc.GstDecideReward(false, Wallpaper, 1850, 10000)
        elif fEvent99 == 2:
            MainNpc.GstDecideReward(false, Flooring, 1850, 10000)
        elif fEvent99 == 3:
            MainNpc.GstDecideReward(false, Clothing, 1800, 10000)
    else:
        fEvent122 = subflow_results[0]
        if fEvent122 == 0:
            MainNpc.GstDecideReward(false, Furniture, 10, 15000)
        elif fEvent122 == 1:
            MainNpc.GstDecideReward(false, Wallpaper, 10, 3000)
        elif fEvent122 == 2:
            MainNpc.GstDecideReward(false, Flooring, 10, 3000)
        elif fEvent122 == 3:
            MainNpc.GstDecideReward(false, Clothing, 10, 5000)
    return

flow Gst_ClearProcess:
    event_flags_system['cPlayer:GstQuestClearFlag'] = true
    event_flags_system['cPlayer:GstQuestStartFlag'] = false
    event_flags_system['cLifeSupportAchievement:HelpGst'] += 1
    return

flow Gst_Hit:
    fEvent87 = EventFlowSystemActor.RandomChoiceExcludePrevious3(true, 3)
    if fEvent87 == 0:
        MainNpc.OpenMessageWindow('TalkSNpc/gst/SP_gst:065_01', true)
    elif fEvent87 == 1:
        MainNpc.OpenMessageWindow('TalkSNpc/gst/SP_gst:065_02', true)
    elif fEvent87 == 2:
        MainNpc.OpenMessageWindow('TalkSNpc/gst/SP_gst:065_03', true)
    return

flow Gst_Quest:
    run Event59
    return

flow Gst_Share:
    if event_flags_system['cLandTemp:GstQuestStartLandFlag']:
        if event_flags_system['cPlayer:GstQuestStartFlag']:
            run Gst_Quest
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/gst/SP_gst:061', false)
            EventFlowSystemActor.ExitFlowchart()
    elif event_flags_system['cPlayer:GstQuestClearFlag']:
        MainNpc.OpenMessageWindow('TalkSNpc/gst/SP_gst:060', false)
        EventFlowSystemActor.ExitFlowchart()
    else:
        run Gst_Start
    return

flow Gst_Start:
    run Event3
    return

flow Gst_StartProcess:
    event_flags_system['cLand:GstTalkAnyone'] = true
    event_flags_system['cPlayer:GstTalkBefore'] = true
    event_flags_system['cPlayer:GstQuestStartFlag'] = true
    event_flags_system['cLandTemp:GstQuestStartLandFlag'] = true
    return

flow Root:
    if EventFlowSystemActor.IsSharePlay(0):
        run Gst_Share
    elif event_flags_system['cPlayer:GstQuestStartFlag']:
entrypoint Event59:
        if not EventFlowSystemActor.HasTargetItem(4702, 5):
            if EventFlowSystemActor.HasTargetItem(4702, 4):
                MainNpc.OpenMessageWindow('TalkSNpc/gst/SP_gst:015', false)
            elif EventFlowSystemActor.HasTargetItem(4702, 3):
                MainNpc.OpenMessageWindow('TalkSNpc/gst/SP_gst:014', false)
            elif EventFlowSystemActor.HasTargetItem(4702, 2):
                MainNpc.OpenMessageWindow('TalkSNpc/gst/SP_gst:013', false)
            elif EventFlowSystemActor.HasTargetItem(4702, 1):
                MainNpc.OpenMessageWindow('TalkSNpc/gst/SP_gst:012', false)
            else:
                MainNpc.OpenMessageWindow('TalkSNpc/gst/SP_gst:011', false)
        elif EventFlowSystemActor.NetHasVisitor():
            MainNpc.OpenMessageWindow('TalkSNpc/gst/SP_gst:040', true)
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/gst/SP_gst:016', false)
            if EventFlowSystemActor.GeneralTalkChoice2() == 0:
entrypoint Event36:
                MainNpc.SetDeliveryItemAtRandom(4702, false, 'cVillageRemakePattern', 0)
                run Gst_ClearProcess
                MainNpc.NpcDelivery('Default', 15)
                EventFlowSystemActor.DeleteTargetItem(4702, 5, false)
                MainNpc.OpenMessageWindow('TalkSNpc/gst/SP_gst:030', true)
                MainNpc.NpcDelivery('Default', 16)
                MainNpc.NpcGstChange(0)
                SubNpc.OpenMessageWindow('TalkSNpc/gst/SP_gst:031', false)
                run Gst_Choose_Category
                SubNpc.OpenMessageWindow('TalkSNpc/gst/SP_gst:032', false)
                fEvent119 = subflow_results[0]
                if fEvent119 == 0:
                    SubNpc.OpenMessageWindow('TalkSNpc/gst/SP_gst:033_01', false)
                elif fEvent119 == 1:
                    SubNpc.OpenMessageWindow('TalkSNpc/gst/SP_gst:033_02', false)
                elif fEvent119 == 2:
                    SubNpc.OpenMessageWindow('TalkSNpc/gst/SP_gst:033_03', false)
                elif fEvent119 == 3:
                    SubNpc.OpenMessageWindow('TalkSNpc/gst/SP_gst:033_04', false)
                SubNpc.OpenMessageWindow('TalkSNpc/gst/SP_gst:035', false)
                if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                    SubNpc.OpenMessageWindow('TalkSNpc/gst/SP_gst:036_01', false)
                    run Gst_Choose_Item_NotHave
                else:
                    SubNpc.OpenMessageWindow('TalkSNpc/gst/SP_gst:036_02', false)
                    run Gst_Choose_Item_Rich
                SubNpc.SetItemName(1, 0, 4)
                SubNpc.SetDeliveryItem(true, true)
                SubNpc.SetEventRewardToPlayerBaggage('cFree')
                SubNpc.OpenMessageWindow('TalkSNpc/gst/SP_gst:037', false)
                SubNpc.OpenMessageWindow('TalkSNpc/gst/SP_gst:038', false)
                MainNpc.NpcGstChange(2)
            else:
                MainNpc.OpenMessageWindow('TalkSNpc/gst/SP_gst:017', false)
                if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                    run GstGiveSpirits
                else:
                    MainNpc.OpenMessageWindow('TalkSNpc/gst/SP_gst:018', false)
                    if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                        run GstGiveSpirits
                    else:
                        MainNpc.OpenMessageWindow('TalkSNpc/gst/SP_gst:019', false)
                        if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                            run GstGiveSpirits
                        else:
                            MainNpc.OpenMessageWindow('TalkSNpc/gst/SP_gst:020', false)
                            if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                                run GstGiveSpirits
                            else:
entrypoint Event33:
                                MainNpc.OpenMessageWindow('TalkSNpc/gst/SP_gst:021', false)
                                if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                                    run GstGiveSpirits
                                else:
                                    run Event33
    else:
entrypoint Event3:
        MainNpc.OpenMessageWindow('TalkSNpc/gst/SP_gst:001', true)
        MainNpc.NpcGstChange(1)
        EventFlowSystemActor.WaitFrame(30)
        SubNpc.OpenMessageWindow('TalkSNpc/gst/SP_gst:002', false)
        if event_flags_system['cPlayer:GstQuestBreakFlag']:
            SubNpc.OpenMessageWindow('TalkSNpc/gst/SP_gst:050', false)
            SubNpc.OpenMessageWindow('TalkSNpc/gst/SP_gst:051', false)
        else:
            if event_flags_system['cLand:GstTalkAnyone']:
                if event_flags_system['cPlayer:GstTalkBefore']:
                    SubNpc.OpenMessageWindow('TalkSNpc/gst/SP_gst:045', false)
                    SubNpc.OpenMessageWindow('TalkSNpc/gst/SP_gst:046', false)
                    SubNpc.OpenMessageWindow('TalkSNpc/gst/SP_gst:007', false)
                    if not EventFlowSystemActor.HasKindItem('cKind', 'Net', ''):
                        SubNpc.OpenMessageWindow('TalkSNpc/gst/SP_gst:052', false)
                    SubNpc.OpenMessageWindow('TalkSNpc/gst/SP_gst:053', false)
                    run Gst_StartProcess
                else:
                    SubNpc.OpenMessageWindow('TalkSNpc/gst/SP_gst:004', false)
            else:
                SubNpc.OpenMessageWindow('TalkSNpc/gst/SP_gst:003', false)
            SubNpc.OpenMessageWindow('TalkSNpc/gst/SP_gst:005', false)
            SubNpc.OpenMessageWindow('TalkSNpc/gst/SP_gst:006', false)
        SubNpc.OpenMessageWindow('TalkSNpc/gst/SP_gst:007', false)
        if not EventFlowSystemActor.HasKindItem('cKind', 'Net', ''):
            SubNpc.OpenMessageWindow('TalkSNpc/gst/SP_gst:052', false)
        SubNpc.OpenMessageWindow('TalkSNpc/gst/SP_gst:053', false)
        run Gst_StartProcess
    return

flow Root_Init:
    if not EventFlowSystemActor.NetHasVisitor():
        MainNpc.NpcAITalkSubCastEntry(1, 'gstA')
    return


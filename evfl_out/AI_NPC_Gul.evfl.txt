flow Hit:
    MainNpc.NpcChangeAIState('cHit', 'SNPC_gul', 'Root', '', false, false)
    return

flow Init:
    run InitCommon
    if event_flags_system['cLand:JohnnySitUpFlag']:
        run InitWakeup
    else:
        run InitSleep
    return

flow InitCommon:
    MainNpc.NpcAISetting(0, true)
    MainNpc.NpcAISetting(1, true)
    MainNpc.SetSpecialPos('cSetPosType_SavePos')
    return

flow InitSleep:
    MainNpc.GulFreeAction('cGulActionType_SetAngle')
    MainNpc.SetDefaultWaitAs('cGulSleeping')
    MainNpc.NpcAISetting(2, false)
    MainNpc.NpcAISetting(3, false)
    MainNpc.NpcAISetting(8, true)
    MainNpc.NpcAISetting(14, true)
    return

flow InitWakeup:
    MainNpc.SetDefaultWaitAs('cDefault')
    MainNpc.NpcAISetting(2, true)
    MainNpc.NpcAISetting(3, true)
    MainNpc.NpcAISetting(8, false)
    return

flow Root:
    if not MainNpc.NpcCheckStateSelectTiming('cInit'):
        if event_flags_system['cLand:JohnnyInvisible']:
            MainNpc.NpcChangeInvisibleState('cInvisible', '', '', '', false, true, 0)
            event_flags_system['cLand:JohnnyInvisible'] = true
        else:
            if event_flags_system['cLand:JohnnySitUpFlag']:
                run SetStateWakeup
            else:
                run SetStateSleep
    elif event_flags_system['cLand:JohnnySitUpFlag']:
        if MainNpc.CanMoveUnit(true):
            run SetStateWakeup
            event_flags_system['cLand:JohnnyInvisible'] = false
        else:
            MainNpc.NpcChangeInvisibleState('cInvisible', '', '', '', false, true, 0)
            event_flags_system['cLand:JohnnyInvisible'] = true
    else:
        if MainNpc.CanMoveUnit(false):
            run SetStateSleep
            event_flags_system['cLand:JohnnyInvisible'] = false
        else:
            MainNpc.NpcChangeInvisibleState('cInvisible', '', '', '', false, true, 0)
            event_flags_system['cLand:JohnnyInvisible'] = true
    return

flow SetStateSleep:
    MainNpc.SetDefaultWaitAs('cGulSleeping')
    MainNpc.NpcChangeWaitState('cWait', 'EntryName', 'FlowName', '', true, true, 0, true, '')
    MainNpc.NpcAISetting(2, false)
    MainNpc.NpcAISetting(3, false)
    MainNpc.NpcAISetting(8, true)
    MainNpc.NpcAISetting(14, true)
    return

flow SetStateWakeup:
    MainNpc.SetDefaultWaitAs('cDefault')
    MainNpc.NpcChangeBlockWanderState('cBlockWander', 'EntryName', 'FlowName', '', true, true, false, 0, 4, 9, 9)
    MainNpc.NpcAISetting(2, true)
    MainNpc.NpcAISetting(3, true)
    MainNpc.NpcAISetting(8, false)
    MainNpc.NpcAISetting(14, false)
    return


flow AfterNewServiceExlpain:
    MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:014', false)
    run Event0
    return

flow BuyCancelNoAsk:
    run Event43
    return

flow CmnCloseShoppingUI:
    fork:
        branch0:
        branch1:
            EventFlowSystemActor.MessageSuspend()
        branch2:
            EventFlowSystemActor.UIShopBuyDisappear()
    EventFlowSystemActor.WaitFrame(5)
    return

flow FishingRodBuy:
    MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:096', false)
    if EventFlowSystemActor.GeneralTalkChoice2() == 0:
        run Event42
    else:
        run BuyCancelNoAsk
    return

flow ItemFullBuyRecipecard:
    run Event1
    return

flow ItemFullBuySolo:
    run Event1
    return

flow NotEnoughMoneySolo:
    run Event33
    return

flow Rcm_Cmn_BuySel_Cancel:
    run Event21
    return

flow Rcm_Common_Buy:
    MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:091', false)
    run Event57
    return

flow Rcm_Common_BuyAgain:
    EventFlowSystemActor.UIShopBuyReselectionAppear()
    run Event39
    return

flow Rcm_Common_BuyAgain2:
    run Event57
    return

flow Rcm_Common_BuyCheck:
    if EventFlowSystemActor.GeneralTalkChoice2() == 0:
entrypoint Event71:
        if subflow_results[0] == 0:
            if MainNpc.ShopHasBellCount(1.0):
                run sub_grp!Event84
            else:
                run NotEnoughMoneySolo
        else:
            if MainNpc.ShopHasBellCount(5.0):
                run sub_grp!Event84
            else:
entrypoint Event33:
                MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:111', false)
                run sub_grp!Event82
    else:
entrypoint Event21:
        MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:902_01', false)
        run sub_grp!Event82
    return

flow Rcm_Common_BuyCheckUI:
    run Event71
    return

flow Rcm_Common_TurnipChk:
    fEvent138 = EventFlowSystemActor.EnvDayOfWeek()
    if fEvent138 in (Monday, Tuesday, Wednesday, Thursday, Friday, Saturday):
        EventFlowSystemActor.SetTagFromSystem(0, 'cKabuka', '"cDegit"', '""', 0)
        MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:081', false)
        run Event6
    elif fEvent138 == Sunday:
        MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:082', false)
        run Event6
    return

flow Rcm_Groceries_Buy_Cancel:
    run Event46
    return

flow Rcm_Groceries_Buy_Process:
    run Event42
    return

flow Rcm_OpenShoppingUI:
    EventFlowSystemActor.MarketShowcase('cOpen')
    EventFlowSystemActor.WaitFrame(5)
    MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:061', false)
entrypoint Event57:
    EventFlowSystemActor.UIShopBuyAppear('cMamekichi')
entrypoint Event39:
    if EventFlowSystemActor.UIResultMenuDecide():
        EventFlowSystemActor.SetTagFromUIResult(0, 'cItemName')
        EventFlowSystemActor.SetTagFromUIResult(0, 'cItemPrice')
        EventFlowSystemActor.SetTagFromUIResult(1, 'cItem5Price')
        if any ('FishingRod', '', '', '', '', '', '', '') in EventFlowSystemActor.ItemSelect('cItemSelect'):
            if event_flags_system['cPlayer:MainmenuRecipe']:
                MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:094', false)
                if EventFlowSystemActor.GeneralTalkChoice2() == 0:
entrypoint Event42:
                    run Rcm_Common_BuyCheckUI
                    event_flags_system['cPlayerTemp:RcmBoughtGrocery'] = true
entrypoint Event43:
                    MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:092', false)
                else:
entrypoint Event46:
                    MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:902_02', false)
                subflow_results[0] = 0
                run Rcm_Common_BuyAgain
            else:
                run FishingRodBuy
        elif any ('DummyRecipe', '', '', '', '', '', '', '') in EventFlowSystemActor.ItemSelect('cItemSelect'):
            run SNPC_rcm_11_BuyDIYbook::Root
        elif any ('DummyDIYRecipe', '', '', '', '', '', '', '') in EventFlowSystemActor.ItemSelect('cItemSelect'):
            run SNPC_rcm_12_BuyDIYcard::Root
        elif any ('FlowerSeed', 'TreeSeedling', 'Fruit', 'Medicine', 'WrappingPaper', 'PartyPopper', 'CraftRemake', '') in EventFlowSystemActor.ItemSelect('cItemSelect'):
            run SNPC_rcm_13_BuyMultipleItems::Root
        else:
            if (any ('MarineSuit', '', '', '', '', '', '', '') in EventFlowSystemActor.ItemSelect('cItemSelect')) and (not event_flags_system['cPlayer:RcmTalkAboutMarinesuitFlag']):
                run SNPC_rcm_14_BuyMarinesuit::Root
            else:
                MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:094', false)
                if EventFlowSystemActor.GeneralTalkChoice2() == 0:
entrypoint Event42:
                    run Rcm_Common_BuyCheckUI
                    event_flags_system['cPlayerTemp:RcmBoughtGrocery'] = true
entrypoint Event43:
                    MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:092', false)
                else:
entrypoint Event46:
                    MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:902_02', false)
                subflow_results[0] = 0
                run Rcm_Common_BuyAgain
    else:
        run CmnCloseShoppingUI
        if event_flags_system['cPlayerTemp:RcmBoughtGrocery']:
            fEvent101 = EventFlowSystemActor.ShopLevel()
            if fEvent101 == InResServiceTent:
                MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:903_03', false)
                run SNPC_rcm::Rcm_SeqClose
            elif fEvent101 in (NooksCrannyInitial, NooksCrannyUpgraded):
                if event_flags_system['cPlayerTemp:RcmShopshelfCheck']:
                    EventFlowSystemActor.CloseMarketShowcase()
                MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:903_04', false)
                run SNPC_rcm::Rcm_SeqClose
        else:
            EventFlowSystemActor.WaitFrame(5)
            fEvent103 = EventFlowSystemActor.ShopLevel()
            if fEvent103 == InResServiceTent:
                MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:903_01', true)
                run SNPC_rcm::Rcm_SeqClose
            elif fEvent103 in (NooksCrannyInitial, NooksCrannyUpgraded):
                if event_flags_system['cPlayerTemp:RcmShopshelfCheck']:
                    EventFlowSystemActor.CloseMarketShowcase()
                MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:903_02', false)
                run SNPC_rcm::Rcm_SeqClose
    return

flow Rcm_OpenShoppingUI_EX:
    EventFlowSystemActor.MarketShowcase('cOpen')
    EventFlowSystemActor.WaitFrame(5)
    run Event57
    return

flow Root:
    EventFlowSystemActor.UIMoneyAppear()
    fEvent2 = EventFlowSystemActor.ShopLevel()
    if fEvent2 == InResServiceTent:
        if event_flags_system['cPlayerTemp:RcmTalkSceneFlag']:
            MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:003', false)
        else:
            if EventFlowSystemActor.IsMyVillage():
                MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:001', false)
            else:
                MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:002', false)
        fEvent12 = EventFlowSystemActor.GeneralTalkChoice3()
        if fEvent12 == 1:
            run Rcm_Common_Buy
        elif fEvent12 == 0:
            run SNPC_rcm_00_Common_Sell::Root
        elif fEvent12 == 2:
            run rcm_Common_End
    elif fEvent2 in (NooksCrannyInitial, NooksCrannyUpgraded):
        if event_flags_system['cPlayerTemp:RcmTalkSceneFlag']:
            MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:013', false)
        else:
            if EventFlowSystemActor.IsMyVillage():
                MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:011', false)
            else:
                MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:012', false)
entrypoint Event0:
        fEvent0 = EventFlowSystemActor.GeneralTalkChoice4()
        if fEvent0 == 3:
            run rcm_Common_End
        elif fEvent0 == 0:
            run SNPC_rcm_00_Common_Sell::Root
        elif fEvent0 == 1:
            run Rcm_Common_TurnipChk
        elif fEvent0 == 2:
            run rcm_Common_TodaysFurniture
    return

flow rcm_Common_End:
    MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:905', false)
    return

flow rcm_Common_TodaysFurniture:
    EventFlowSystemActor.SetTagFromSystem(0, 'cExpensivePurchase1', 'cDegit', '', 0)
    fEvent68 = EventFlowSystemActor.ShopLevel()
    if fEvent68 == NooksCrannyUpgraded:
        EventFlowSystemActor.SetTagFromSystem(1, 'cExpensivePurchase2', 'cDegit', '', 0)
        MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:121_01', false)
        MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:121_02', false)
entrypoint Event6:
        MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:019', false)
        fEvent148 = EventFlowSystemActor.GeneralTalkChoice4()
        if fEvent148 == 0:
            run SNPC_rcm_00_Common_Sell::Root
        elif fEvent148 == 1:
            run Rcm_Common_TurnipChk
        elif fEvent148 == 3:
            MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:904', false)
        elif fEvent148 == 2:
            run rcm_Common_TodaysFurniture
    elif fEvent68 == NooksCrannyInitial:
        MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:121', false)
        MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:121_02', false)
entrypoint Event6:
        MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:019', false)
        fEvent148 = EventFlowSystemActor.GeneralTalkChoice4()
        if fEvent148 == 0:
            run SNPC_rcm_00_Common_Sell::Root
        elif fEvent148 == 1:
            run Rcm_Common_TurnipChk
        elif fEvent148 == 3:
            MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:904', false)
        elif fEvent148 == 2:
            run rcm_Common_TodaysFurniture
    return

flow sub_grp!Event82:
    fork:
        branch0:
        branch1:
            if event_flags_system['cPlayerTemp:RcmShopshelfCheck']:
                EventFlowSystemActor.CloseMarketShowcase()
        branch2:
            EventFlowSystemActor.UIMoneyDisappear()
        branch3:
            EventFlowSystemActor.MessageSuspend()
        branch4:
            EventFlowSystemActor.UIShopBuyDisappear()
    run SNPC_rcm::Rcm_SeqClose

flow sub_grp!Event84:
    if any ('DummyDIYRecipe', '', '', '', '', '', '', '') in EventFlowSystemActor.ItemSelect('cItemSelect'):
        if EventFlowSystemActor.SystemHasBaggageSpace(1, 'cPocketBag'):
            if subflow_results[0] == 0:
                MainNpc.ShopBuyDone(false, false)
                event_flags_system['cLifeSupportAchievement:BuyItemRcm'] += 1
            else:
                MainNpc.ShopBuyDone(false, true)
                event_flags_system['cLifeSupportAchievement:BuyItemRcm'] += 5
                EventFlowSystemActor.SetTagFromUIResult(0, 'cItem5Price')
            if not event_flags_system['cPlayerTemp:RcmShopshelfCheck']:
                MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:113', false)
                MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:114', false)
            elif EventFlowSystemActor.NetIsConnected():
                MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:113', false)
            else:
                fEvent99 = EventFlowSystemActor.ShopLevel()
                if fEvent99 == InResServiceTent:
                    MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:113', false)
                elif fEvent99 in (NooksCrannyInitial, NooksCrannyUpgraded):
                    if any ('DummyRecipe', '', '', '', '', '', '', '') in EventFlowSystemActor.ItemSelect('cItemSelect'):
                        MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:113', true)
                    else:
                        MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:113', false)
        else:
            run ItemFullBuyRecipecard
    else:
        if not any ('DummyRecipe', '', '', '', '', '', '', '') in EventFlowSystemActor.ItemSelect('cItemSelect'):
            if subflow_results[0] == 0:
                if EventFlowSystemActor.ShoppingCapacity(65534, 'cShopping'):
                    if subflow_results[0] == 0:
                        MainNpc.ShopBuyDone(false, false)
                        event_flags_system['cLifeSupportAchievement:BuyItemRcm'] += 1
                    else:
                        MainNpc.ShopBuyDone(false, true)
                        event_flags_system['cLifeSupportAchievement:BuyItemRcm'] += 5
                        EventFlowSystemActor.SetTagFromUIResult(0, 'cItem5Price')
                    if not event_flags_system['cPlayerTemp:RcmShopshelfCheck']:
                        MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:113', false)
                        MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:114', false)
                    elif EventFlowSystemActor.NetIsConnected():
                        MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:113', false)
                    else:
                        fEvent99 = EventFlowSystemActor.ShopLevel()
                        if fEvent99 == InResServiceTent:
                            MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:113', false)
                        elif fEvent99 in (NooksCrannyInitial, NooksCrannyUpgraded):
                            if any ('DummyRecipe', '', '', '', '', '', '', '') in EventFlowSystemActor.ItemSelect('cItemSelect'):
                                MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:113', true)
                            else:
                                MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:113', false)
                else:
                    run ItemFullBuySolo
            else:
                if EventFlowSystemActor.ShoppingCapacity(65534, 'cShopping5'):
                    if subflow_results[0] == 0:
                        MainNpc.ShopBuyDone(false, false)
                        event_flags_system['cLifeSupportAchievement:BuyItemRcm'] += 1
                    else:
                        MainNpc.ShopBuyDone(false, true)
                        event_flags_system['cLifeSupportAchievement:BuyItemRcm'] += 5
                        EventFlowSystemActor.SetTagFromUIResult(0, 'cItem5Price')
                    if not event_flags_system['cPlayerTemp:RcmShopshelfCheck']:
                        MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:113', false)
                        MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:114', false)
                    elif EventFlowSystemActor.NetIsConnected():
                        MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:113', false)
                    else:
                        fEvent99 = EventFlowSystemActor.ShopLevel()
                        if fEvent99 == InResServiceTent:
                            MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:113', false)
                        elif fEvent99 in (NooksCrannyInitial, NooksCrannyUpgraded):
                            if any ('DummyRecipe', '', '', '', '', '', '', '') in EventFlowSystemActor.ItemSelect('cItemSelect'):
                                MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:113', true)
                            else:
                                MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:113', false)
                else:
entrypoint Event1:
                    MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:112', false)
                    run sub_grp!Event82
        else:
            if subflow_results[0] == 0:
                MainNpc.ShopBuyDone(false, false)
                event_flags_system['cLifeSupportAchievement:BuyItemRcm'] += 1
            else:
                MainNpc.ShopBuyDone(false, true)
                event_flags_system['cLifeSupportAchievement:BuyItemRcm'] += 5
                EventFlowSystemActor.SetTagFromUIResult(0, 'cItem5Price')
            if not event_flags_system['cPlayerTemp:RcmShopshelfCheck']:
                MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:113', false)
                MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:114', false)
            elif EventFlowSystemActor.NetIsConnected():
                MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:113', false)
            else:
                fEvent99 = EventFlowSystemActor.ShopLevel()
                if fEvent99 == InResServiceTent:
                    MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:113', false)
                elif fEvent99 in (NooksCrannyInitial, NooksCrannyUpgraded):
                    if any ('DummyRecipe', '', '', '', '', '', '', '') in EventFlowSystemActor.ItemSelect('cItemSelect'):
                        MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:113', true)
                    else:
                        MainNpc.OpenMessageWindow('TalkSNpc/rcm/SP_rcm_00_common:113', false)


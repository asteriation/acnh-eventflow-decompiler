flow 1P_Lifestart_Conv:
    fEvent1 = MainNpc.CheckNpcLook()
    if fEvent1 == 5:
        if not event_flags_system['cPlayer:Prologue4HaGetTent']:
            MainNpc.OpenMessageWindow('TalkNNpc/B2_Ha/React/HA_React_1P_LifeStart:002', false)
        elif EventFlowSystemActor.SystemCheckNowStage('cTalkingNpcHouse'):
            MainNpc.OpenMessageWindow('TalkNNpc/B2_Ha/React/HA_React_1P_LifeStart:001_01', false)
        else:
            MainNpc.OpenMessageWindow('TalkNNpc/B2_Ha/React/HA_React_1P_LifeStart:001_02', false)
        if EventFlowSystemActor.SystemHasBaggageSpace(1, 'cPocketBag'):
            run RewardSetHA
            MainNpc.OpenMessageWindow('TalkNNpc/B2_Ha/React/HA_React_1P_LifeStart:003_01', true)
            MainNpc.NpcDelivery('Keep', 1)
            MainNpc.OpenMessageWindow('TalkNNpc/B2_Ha/React/HA_React_1P_LifeStart:003_02', false)
            MainNpc.NpcDelivery('Default', 2)
        else:
            MainNpc.OpenMessageWindow('TalkNNpc/B2_Ha/React/HA_React_1P_LifeStart:004', true)
            run RewardSetHA
            MainNpc.NpcMailSend('MAIL_XX_LifeStart', 'cDeliveryItem', 1, 'cFastToday', 'cNone')
    elif fEvent1 == 3:
        if not event_flags_system['cPlayer:Prologue4AnGetTent']:
            MainNpc.OpenMessageWindow('TalkNNpc/G4_An/React/AN_React_1P_LifeStart:002', false)
        elif EventFlowSystemActor.SystemCheckNowStage('cTalkingNpcHouse'):
            MainNpc.OpenMessageWindow('TalkNNpc/G4_An/React/AN_React_1P_LifeStart:001_01', false)
        else:
            MainNpc.OpenMessageWindow('TalkNNpc/G4_An/React/AN_React_1P_LifeStart:001_02', false)
        if EventFlowSystemActor.SystemHasBaggageSpace(1, 'cPocketBag'):
            MainNpc.NpcSetRewardRecipe(6840, false)
            MainNpc.SetItemName(0, 1, 0)
            MainNpc.SetDeliveryItem(1, true)
            MainNpc.OpenMessageWindow('TalkNNpc/G4_An/React/AN_React_1P_LifeStart:003_01', true)
            MainNpc.NpcDelivery('Default', 1)
            MainNpc.OpenMessageWindow('TalkNNpc/G4_An/React/AN_React_1P_LifeStart:003_02', false)
            if event_flags_system['cPlayer:MainmenuRecipe']:
                MainNpc.OpenMessageWindow('TalkNNpc/G4_An/React/AN_React_1P_LifeStart:003_04', false)
            else:
                MainNpc.OpenMessageWindow('TalkNNpc/G4_An/React/AN_React_1P_LifeStart:003_03', false)
        else:
            MainNpc.OpenMessageWindow('TalkNNpc/G4_An/React/AN_React_1P_LifeStart:004', true)
            MainNpc.NpcSetRewardRecipe(6840, false)
            MainNpc.NpcMailSend('MAIL_XX_LifeStart', 'cReward', 1, 'cFastToday', 'cNone')
    return

flow RewardSetHA:
    fEvent11 = EventFlowSystemActor.RandomChoice6(6)
    if fEvent11 == 0:
        MainNpc.SetDeliveryItemAtRandom(5136, true, 'cVillageRemakePattern', 0)
    elif fEvent11 == 1:
        MainNpc.SetDeliveryItemAtRandom(5128, true, 'cVillageRemakePattern', 0)
        event_flags_system['cPlayer:1stPresentHatType'] = 1
    elif fEvent11 == 2:
        MainNpc.SetDeliveryItemAtRandom(5148, true, 'cVillageRemakePattern', 0)
        event_flags_system['cPlayer:1stPresentHatType'] = 2
    elif fEvent11 == 3:
        MainNpc.SetDeliveryItemAtRandom(11521, true, 'cVillageRemakePattern', 0)
        event_flags_system['cPlayer:1stPresentHatType'] = 3
    elif fEvent11 == 4:
        MainNpc.SetDeliveryItemAtRandom(5258, true, 'cVillageRemakePattern', 0)
        event_flags_system['cPlayer:1stPresentHatType'] = 4
    elif fEvent11 == 5:
        MainNpc.SetDeliveryItemAtRandom(5293, true, 'cVillageRemakePattern', 0)
        event_flags_system['cPlayer:1stPresentHatType'] = 5
    MainNpc.SetItemName(0, 14, 6)
    return

flow Root:
    if (EventFlowSystemActor.IsMyVillage()) and (event_flags_system['cPlayer:MakeVillagePlayerFlag']) and (MainNpc.NpcBirthType('cFirst')) and (MainNpc.IsNnpcTent()) and (not event_flag_npc['cNpcSave:TalkLifeStart1P1st']) and (MainNpc.NpcIsSitting() == 4):
        run 1P_Lifestart_Conv
        event_flags_npc['cNpcSave:TalkLifeStart1P1st'] = true
        EventFlowSystemActor.ExitFlowchart()
    run sub_tm!Root

flow sub_tm!Root:
    return


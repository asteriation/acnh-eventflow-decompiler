flow ChkCampsite:
    if event_flags_system['cPlayer:PAnnounceCampsite']:
        if EventFlowSystemActor.IsCampSiteOccupied():
            subflow_results[9] = 3
            subflow_results[4] = 1
            event_flags_system['cPlayer:PAnnounceCampsite'] = true
    elif EventFlowSystemActor.FacilityOpenPastDays('cCampSite', 8):
        if event_flags_system['cLand:CampSiteBuilt']:
            if event_flags_system['cLand:CampSiteBuiltToday']:
                subflow_results[9] = 1
                subflow_results[4] = 1
                event_flags_system['cPlayer:PAnnounceCampsite'] = true
            else:
                subflow_results[9] = 2
                subflow_results[4] = 1
                event_flags_system['cPlayer:PAnnounceCampsite'] = true
    elif EventFlowSystemActor.IsCampSiteOccupied():
        subflow_results[9] = 3
        subflow_results[4] = 1
        event_flags_system['cPlayer:PAnnounceCampsite'] = true
    else:
        event_flags_system['cPlayer:PAnnounceCampsite'] = true
    return

flow ChkMarket:
    fEvent29 = EventFlowSystemActor.ShopLevel()
    if fEvent29 == NooksCrannyUpgraded:
        run CmnPhoneCallImmQ
        if EventFlowSystemActor.FacilityOpenPastDays('cMarket2', 8):
            if not event_flags_system['cPlayer:TownNewsHeardShopOpen2Flag']:
                if event_flags_system['cLand:MarketOpen1stDay2']:
                    subflow_results[7] = 5
                else:
                    subflow_results[7] = 6
                subflow_results[4] = 1
                event_flags_system['cPlayer:TownNewsHeardShopOpen2Flag'] = true
        else:
            event_flags_system['cPlayer:TownNewsHeardShopOpen2Flag'] = true
    elif fEvent29 == NooksCrannyInitial:
        if event_flags_system['cLand:MarketConstruction2']:
            subflow_results[7] = 4
            run CmnPhoneCallImmQ
            subflow_results[4] = 1
        elif event_flags_system['cLand:MarketRemodelingFlag2']:
            subflow_results[7] = 3
            run CmnPhoneCallImmQ
            subflow_results[4] = 1
        elif (subflow_results[0] == 0) and (not event_flags_system['cPlayer:TownNewsHeardShopOpen1Flag']):
            if event_flags_system['cLand:MarketOpen1stDay1']:
                subflow_results[7] = 1
            else:
                subflow_results[7] = 2
            event_flags_system['cPlayer:TownNewsHeardShopOpen1Flag'] = true
            run CmnPhoneCallImmQ
            subflow_results[4] = 1
    return

flow ChkMuseum:
    if event_flags_system['cLand:MuseumConstructionToday']:
        subflow_results[6] = 3
        subflow_results[4] = 1
    elif event_flags_system['cLand:Museum2ConstructionToday']:
        subflow_results[6] = 6
        subflow_results[4] = 1
    else:
        fEvent6 = EventFlowSystemActor.MuseumLevel()
        if fEvent6 == BlathersMuseumNoArt:
            if EventFlowSystemActor.FacilityOpenPastDays('cMuseum', 8):
                if not event_flags_system['cPlayer:TownNewsHeardMuseumOpenFlag']:
                    if event_flags_system['cLand:Museum2BuiltToday']:
                        subflow_results[6] = 4
                    else:
                        subflow_results[6] = 5
                    subflow_results[4] = 1
                    event_flags_system['cPlayer:TownNewsHeardMuseumOpenFlag'] = true
            else:
                event_flags_system['cPlayer:TownNewsHeardMuseumOpenFlag'] = true
        elif fEvent6 == BlathersTent:
            if (subflow_results[0] == 0) and (not event_flags_system['cPlayer:AnnouncementOwlMovedIn']):
                if event_flags_system['cLand:MuseumTentBuiltToday']:
                    subflow_results[6] = 1
                else:
                    subflow_results[6] = 2
                subflow_results[4] = 1
                event_flags_system['cPlayer:AnnouncementOwlMovedIn'] = true
        elif fEvent6 == BlathersMuseumArt:
            if EventFlowSystemActor.FacilityOpenPastDays('cMuseum2', 8):
                if not event_flags_system['cPlayer:TownNewsHeardMuseum2OpenFlag']:
                    if event_flags_system['cLand:Museum3BuiltToday']:
                        subflow_results[6] = 7
                    else:
                        subflow_results[6] = 8
                    subflow_results[4] = 1
                    event_flags_system['cPlayer:TownNewsHeardMuseum2OpenFlag'] = true
            else:
                event_flags_system['cPlayer:TownNewsHeardMuseum2OpenFlag'] = true
    return

flow ChkOfficeNews:
    if event_flags_system['cLand:BuiltTownOfficeToday']:
        subflow_results[13] = 4
    elif event_flags_system['cLand:RcoNoticeBuildInfomationOffice']:
        if event_flags_system['cLand:OfficeConstruction1']:
            subflow_results[13] = 5
            if subflow_results[4] == 1:
                run sub_grp!Event63
        else:
            subflow_results[13] = 3
    else:
        run sub_grp!Event63
    return

flow ChkTailor:
    if EventFlowSystemActor.FacilityOpenPastDays('cTailor', 8):
        if (not event_flags_system['cPlayer:PAnnounceTailorBuilt']) and (event_flags_system['cLand:TailorBuilt']):
            if event_flags_system['cLand:TailorBuiltToday']:
                subflow_results[8] = 1
            else:
                subflow_results[8] = 2
            subflow_results[4] = 1
            event_flags_system['cPlayer:PAnnounceTailorBuilt'] = true
    else:
        event_flags_system['cPlayer:PAnnounceTailorBuilt'] = true
    return

flow CmnFacilitiesChk:
    run ChkMuseum
    run ChkMarket
    run ChkTailor
    run ChkCampsite
    return

flow CmnFoxVisitChk:
    if (event_flags_system['cLand:FoxPreVisit1Today']) and (subflow_results[4] == 0):
        subflow_results[4] = 1
    return

flow CmnMoveInChk:
    if MainNpc.IsExistMoveNpc(false):
        subflow_results[5] = 1
        subflow_results[4] = 1
    return

flow CmnMoveOutChk:
    if MainNpc.IsExistMoveNpc(true):
        subflow_results[10] = 1
        if subflow_results[4] == 0:
            subflow_results[4] = 2
        else:
            subflow_results[4] = 3
    return

flow CmnPhoneCallImmQ:
    if (event_flags_system['cPlayer:MakeVillagePlayerFlag']) and (not event_flags_system['cLand:PAnnounceRcoCalling']):
        subflow_results[13] = 1
    return

flow Root:
    run CmnMoveInChk
    run CmnFacilitiesChk
    run CmnMoveOutChk
    run CmnFoxVisitChk
    if subflow_results[0] == 0:
        run ChkOfficeNews
    return

flow sub_grp!Event63:
    if (event_flags_system['cLand:ImmQClearNextDay']) and (event_flags_system['cPlayer:MainmenuRecipe']) and (not event_flags_system['cPlayer:TownNewsHeardRemakeTrialFlag']):
        subflow_results[13] = 2
        event_flags_system['cPlayer:TownNewsHeardRemakeTrialFlag'] = true
        event_flags_system['cPlayer:RcoTalkAboutRemakeTrial'] = true


flow Root:
    run ToJuneBrideStudio
    if not event_flags_system['cPlayer:SpnFirstTalkedAtCommuneIsland']:
        event_flags_system['cPlayer:SpnFirstTalkedAtCommuneIsland'] = true
        if event_flags_system['cPlayer:SpnTalkAtHomelandToday']:
            MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:001_01_01', false)
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:001_01_02', false)
        MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:001_02', false)
        event_flags_system['cPlayer:SpnTalkAtCommuneToday'] = true
    elif not event_flags_system['cPlayer:SpnTalkAtCommuneToday']:
        event_flags_system['cPlayer:SpnTalkAtCommuneToday'] = true
        if event_flags_system['cPlayer:SpnPhotoStudioGuideDone']:
            MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:021', false)
            MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:022', false)
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:011', false)
    elif event_flags_system['cPlayer:SpnPhotoStudioGuideDone']:
        MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:023', false)
        run SNPC_spn_03_Studio::Spn_Explain_Select
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/spn/SP_spn_02_Commune:002', false)
    return

flow Spn_JuneBride_GetFence:
    fEvent91 = subflow_results[0]
    if fEvent91 == 6:
        if not event_flags_system['cPlayer:AlwJuneBrideQuestClearFlag']:
            run sub_grp!Event59
    elif fEvent91 == 7:
        run sub_grp!Event59
    return

flow Spn_JuneBride_Select:
    MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:010', false)
    run Event31
    return

flow ToJuneBrideStudio:
    if not EventFlowSystemActor.TermEventNow('JuneBride', false):
        if (EventFlowSystemActor.EnvCheckBetweenDate(7, 1, 7, 7, 'cGrowUpTime')) and (event_flags_system['cPlayer:SpnJuneBrideTalkEventFrag']) and (not event_flags_system['cPlayer:SpnJuneBrideClearTalkFrag']):
            if event_flags_system['cPlayer:AlwJuneBrideDayCount'] == 0:
                MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:023', false)
            else:
                MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:020', false)
                if event_flags_system['cPlayer:AlwJuneBrideDayCount'] >= 6:
                    MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:021', false)
                else:
                    MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:022', false)
            MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:024', false)
            event_flags_system['cPlayer:SpnJuneBrideClearTalkFrag'] = true
            EventFlowSystemActor.ExitFlowchart()
    elif event_flags_system['cPlayer:CommuneIslandAvailable']:
        run SNPC_alw_01_Studio::Alw_DayChk
        if not event_flags_system['cPlayer:AlwJuneBrideQuestClearFlag']:
            if event_flags_system['cPlayer:SpnTalkAtCommuneToday']:
                run Spn_JuneBride_GetFence
                run Spn_JuneBride_Select
            else:
                event_flags_system['cPlayer:SpnTalkAtCommuneToday'] = true
                MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:009', false)
                run Spn_JuneBride_GetFence
                run Spn_JuneBride_Select
        elif not event_flags_system['cPlayer:SpnJuneBrideClearTalkFrag']:
            event_flags_system['cPlayer:SpnJuneBrideClearTalkFrag'] = true
            event_flags_system['cPlayer:SpnTalkAtCommuneToday'] = true
            fEvent42 = subflow_results[0]
            if fEvent42 in (0, 1, 2, 3, 4, 5):
                MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:014', false)
                if EventFlowSystemActor.EnvCheckBetweenDate(6, 30, 6, 30, 'cGrowUpTime'):
                    MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:014_02', false)
                else:
                    MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:014_01', false)
                EventFlowSystemActor.ExitFlowchart()
            elif fEvent42 == 6:
                MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:015', false)
                run Spn_JuneBride_GetFence
                EventFlowSystemActor.ExitFlowchart()
            elif fEvent42 == 7:
                MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:016', false)
                run Spn_JuneBride_GetFence
                if EventFlowSystemActor.EnvCheckBetweenDate(6, 30, 6, 30, 'cGrowUpTime'):
                    MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:014_02', false)
                else:
                    MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:014_01', false)
                EventFlowSystemActor.ExitFlowchart()
        elif subflow_results[0] in (0, 1, 2, 3, 4, 5):
            run Spn_JuneBride_Select
        else:
            run Spn_JuneBride_GetFence
            run Spn_JuneBride_Select
    return

flow sub_grp!Event59:
    if not event_flags_system['cPlayer:SpnJuneBrideGetFenceFrag']:
        if event_flags_system['cPlayer:SpnJuneBrideNotGetFenceTodayFrag']:
            MainNpc.NpcSetRewardRecipe(12894, false)
            if EventFlowSystemActor.ShoppingCapacity(65534, 'cReward'):
                MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:017_04', false)
                MainNpc.SetDeliveryItem(1, true)
                MainNpc.NpcDelivery('Default', 1)
                event_flags_system['cPlayer:SpnJuneBrideGetFenceFrag'] = true
                if event_flags_system['cPlayer:MainmenuRecipe']:
                    MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:018', false)
                    fEvent72 = subflow_results[0]
                    if fEvent72 == 6:
                        EventFlowSystemActor.ExitFlowchart()
                    elif fEvent72 == 7:
                        MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:019', false)
entrypoint Event31:
                        fEvent31 = EventFlowSystemActor.GeneralTalkChoice3()
                        if fEvent31 == 0:
                            MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:011', false)
                            EventFlowSystemActor.MessageSuspend()
                            EventFlowSystemActor.SystemRequestChangeStage('cJuneBrideStudio', 'cHeartWipe', 'cCircle', 'cBlack', 1.0, 1.0)
                        elif fEvent31 == 1:
                            MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:012', false)
                            run SNPC_spn_03_Studio::Spn_Explain_Select
                        elif fEvent31 == 2:
                            MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:013', false)
                        EventFlowSystemActor.ExitFlowchart()
                else:
                    MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:018_02', false)
                    EventFlowSystemActor.ExitFlowchart()
        else:
            MainNpc.NpcSetRewardRecipe(12894, false)
            MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:017_01', false)
            if EventFlowSystemActor.ShoppingCapacity(65534, 'cReward'):
                MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:017_02', false)
                MainNpc.SetDeliveryItem(1, true)
                MainNpc.NpcDelivery('Default', 1)
                event_flags_system['cPlayer:SpnJuneBrideGetFenceFrag'] = true
                if event_flags_system['cPlayer:MainmenuRecipe']:
                    MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:018', false)
                    fEvent72 = subflow_results[0]
                    if fEvent72 == 6:
                        EventFlowSystemActor.ExitFlowchart()
                    elif fEvent72 == 7:
                        MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:019', false)
entrypoint Event31:
                        fEvent31 = EventFlowSystemActor.GeneralTalkChoice3()
                        if fEvent31 == 0:
                            MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:011', false)
                            EventFlowSystemActor.MessageSuspend()
                            EventFlowSystemActor.SystemRequestChangeStage('cJuneBrideStudio', 'cHeartWipe', 'cCircle', 'cBlack', 1.0, 1.0)
                        elif fEvent31 == 1:
                            MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:012', false)
                            run SNPC_spn_03_Studio::Spn_Explain_Select
                        elif fEvent31 == 2:
                            MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:013', false)
                        EventFlowSystemActor.ExitFlowchart()
                else:
                    MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:018_02', false)
                    EventFlowSystemActor.ExitFlowchart()
            else:
                MainNpc.OpenMessageWindow('TalkSNpc/spn/GEvent/SP_spn_GEvent_JuneBride:017_03', false)
                event_flags_system['cPlayer:SpnJuneBrideNotGetFenceTodayFrag'] = true
                EventFlowSystemActor.ExitFlowchart()


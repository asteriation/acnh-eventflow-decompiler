flow Cmn_Present:
    MainNpc.SetDeliveryItemAtRandom(12484, false, 'cVillageRemakePattern', 0)
    MainNpc.NpcDelivery('Default', 1)
    return

flow CompCheck:
    if EventFlowSystemActor.IsMyVillage():
        if (event_flags_system['cPlayer:OwlStampGotInsect']) and (event_flags_system['cPlayer:OwlStampGotFish']) and (event_flags_system['cPlayer:OwlStampGotFossil']):
            MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_24_Museum_StampRally:032', false)
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_24_Museum_StampRally:031', false)
    elif (event_flags_system['cPlayerVisit:OwlStampGotInsect']) and (event_flags_system['cPlayerVisit:OwlStampGotFish']) and (event_flags_system['cPlayerVisit:OwlStampGotFossil']):
        MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_24_Museum_StampRally:032', false)
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_24_Museum_StampRally:031', false)
    return

flow From2ndTime:
    if not ((not EventFlowSystemActor.TermEventNow('InternationalMuseum', false)) or (event_flags_system['cLand:Museum2BuiltToday']) or (event_flags_system['cLand:Museum3BuiltToday'])):
        if not EventFlowSystemActor.IsMyVillage():
            if event_flags_system['cPlayerVisit:OwlStampPocketWasFull']:
                if EventFlowSystemActor.SystemHasBaggageSpace(1, 'cPocketBag'):
                    run Judge
            else:
                if event_flags_system['cPlayerVisit:StampRallyRunningForPlayer']:
                    run Judge
                else:
                    MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_24_Museum_StampRally:007', false)
                    MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_24_Museum_StampRally:003', false)
                    run QuestJoin
        elif event_flags_system['cPlayer:OwlStampPocketWasFull']:
            if EventFlowSystemActor.SystemHasBaggageSpace(1, 'cPocketBag'):
                run Judge
        else:
            if event_flags_system['cPlayer:StampRallyRunningForPlayer']:
                run Judge
            else:
                if event_flags_system['cPlayer:OwlStampPlayed']:
                    MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_24_Museum_StampRally:004', false)
                    MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_24_Museum_StampRally:006', false)
                else:
                    MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_24_Museum_StampRally:001', false)
                    MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_24_Museum_StampRally:002', false)
                    MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_24_Museum_StampRally:003', false)
                run QuestJoin
    return

flow GotReward:
    if EventFlowSystemActor.IsMyVillage():
        if event_flags_system['cPlayer:OwlStampGotRewardExplain']:
            MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_24_Museum_StampRally:026', false)
        else:
            event_flags_system['cPlayer:OwlStampGotRewardExplain'] = true
            MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_24_Museum_StampRally:025', false)
    elif event_flags_system['cPlayerVisit:OwlStampGotRewardExplain']:
        MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_24_Museum_StampRally:026', false)
    else:
        event_flags_system['cPlayerVisit:OwlStampGotRewardExplain'] = true
        MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_24_Museum_StampRally:025', false)
    return

flow Judge:
    run Stamp1
    run Stamp2
    run Stamp3
    return

flow PocketChk:
    if EventFlowSystemActor.SystemHasBaggageSpace(1, 'cPocketBag'):
        if EventFlowSystemActor.IsMyVillage():
            event_flags_system['cPlayer:OwlStampPocketWasFull'] = false
        else:
            event_flags_system['cPlayerVisit:OwlStampPocketWasFull'] = false
    else:
        if EventFlowSystemActor.IsMyVillage():
            event_flags_system['cPlayer:OwlStampPocketWasFull'] = true
        else:
            event_flags_system['cPlayerVisit:OwlStampPocketWasFull'] = true
        MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_24_Museum_StampRally:014', false)
        EventFlowSystemActor.ExitFlowchart()
    return

flow QuestJoin:
    run Event142
    return

flow Root:
    if not ((not EventFlowSystemActor.TermEventNow('InternationalMuseum', false)) or (event_flags_system['cLand:Museum2BuiltToday']) or (event_flags_system['cLand:Museum3BuiltToday'])):
        if event_flags_system['cPlayer:OwlStampPlayed']:
            MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_24_Museum_StampRally:005', false)
            MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_24_Museum_StampRally:006', false)
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_24_Museum_StampRally:002', false)
            MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_24_Museum_StampRally:003', false)
entrypoint Event142:
        if EventFlowSystemActor.IsMyVillage():
            event_flags_system['cPlayer:StampRallyRunningForPlayer'] = true
            event_flags_system['cPlayer:OwlStampPlayed'] = true
        else:
            event_flags_system['cPlayerVisit:StampRallyRunningForPlayer'] = true
        EventFlowSystemActor.ExitFlowchart()
    return

flow Stamp1:
    if EventFlowSystemActor.IsMyVillage():
        if (not event_flags_system['cPlayer:OwlStampGotInsect']) and (event_flags_system['cPlayer:OwlInsectStampRally1']) and (event_flags_system['cPlayer:OwlInsectStampRally2']) and (event_flags_system['cPlayer:OwlInsectStampRally3']):
            if event_flags_system['cPlayer:OwlStampPocketWasFull']:
                MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_24_Museum_StampRally:015', false)
            else:
                MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_24_Museum_StampRally:011', false)
    elif (not event_flags_system['cPlayerVisit:OwlStampGotInsect']) and (event_flags_system['cPlayerVisit:OwlInsectStampRally1']) and (event_flags_system['cPlayerVisit:OwlInsectStampRally2']) and (event_flags_system['cPlayerVisit:OwlInsectStampRally3']):
        if event_flags_system['cPlayerVisit:OwlStampPocketWasFull']:
            MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_24_Museum_StampRally:015', false)
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_24_Museum_StampRally:011', false)
        if event_flags_system['cPlayer:OwlStampGotInsectReward']:
            MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_24_Museum_StampRally:022', false)
            run GotReward
        else:
            run PocketChk
            run Cmn_Present
            EventFlowSystemActor.SetItemToPocket(12485, 1)
            event_flags_system['cPlayer:OwlStampGotInsectReward'] = true
            MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_24_Museum_StampRally:021', false)
        EventFlowSystemActor.UIStampRallyMuseumFromOwlHandling('cInsect')
        if EventFlowSystemActor.IsMyVillage():
            event_flags_system['cPlayer:OwlStampGotInsect'] = true
        else:
            event_flags_system['cPlayerVisit:OwlStampGotInsect'] = true
        run CompCheck
        EventFlowSystemActor.ExitFlowchart()
    return

flow Stamp2:
    if EventFlowSystemActor.IsMyVillage():
        if (not event_flags_system['cPlayer:OwlStampGotFish']) and (event_flags_system['cPlayer:OwlFishStampRally1']) and (event_flags_system['cPlayer:OwlFishStampRally2']) and (event_flags_system['cPlayer:OwlFishStampRally3']):
            if event_flags_system['cPlayer:OwlStampPocketWasFull']:
                MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_24_Museum_StampRally:015', false)
            else:
                MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_24_Museum_StampRally:012', false)
    elif (not event_flags_system['cPlayerVisit:OwlStampGotFish']) and (event_flags_system['cPlayerVisit:OwlFishStampRally1']) and (event_flags_system['cPlayerVisit:OwlFishStampRally2']) and (event_flags_system['cPlayerVisit:OwlFishStampRally3']):
        if event_flags_system['cPlayerVisit:OwlStampPocketWasFull']:
            MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_24_Museum_StampRally:015', false)
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_24_Museum_StampRally:012', false)
        if event_flags_system['cPlayer:OwlStampGotFishReward']:
            MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_24_Museum_StampRally:023', false)
            run GotReward
        else:
            run PocketChk
            run Cmn_Present
            EventFlowSystemActor.SetItemToPocket(12486, 1)
            event_flags_system['cPlayer:OwlStampGotFishReward'] = true
            MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_24_Museum_StampRally:021', false)
        EventFlowSystemActor.UIStampRallyMuseumFromOwlHandling('cFish')
        if EventFlowSystemActor.IsMyVillage():
            event_flags_system['cPlayer:OwlStampGotFish'] = true
        else:
            event_flags_system['cPlayerVisit:OwlStampGotFish'] = true
        run CompCheck
        EventFlowSystemActor.ExitFlowchart()
    return

flow Stamp3:
    if EventFlowSystemActor.IsMyVillage():
        if (not event_flags_system['cPlayer:OwlStampGotFossil']) and (event_flags_system['cPlayer:OwlFossilStampRally1']) and (event_flags_system['cPlayer:OwlFossilStampRally2']) and (event_flags_system['cPlayer:OwlFossilStampRally3']):
            if event_flags_system['cPlayer:OwlStampPocketWasFull']:
                MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_24_Museum_StampRally:015', false)
            else:
                MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_24_Museum_StampRally:013', false)
    elif (not event_flags_system['cPlayerVisit:OwlStampGotFossil']) and (event_flags_system['cPlayerVisit:OwlFossilStampRally1']) and (event_flags_system['cPlayerVisit:OwlFossilStampRally2']) and (event_flags_system['cPlayerVisit:OwlFossilStampRally3']):
        if event_flags_system['cPlayerVisit:OwlStampPocketWasFull']:
            MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_24_Museum_StampRally:015', false)
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_24_Museum_StampRally:013', false)
        if event_flags_system['cPlayer:OwlStampGotFossilReward']:
            MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_24_Museum_StampRally:024', false)
            run GotReward
        else:
            run PocketChk
            run Cmn_Present
            EventFlowSystemActor.SetItemToPocket(12484, 1)
            event_flags_system['cPlayer:OwlStampGotFossilReward'] = true
            MainNpc.OpenMessageWindow('TalkSNpc/owl/SP_owl_24_Museum_StampRally:021', false)
        EventFlowSystemActor.UIStampRallyMuseumFromOwlHandling('cFossil')
        if EventFlowSystemActor.IsMyVillage():
            event_flags_system['cPlayer:OwlStampGotFossil'] = true
        else:
            event_flags_system['cPlayerVisit:OwlStampGotFossil'] = true
        run CompCheck
        EventFlowSystemActor.ExitFlowchart()
    return


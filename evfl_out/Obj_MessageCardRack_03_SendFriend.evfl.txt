flow EntryPoint_CheckUnlockFriend:
    if event_flags_system['cPlayer:FriendMailSendEnable']:
        run Obj_MessageCardRack::EntryPoint_StartTalk
    elif (event_flags_system['cPlayer:NetIsRegistHomeLand']) and (EventFlowSystemActor.NetHasAddressData('cFriend')):
        event_flags_system['cPlayer:FriendMailSendEnable'] = true
        DynamicCast_dod.OpenMessageWindow('TalkSNpc/dod/SP_dod_50_PostOffice:010', false)
        if not event_flags_system['cPlayer:FriendMailGuideRetentionPeriod']:
            DynamicCast_dod.OpenMessageWindow('TalkSNpc/dod/SP_dod_50_PostOffice:020', true)
            EventFlowSystemActor.OpenMessageWindow('Dialog/DIALOG_Msg:0335', false)
            event_flags_system['cPlayer:FriendMailGuideRetentionPeriod'] = true
        DynamicCast_dod.OpenMessageWindow('TalkSNpc/dod/SP_dod_50_PostOffice:040', false)
        if EventFlowSystemActor.GeneralTalkChoice2() == 0:
            run Obj_MessageCardRack::EntryPoint_SelectTo
        else:
            run Obj_MessageCardRack::EntryPoint_Cancel
    else:
        run sub_Event125
    return

flow EntryPoint_EditFriend:
    EventFlowSystemActor.CheckFreeCommunication(true)
    if EventFlowSystemActor.IsApprovedFreeCommunication():
        run Event46
    else:
        DynamicCast_dod.OpenMessageWindow('TalkSNpc/dod/SP_dod_50_PostOffice:311', true)
    return

flow EntryPoint_RetrySendFriend:
    run Event5
    return

flow EntryPoint_SendError:
    EventFlowSystemActor.MessageSuspend()
    EventFlowSystemActor.MessageUnlockNext()
    run Obj_MessageCardRack::EntryPoint_PostProcedure
    EventFlowSystemActor.UIMoneyAppear()
    DynamicCast_dod.OpenMessageWindow('TalkSNpc/dod/SP_dod_50_PostOffice:380', true)
    if EventFlowSystemActor.GeneralTalkChoice2() == 0:
        run EntryPoint_RetrySendFriend
    else:
        DynamicCast_dod.OpenMessageWindow('TalkSNpc/dod/SP_dod_50_PostOffice:381', false)
        EventFlowSystemActor.BellCountDown(200, False)
        if EventFlowSystemActor.HasAttachedPresent():
            DynamicCast_dod.OpenMessageWindow('TalkSNpc/dod/SP_dod_50_PostOffice:382', true)
            EventFlowSystemActor.ReturnAttachedPresentToBaggage()
        EventFlowSystemActor.MessageSuspend()
        event_flags_system['cPlayer:MessageCardPayment'] = false
        EventFlowSystemActor.UIMoneyDisappear()
        run Obj_MessageCardRack::EntryPoint_SaveToMenu
    return

flow EntryPoint_SendFriend:
    EventFlowSystemActor.UIMoneyDisappear()
    EventFlowSystemActor.CheckFreeCommunication(true)
    if not EventFlowSystemActor.IsApprovedFreeCommunication():
        DynamicCast_dod.OpenMessageWindow('TalkSNpc/dod/SP_dod_50_PostOffice:311', true)
    elif EventFlowSystemActor.NetHasPOPID(false):
        EventFlowSystemActor.NetUpdateFriendList('cFriendOnly')
        if EventFlowSystemActor.NetHasAddressData('cFriend'):
            DynamicCast_dod.OpenMessageWindow('TalkSNpc/dod/SP_dod_50_PostOffice:301', true)
            EventFlowSystemActor.UIMoneyDisappear()
            EventFlowSystemActor.UIAddresseeFriendHandling()
            if EventFlowSystemActor.UIResultMenuDecide():
                EventFlowSystemActor.SetTagFromUIResult(0, 'cSelectFriendName')
                if EventFlowSystemActor.LimitSendMailToFriend():
                    DynamicCast_dod.OpenMessageWindow('TalkSNpc/dod/SP_dod_50_PostOffice:320', true)
                else:
                    DynamicCast_dod.OpenMessageWindow('TalkSNpc/dod/SP_dod_50_PostOffice:210_01', true)
                    if EventFlowSystemActor.ExistUnfinishMail():
                        EventFlowSystemActor.ChangeAddressUnfinishMail()
entrypoint Event46:
                        EventFlowSystemActor.UIMoneyDisappear()
                        EventFlowSystemActor.UIMsgCardEditTextHandling('cMessageCard')
                        if EventFlowSystemActor.UIResultMenuDecide():
                            EventFlowSystemActor.SaveSetFromUIResult('cMsgCard')
                            EventFlowSystemActor.UIMoneyAppear()
                            if EventFlowSystemActor.HasBellCount(200):
                                DynamicCast_dod.OpenMessageWindow('TalkSNpc/dod/SP_dod_50_PostOffice:500', true)
                                event_flags_system['cPlayer:MessageCardPayment'] = true
                                EventFlowSystemActor.BellCountDown(-200, False)
                                DynamicCast_dod.OpenMessageWindow('TalkSNpc/dod/SP_dod_50_PostOffice:321', true)
                                EventFlowSystemActor.UIMoneyDisappear()
entrypoint Event5:
                                run Obj_MessageCardRack::EntryPoint_PreProcedure
                                EventFlowSystemActor.MessageLockNext(1)
                                DynamicCast_dod.OpenMessageWindow('TalkSys/SYS_Network:001', false)
                                EventFlowSystemActor.NetConnectInit('cConnectInet', true)
                                if EventFlowSystemActor.CheckErrorType(2):
                                    run sub_Event102
                                else:
                                    EventFlowSystemActor.NetCheckNSA('cCheckNSA', true)
                                    if EventFlowSystemActor.CheckErrorType(2):
                                        run sub_Event102
                                    else:
                                        EventFlowSystemActor.MessageSuspend()
                                        DynamicCast_dod.OpenMessageWindow('TalkSys/SYS_Network:010', false)
                                        EventFlowSystemActor.SuspendSharePlayCtrlCheck()
                                        EventFlowSystemActor.UISaveIconAppear()
                                        EventFlowSystemActor.NetSendMailPreProc('cMessageCard')
                                        EventFlowSystemActor.SaveSimpleSave('cAll')
                                        EventFlowSystemActor.UISaveIconDisappear()
                                        EventFlowSystemActor.NetSendMail()
                                        if EventFlowSystemActor.CheckErrorType(2):
                                            EventFlowSystemActor.NetSendMailAfterFailProc()
                                            EventFlowSystemActor.ResumeSharePlayCtrlCheck()
                                            run EntryPoint_SendError
                                        else:
                                            event_flags_system['cPlayer:MessageCardPayment'] = false
                                            EventFlowSystemActor.ResumeSharePlayCtrlCheck()
                                            EventFlowSystemActor.MessageSuspend()
                                            EventFlowSystemActor.MessageUnlockNext()
                                            run Obj_MessageCardRack::EntryPoint_PostProcedure
                                            DynamicCast_dod.OpenMessageWindow('TalkSNpc/dod/SP_dod_50_PostOffice:501', true)
                                            EventFlowSystemActor.UIMoneyDisappear()
                            else:
                                DynamicCast_dod.OpenMessageWindow('TalkSNpc/dod/SP_dod_50_PostOffice:510', true)
                                EventFlowSystemActor.UIMoneyDisappear()
                                run Obj_MessageCardRack::EntryPoint_EditKeepByNoMoney
                        else:
                            run Obj_MessageCardRack::EntryPoint_EditCancel
                    else:
                        EventFlowSystemActor.UIMoneyDisappear()
                        EventFlowSystemActor.UIMsgCardSelectHandling()
                        if EventFlowSystemActor.UIResultMenuDecide():
entrypoint Event46:
                            EventFlowSystemActor.UIMoneyDisappear()
                            EventFlowSystemActor.UIMsgCardEditTextHandling('cMessageCard')
                            if EventFlowSystemActor.UIResultMenuDecide():
                                EventFlowSystemActor.SaveSetFromUIResult('cMsgCard')
                                EventFlowSystemActor.UIMoneyAppear()
                                if EventFlowSystemActor.HasBellCount(200):
                                    DynamicCast_dod.OpenMessageWindow('TalkSNpc/dod/SP_dod_50_PostOffice:500', true)
                                    event_flags_system['cPlayer:MessageCardPayment'] = true
                                    EventFlowSystemActor.BellCountDown(-200, False)
                                    DynamicCast_dod.OpenMessageWindow('TalkSNpc/dod/SP_dod_50_PostOffice:321', true)
                                    EventFlowSystemActor.UIMoneyDisappear()
entrypoint Event5:
                                    run Obj_MessageCardRack::EntryPoint_PreProcedure
                                    EventFlowSystemActor.MessageLockNext(1)
                                    DynamicCast_dod.OpenMessageWindow('TalkSys/SYS_Network:001', false)
                                    EventFlowSystemActor.NetConnectInit('cConnectInet', true)
                                    if EventFlowSystemActor.CheckErrorType(2):
                                        run sub_Event102
                                    else:
                                        EventFlowSystemActor.NetCheckNSA('cCheckNSA', true)
                                        if EventFlowSystemActor.CheckErrorType(2):
                                            run sub_Event102
                                        else:
                                            EventFlowSystemActor.MessageSuspend()
                                            DynamicCast_dod.OpenMessageWindow('TalkSys/SYS_Network:010', false)
                                            EventFlowSystemActor.SuspendSharePlayCtrlCheck()
                                            EventFlowSystemActor.UISaveIconAppear()
                                            EventFlowSystemActor.NetSendMailPreProc('cMessageCard')
                                            EventFlowSystemActor.SaveSimpleSave('cAll')
                                            EventFlowSystemActor.UISaveIconDisappear()
                                            EventFlowSystemActor.NetSendMail()
                                            if EventFlowSystemActor.CheckErrorType(2):
                                                EventFlowSystemActor.NetSendMailAfterFailProc()
                                                EventFlowSystemActor.ResumeSharePlayCtrlCheck()
                                                run EntryPoint_SendError
                                            else:
                                                event_flags_system['cPlayer:MessageCardPayment'] = false
                                                EventFlowSystemActor.ResumeSharePlayCtrlCheck()
                                                EventFlowSystemActor.MessageSuspend()
                                                EventFlowSystemActor.MessageUnlockNext()
                                                run Obj_MessageCardRack::EntryPoint_PostProcedure
                                                DynamicCast_dod.OpenMessageWindow('TalkSNpc/dod/SP_dod_50_PostOffice:501', true)
                                                EventFlowSystemActor.UIMoneyDisappear()
                                else:
                                    DynamicCast_dod.OpenMessageWindow('TalkSNpc/dod/SP_dod_50_PostOffice:510', true)
                                    EventFlowSystemActor.UIMoneyDisappear()
                                    run Obj_MessageCardRack::EntryPoint_EditKeepByNoMoney
                            else:
                                run Obj_MessageCardRack::EntryPoint_EditCancel
                        else:
                            run Obj_MessageCardRack::EntryPoint_Cancel
            else:
                run Obj_MessageCardRack::EntryPoint_Cancel
        else:
            run sub_Event131
    else:
        run sub_Event131
    return

flow sub_Event102:
    run EntryPoint_SendError

flow sub_Event125:
    run Obj_MessageCardRack::EntryPoint_StartTalk

flow sub_Event131:
    DynamicCast_dod.OpenMessageWindow('TalkSNpc/dod/SP_dod_50_PostOffice:312', true)


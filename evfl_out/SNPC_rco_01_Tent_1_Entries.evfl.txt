flow AboutBuildMuseumTent_Force:
    run RcoTent_Force_PlayerPos
    event_flags_system['cPlayerTemp:RcoTalkSceneFlag'] = true
entrypoint Event119:
    event_flags_system['cPlayer:RcoTalkAfterMuseumTent'] = false
    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_04_DonationReward:016', false)
    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_04_DonationReward:017', false)
    if not event_flags_system['cPlayer:RcoPaid1stCharge']:
        if event_flags_system['cLand:TodayStartTown1P']:
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_04_DonationReward:018_01', false)
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_04_DonationReward:018_02', false)
        MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_04_DonationReward:019', false)
    return

flow AboutBuildMuseumTent_Force_Init:
    run RcoTent_Force_DisableTalkCamera
    return

flow CancelRemakeTrial:
    run Event5
    return

flow DoRemakeTrial:
    run Event89
    return

flow RcoAskRemakeTrial:
    EventFlowSystemActor.NpcEventItemSet(3436, 0, 'cTalk', 'ItemPrice')
    DynamicCast_rco.RcoStandUpChair()
    if not event_flags_system['cPlayer:RcoRemakeTrialOngoing']:
        DynamicCast_rco.NpcWaitTalkPrepare()
        DynamicCast_rco.TurnBody(10, 0.0)
        DynamicCast_rco.NpcWaitTurn()
        event_flags_system['cPlayer:RcoTalkAboutRemakeTrial'] = false
        event_flags_system['cPlayer:RcoHeardInviteRemakeWS'] = true
        fork:
            branch0:
            branch1:
                if event_flags_system['cPlayerTemp:RcoAccessWorkingTable']:
                    Player.PlayerChangeStateDemoTalk()
                    Player.TurnBody(0, 0.0)
            branch2:
                DynamicCast_rco.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:101', false)
        fEvent2 = EventFlowSystemActor.GeneralTalkChoice3()
        if fEvent2 == 0:
entrypoint Event89:
            DynamicCast_rco.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:103', true)
            EventFlowSystemActor.FadeOut('cCircle', 'cCircle', 'cBlack', 1.0, 1.0, true)
            EventFlowSystemActor.WaitFrame(45)
            EventFlowSystemActor.FadeIn(true)
            DynamicCast_rco.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:201', false)
            DynamicCast_rco.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:202', false)
            if event_flags_system['cPlayer:UseCloset']:
                DynamicCast_rco.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:203_01', false)
            else:
                DynamicCast_rco.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:203_02', false)
            DynamicCast_rco.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:204', false)
            if not EventFlowSystemActor.PlayerHasCraftRecipe(3436, ''):
                DynamicCast_rco.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:205_01', true)
                run Demo_Common_PhoneCall::SendingDataOneWay_DynamicJoin
                DynamicCast_rco.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:205_02', false)
                EventFlowSystemActor.PlayerSetCraftRecipe(3436, '')
                DynamicCast_rco.SmartPhone(1)
            DynamicCast_rco.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:206', false)
            event_flags_system['cPlayer:RcoRemakeTrialOngoing'] = true
            event_flags_system['cPlayerTemp:RcoAccessWorkingTable'] = false
            EventFlowSystemActor.ExitFlowchart()
        elif fEvent2 == 1:
            DynamicCast_rco.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:104', false)
            if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                run DoRemakeTrial
            else:
                run CancelRemakeTrial
        elif fEvent2 == 2:
entrypoint Event5:
            DynamicCast_rco.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:102', false)
            event_flags_system['cPlayerTemp:RcoAccessWorkingTable'] = false
    elif EventFlowSystemActor.HasTargetItem(3436, 1):
        if event_flags_system['cPlayer:RcoRemakeTrialGetFurniture']:
            DynamicCast_rco.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:111', false)
            DynamicCast_rco.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:115', false)
        else:
            event_flags_system['cPlayer:RcoRemakeTrialGetFurniture'] = true
            DynamicCast_rco.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:113', false)
            DynamicCast_rco.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:114_01', false)
        if EventFlowSystemActor.SystemHasBaggageSpace(1, 'cPocketBag'):
            DynamicCast_rco.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:116', false)
        else:
            DynamicCast_rco.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:114_02', false)
            event_flags_system['cPlayer:RemakeWs_TalkWhenItemFull'] = true
    else:
        DynamicCast_rco.NpcWaitTalkPrepare()
        DynamicCast_rco.TurnBody(10, 0.0)
        DynamicCast_rco.NpcWaitTurn()
        fork:
            branch0:
            branch1:
                if event_flags_system['cPlayerTemp:RcoAccessWorkingTable']:
                    Player.PlayerChangeStateDemoTalk()
                    Player.TurnBody(0, 0.0)
            branch2:
                DynamicCast_rco.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:111', false)
        DynamicCast_rco.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:112', false)
        event_flags_system['cPlayerTemp:RcoAccessWorkingTable'] = false
    return

flow RcoDIYongoing:
    if not EventFlowSystemActor.HasTargetItem(2500, 5):
        MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_03_PcHouseTent:911', false)
    elif event_flags_system['cPlayer:RcoDIYtrialGetMaterial']:
        MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_03_PcHouseTent:207', false)
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_03_PcHouseTent:921', true)
        event_flags_system['cPlayer:RcoDIYtrialGetMaterial'] = true
    return

flow RcoRemakeTrialIntro:
    run Event14
    return

flow RcoRemakeTrialIntro_Force:
    run RcoTent_Force_PlayerPos
    event_flags_system['cPlayerTemp:RcoTalkSceneFlag'] = true
entrypoint Event14:
    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_00_Common:000', false)
    if event_flags_system['cPlayer:PAnnouceHeardRemakeWsNewsToday']:
        MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:001_01', false)
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_09_RemakeWorkShop:001_02', false)
    event_flags_system['cPlayer:RcoEnableRemakeTrial'] = true
    event_flags_system['cPlayer:RcoTalkAboutRemakeTrial'] = false
    event_flags_system['cPlayer:RcoHeardInviteRemakeWS'] = true
    return

flow RcoRemakeTrialIntro_Force_Init:
    run RcoTent_Force_DisableTalkCamera
    return

flow RcoTentAboutBuildMuseumTent:
    run Event119
    return

flow RcoTentAboutMyhome:
    if event_flags_system['cPlayer:RcoPaid1stCharge']:
        run SNPC_rco_10_Common_AboutMyHome::Root
    elif EventFlowSystemActor.PlayerHouseLevel() == Homeless:
        MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_03_PcHouseTent:400', false)
    else:
        EventFlowSystemActor.UISonkatsuPointAppear()
        EventFlowSystemActor.SetTagFromSystem(0, 'cFlow', 'cDegit', '', 5000)
        if EventFlowSystemActor.HasLifeSupportPoint('Now', 5000):
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_03_PcHouseTent:402', false)
            if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_03_PcHouseTent:404', false)
                EventFlowSystemActor.LifeSupportPointCountDown(-5000, false)
                event_flags_system['cPlayer:RcoPaid1stCharge'] = true
                event_flags_system['cLifeSupportAchievement:PayImmigrationCost'] += 1
                MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_03_PcHouseTent:405', false)
                EventFlowSystemActor.UISonkatsuPointDisappear()
                MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_03_PcHouseTent:406', false)
                fEvent26 = EventFlowSystemActor.GeneralTalkChoice3()
                if fEvent26 == 0:
                    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_03_PcHouseTent:407_01', false)
                elif fEvent26 == 1:
                    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_03_PcHouseTent:407_02', false)
                elif fEvent26 == 2:
                    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_03_PcHouseTent:407_03', false)
                MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_03_PcHouseTent:407_05', false)
                if event_flags_system['cLand:RcmImmQuestComplete']:
                    event_flags_system['cPlayer:ObjRcoMachineHeardFenceRecipe'] = true
                if event_flags_system['cLand:OpeningSeqBGMChangeCounter'] <= 8:
                    event_flags_system['cLand:OpeningSeqBGMChangeCounter'] = 8
            else:
                MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_03_PcHouseTent:403', false)
                EventFlowSystemActor.UISonkatsuPointDisappear()
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_03_PcHouseTent:401', false)
            EventFlowSystemActor.UISonkatsuPointDisappear()
    return

flow RcoTentAskDIYtrial:
    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_03_PcHouseTent:201', false)
    fEvent39 = EventFlowSystemActor.GeneralTalkChoice3()
    if fEvent39 == 0:
        MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_03_PcHouseTent:204', true)
        EventFlowSystemActor.FadeOut('cCircle', 'cCircle', 'cBlack', 1.0, 1.0, true)
        EventFlowSystemActor.WaitFrame(45)
        EventFlowSystemActor.FadeIn(true)
        MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_03_PcHouseTent:205', false)
        MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_03_PcHouseTent:206', false)
        event_flags_system['cPlayer:RcoHeardDetailDIYtrial'] = true
        event_flags_system['cPlayer:RcoDIYtrialOngoing'] = true
    elif fEvent39 == 1:
        MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_03_PcHouseTent:202', false)
    elif fEvent39 == 2:
        MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_03_PcHouseTent:203', false)
    return

flow RcoTentFishInsect:
    if event_flags_system['cPlayer:RcoTentDonation']:
        if event_flags_system['cPlayerTemp:RcoDonationNow']:
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_04_DonationReward:001_03', false)
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_04_DonationReward:001_02', false)
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_04_DonationReward:001_01', false)
    EventFlowSystemActor.UIItemSelectWindowHandling(65534, '', 'cItemSelect', 'RcoDonationForMuseum', 'cItemFilter', false)
    if EventFlowSystemActor.UIResultMenuDecide():
        MainNpc.SetDeliveryItem(4, false)
        EventFlowSystemActor.SetTagFromUIResult(0, 'cItemName')
        MainNpc.NpcDelivery('Keep', 0)
        if MainNpc.OwlIsDonation('cUISelect'):
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_04_DonationReward:003_01', false)
            MainNpc.NpcDelivery('Default', 10)
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_04_DonationReward:004', false)
            if event_flags_system['cPlayer:RcoTentDonation']:
                MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_04_DonationReward:005_03', false)
            else:
                if event_flags_system['cPlayer:RcoTentDonatinDeclined']:
                    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_04_DonationReward:005_02', false)
                else:
                    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_04_DonationReward:005_01', false)
            if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                MainNpc.OwlDonationDone('MultiComplete', 'CompleteRoomType')
                if EventFlowSystemActor.MuseumDonationNumCheck(5):
                    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_04_DonationReward:006_01', true)
                else:
                    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_04_DonationReward:006_01', false)
                MainNpc.NpcDelivery('Default', 3)
                event_flags_system['cPlayer:RcoTentDonation'] = true
                event_flags_system['cPlayerTemp:RcoDonationNow'] = true
                run SNPC_rco_51_DonationReward::Root
            else:
                MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_04_DonationReward:010', false)
                MainNpc.NpcDelivery('Default', 10)
                event_flags_system['cPlayer:RcoTentDonatinDeclined'] = true
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_04_DonationReward:002', false)
    return

flow RcoTentImmQuestIntroNotForce:
    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_05_MigrantsQuest:000_01', false)
    run Demo_Common_PhoneCall::CallIn
    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_05_MigrantsQuest:000_02', false)
entrypoint Event7:
    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_05_MigrantsQuest:001', true)
    run Demo_Common_PhoneCall::FinishCall
    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_05_MigrantsQuest:002', false)
    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_05_MigrantsQuest:003', false)
    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_05_MigrantsQuest:004', true)
    EventFlowSystemActor.WaitFrame(10)
    MainNpc.CharacterEmoticonAction('Sighing', '', 0, false, false)
    EventFlowSystemActor.WaitFrame(70)
    MainNpc.CharacterEmoticonAction('Shocked', '', 0, false, false)
    EventFlowSystemActor.WaitFrame(30)
    MainNpc.CharacterEmoticonAction('IdeaBulb', '', 0, false, false)
    EventFlowSystemActor.WaitFrame(30)
    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_05_MigrantsQuest:005', false)
    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_05_MigrantsQuest:006', false)
    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_05_MigrantsQuest:007', false)
    event_flags_system['cPlayer:ImmQRunningForPlayer'] = true
    event_flags_system['cLand:RcmImmQuestRunning'] = true
    event_flags_system['cPlayer:RcoImmQClear1QuestToday'] = true
    return

flow RcoTentImmQuestIntro_Force:
    run RcoTent_Force_PlayerPos
    event_flags_system['cPlayerTemp:RcoTalkSceneFlag'] = true
    run Event7
    return

flow RcoTentImmQuestIntro_Force_Init:
    run RcoTent_Force_DisableTalkCamera
    return

flow RcoTentWhatShoudIdo:
    run SNPC_rco_10_Common_WhatShouldIDo::Root
    return

flow RcoTent_Force_DisableTalkCamera:
    if EventFlowSystemActor.SystemCheckNowStage('cIdrTanukichi'):
        MainNpc.NpcAISetting(4, false)
    return

flow RcoTent_Force_PlayerPos:
    if EventFlowSystemActor.SystemCheckNowStage('cIdrTanukichi'):
        Player.PlayerMoveToTarget(157.0, 170.0, 0.0, 0.0, '', false, false)
        MainNpc.TalkCamera(true, 0)
    return


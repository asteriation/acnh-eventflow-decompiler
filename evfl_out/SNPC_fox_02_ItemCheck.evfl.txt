flow BuyArt:
    run SNPC_rcm::Check_ShopEnable
    if MainNpc.FoxIsSoldOut():
        if MainNpc.FoxCheckItemBuyPlayer():
            MainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox:120', false)
            run sub_grp!Event66
        else:
            EventFlowSystemActor.SetTagFromSystem(0, 'cFoxGalleryBuyPlayerName', 'cDegit', '', 0)
            EventFlowSystemActor.SetTagFromSystem(0, 'cFoxGalleryBuyPlayerLand', 'cDegit', '', 0)
            if MainNpc.FoxCheckItemBuyVillager():
                MainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox:121', false)
                run sub_grp!Event66
            else:
                MainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox:122', false)
                run sub_grp!Event66
    elif MainNpc.FoxBuyGalleryForThisIsland():
        MainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox:123', false)
        run sub_grp!Event66
    elif event_flags_system['cPlayer:FoxBuyArtTodayFlag']:
        MainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox:124', false)
        run sub_grp!Event66
    else:
        if MainNpc.FoxItemCheck():
            MainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox:105', false)
        else:
            MainNpc.FoxItemCheck()
            if subflow_results[0] not in (0, 2, 3):
                MainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox:106', false)
            elif event_flags_system['cPlayerTemp:FoxCheckArtCount'] >= 3:
                MainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox:104', false)
            else:
                if event_flags_system['cPlayerTemp:FoxCheckArtCount'] >= 2:
                    MainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox:103', false)
                else:
                    if event_flags_system['cPlayerTemp:FoxCheckArtCount'] >= 1:
                        MainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox:102', false)
                    else:
                        MainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox:101', false)
                event_flags_system['cPlayerTemp:FoxCheckArtCount'] += 1
        fEvent24 = EventFlowSystemActor.GeneralTalkChoice3()
        if fEvent24 == 0:
            run sub_grp!Event19
        elif fEvent24 == 1:
            run LookArtMode
            MainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox:107', false)
            if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                run sub_grp!Event19
            else:
                MainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox:108', false)
        elif fEvent24 == 2:
            MainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox:109', false)
    return

flow BuyFtr:
    run SNPC_rcm::Check_ShopEnable
    if MainNpc.FoxItemCheck():
        MainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox:133', false)
    else:
        MainNpc.FoxItemCheck()
        if subflow_results[0] not in (0, 2, 3):
            MainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox:134', false)
        elif EventFlowSystemActor.RandomChoiceExcludePrevious2(2, true) == 0:
            MainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox:131', false)
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox:132', false)
    if EventFlowSystemActor.GeneralTalkChoice2() != 0:
        MainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox:135', false)
    elif not MainNpc.ShopHasBellCount(1.0):
        MainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox:136', false)
    elif EventFlowSystemActor.ShoppingCapacity(65534, 'cShopping'):
        MainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox:138', false)
        MainNpc.ShopBuyDone(false, false)
        EventFlowSystemActor.WaitFrame(15)
        MainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox:139', false)
        run EndCommon
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox:137', false)
    return

flow EndCommon:
    event_flags_system['cPlayerTemp:FoxBuyNowFlag'] = true
    if EventFlowSystemActor.IsMyVillage():
        event_flags_system['cPlayer:FoxBuyTodayFlag'] = true
    else:
        event_flags_system['cPlayerVisit:DC_FoxBuyTodayFlag'] = true
    return

flow LookArtMode:
    EventFlowSystemActor.UIShopMoneyDisappear()
    EventFlowSystemActor.MessageSuspend()
    EventFlowSystemActor.RunCheckArtCamera()
    EventFlowSystemActor.HoldGalleryCamera()
    EventFlowSystemActor.UIMoneyAppear()
    return

flow sub_grp!Event19:
    if MainNpc.ShopHasBellCount(1.0):
        MainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox:111', true)
        MainNpc.ShopBuyDone(false, false)
        EventFlowSystemActor.WaitFrame(20)
        MainNpc.FoxSoldOutTagVisible()
        EventFlowSystemActor.WaitFrame(20)
        MainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox:112', false)
        MainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox:113', false)
        MainNpc.FoxSetBuyItem()
        event_flags_system['cLand:FoxArtStockCount'] += -1
        event_flags_system['cPlayer:FoxBuyArtTodayFlag'] = true
        event_flags_system['cLifeSupportAchievement:BuyatTsunekichiShop'] += 1
        run EndCommon
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox:110', false)

flow sub_grp!Event66:
    if EventFlowSystemActor.GeneralTalkChoice2() == 0:
        run LookArtMode
        MainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox:125', false)
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/fox/SP_fox:126', false)


flow ChkGetHousing:
    if not EventFlowSystemActor.NpcHouseNum('cExist') < 7:
        if event_flags_system['cLand:HaveHousingKitCount'] >= 4:
            subflow_results[0] = 1
        else:
            subflow_results[0] = 0
    elif not EventFlowSystemActor.NpcHouseNum('cExist') < 8:
        if event_flags_system['cLand:HaveHousingKitCount'] >= 3:
            subflow_results[0] = 1
        else:
            subflow_results[0] = 0
    elif not EventFlowSystemActor.NpcHouseNum('cExist') < 9:
        if event_flags_system['cLand:HaveHousingKitCount'] >= 2:
            subflow_results[0] = 1
        else:
            subflow_results[0] = 0
    elif EventFlowSystemActor.NpcHouseNum('cExist') < 10:
        subflow_results[0] = 1
    elif event_flags_system['cLand:HaveHousingKitCount'] >= 1:
        subflow_results[0] = 1
    else:
        subflow_results[0] = 0
    return

flow IslandDevelopmentIntro:
    event_flags_system['cPlayer:RcoTalkAboutOfficeWork'] = true
    if event_flags_system['cPlayerTemp:RcoOfficeFirstTalkNow']:
        MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_06_Office:011_02', false)
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_06_Office:011_01', false)
    if event_flags_system['cPlayer:MakeVillagePlayerFlag']:
        MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_06_Office:012_01', false)
        MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_06_Office:013_01', false)
        fEvent16 = EventFlowSystemActor.GeneralTalkChoice3()
        if fEvent16 == 0:
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_06_Office:014_01', false)
            run SNPC_rco_00_Common::Root
        elif fEvent16 == 1:
            run SNPC_rco_54_IslandDevelopment::Root
        elif fEvent16 == 2:
            run SNPC_rco_00_Common_Entries::Rco_CmnSel_Cancel
    elif event_flags_system['cPlayer:ThisPCcreatedbeforeOfficeUpgrading']:
        fEvent102 = EventFlowSystemActor.PlayerHouseLevel()
        if fEvent102 in (Homeless, PlacedTent):
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_06_Office:012_02_01', false)
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_06_Office:013_02', false)
            if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_06_Office:014_02', false)
                run SNPC_rco_00_Common::Root
            else:
                run SNPC_rco_00_Common_Entries::Rco_CmnSel_Cancel
        elif fEvent102 in (BaseHouse, HouseExpansion1, BackRoom, LeftRoom, RightRoom, SecondFloor, Basement):
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_06_Office:012_02', false)
            event_flags_system['cPlayer:RcoTalkAboutMoveMyHome'] = true
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_06_Office:013_02', false)
            if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_06_Office:014_02', false)
                run SNPC_rco_00_Common::Root
            else:
                run SNPC_rco_00_Common_Entries::Rco_CmnSel_Cancel
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_06_Office:012_03', false)
        MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_06_Office:013_02', false)
        if EventFlowSystemActor.GeneralTalkChoice2() == 0:
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_06_Office:014_02', false)
            run SNPC_rco_00_Common::Root
        else:
            run SNPC_rco_00_Common_Entries::Rco_CmnSel_Cancel
    return

flow OfficeOpening_Force:
    event_flags_system['cPlayer:OfficeSzaIntroduction'] = true
    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_00_Common:000', false)
    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_06_Office:001', false)
    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_06_Office:002', false)
    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_06_Office:003', false)
    SubNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_06_Office:004', false)
    if event_flags_system['cLand:BuiltTownOfficeToday']:
        SubNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_06_Office:005_01', false)
    else:
        if EventFlowSystemActor.FacilityOpenPastDays('cOffice', 7):
            SubNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_06_Office:005_02', false)
        else:
            SubNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_06_Office:005_03', false)
    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_06_Office:006', false)
    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_06_Office:007', false)
    if event_flags_system['cPlayer:MakeVillagePlayerFlag']:
        MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_06_Office:008_01', false)
entrypoint Event3:
    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_06_Office:009', false)
    event_flags_system['cPlayerTemp:RcoOfficeFirstTalkNow'] = true
    event_flags_system['cPlayer:RcoFirstTalkNewOffice'] = true
    if event_flags_system['cPlayer:MakeVillagePlayerFlag']:
        event_flags_system['cLand:IslandDevQuestRunning'] = true
    return

flow OfficeOpening_Force_Init:
    MainNpc.NpcAITalkSubCastEntry(1, 'sza')
    return

flow OfficeOpening_NormalTalk:
    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_00_Common:000', false)
    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_06_Office:001', false)
    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_06_Office:006_01', false)
    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_06_Office:007', false)
    if event_flags_system['cPlayer:MakeVillagePlayerFlag']:
        MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_06_Office:008_02', false)
        run Event3
    else:
        run Event3
    return

flow Rco_CmnSel_GetHousing:
    EventFlowSystemActor.SetTagFromSystem(0, 'cFlow', 'cMoney', '', 10000)
    if EventFlowSystemActor.HasTargetItem(3349, 1):
        MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_06_Office:208', false)
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_06_Office:201', false)
        if EventFlowSystemActor.GeneralTalkChoice2() != 0:
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_06_Office:202', false)
        elif not EventFlowSystemActor.HasBellCount(10000):
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_06_Office:203', false)
        elif EventFlowSystemActor.ShoppingCapacity(3349, 'cItemName'):
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_06_Office:205_01', false)
            EventFlowSystemActor.BellCountDown(-10000, False)
            EventFlowSystemActor.WaitFrame(30)
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_06_Office:205_02', false)
            EventFlowSystemActor.SetItemToPocket(3349, 1)
            event_flags_system['cLand:HaveHousingKitCount'] += 1
            run ChkGetHousing
            if subflow_results[0] == 0:
                MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_06_Office:206', false)
            else:
                MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_06_Office:207', false)
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_06_Office:204', false)
    return

flow Rco_Office_Infra:
    EventFlowSystemActor.UIMoneyAppear()
    if event_flags_system['cLand:RcoEnableBuyHousingKit']:
        run ChkGetHousing
        if subflow_results[0] == 0:
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_00_Common:075_01', false)
            fEvent44 = EventFlowSystemActor.GeneralTalkChoice4()
            if fEvent44 == 0:
                run Rco_CmnSel_GetHousing
            elif fEvent44 == 1:
                run SNPC_rco_10_Common_BuildBridgeSlope::Root
            elif fEvent44 == 2:
                run SNPC_rco_10_Common_MoveNpcFacility::Root
            elif fEvent44 == 3:
                run Rco_SelInfra_Cancel
            EventFlowSystemActor.UIMoneyDisappear()
            run SNPC_rco_00_Common::Rco_Office_CmnSelAgain
        else:
            MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_00_Common:075_02', false)
            fEvent41 = EventFlowSystemActor.GeneralTalkChoice3()
            if fEvent41 == 0:
                run SNPC_rco_10_Common_BuildBridgeSlope::Root
            elif fEvent41 == 1:
                run SNPC_rco_10_Common_MoveNpcFacility::Root
            elif fEvent41 == 2:
                run Rco_SelInfra_Cancel
            EventFlowSystemActor.UIMoneyDisappear()
            run SNPC_rco_00_Common::Rco_Office_CmnSelAgain
    else:
        MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_00_Common:075_02', false)
        fEvent41 = EventFlowSystemActor.GeneralTalkChoice3()
        if fEvent41 == 0:
            run SNPC_rco_10_Common_BuildBridgeSlope::Root
        elif fEvent41 == 1:
            run SNPC_rco_10_Common_MoveNpcFacility::Root
        elif fEvent41 == 2:
            run Rco_SelInfra_Cancel
        EventFlowSystemActor.UIMoneyDisappear()
        run SNPC_rco_00_Common::Rco_Office_CmnSelAgain
    return

flow Rco_SelInfra_Cancel:
    MainNpc.OpenMessageWindow('TalkSNpc/rco/SP_rco_06_Office:100', false)
    return


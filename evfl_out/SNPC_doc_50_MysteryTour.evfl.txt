flow CloseUI:
    fork:
        branch0:
        branch1:
            EventFlowSystemActor.UIMoneyDisappear()
        branch2:
            EventFlowSystemActor.UIShopBuyDisappear()
    return

flow DocCmnCancel:
    run sub_Event25
    return

flow ExchangeCancel:
    run Event18
    return

flow FaintEntry:
    MainNpc.OpenMessageWindow('TalkSNpc/doc/SP_doc_51_MysteryTour:021', false)
    event_flags_system['cPlayerTemp:DodTalkSceneFlag'] = true
    return

flow Root:
    event_flags_system['cPlayer:RcoMachineExplainAboutPlaneTicket'] = true
    if EventFlowSystemActor.SystemCheckNowStage('cCheckStageSymbol01'):
        run SNPC_doc_54_MayDayTour::Root
    elif event_flags_system['cPlayerTemp:DodTalkSceneFlag']:
        MainNpc.OpenMessageWindow('TalkSNpc/doc/SP_doc_51_MysteryTour:002', false)
        fEvent2 = EventFlowSystemActor.GeneralTalkChoice3()
        if fEvent2 == 0:
            MainNpc.OpenMessageWindow('TalkSNpc/doc/SP_doc_51_MysteryTour:003', false)
            if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                MainNpc.OpenMessageWindow('TalkSNpc/doc/SP_doc_51_MysteryTour:004', true)
                EventFlowSystemActor.BGMPropertyControl(76)
                EventFlowSystemActor.SoundTriggerEmit('Airplane_Takeoff_Short', -1)
                event_flags_system['cLandTemp:DocReturnFromIsland'] = true
                EventFlowSystemActor.SystemRequestChangeStage('cFromOutlierToHomeland', 'cCircle', 'cDALWithLoadWait', 'cBlack', 1.0, 1.0)
            else:
                run DocCmnCancel
        elif fEvent2 == 1:
            if EventFlowSystemActor.SystemHasBaggageSpace(1, 'cPocketBag'):
                EventFlowSystemActor.UISonkatsuPointAppear()
                MainNpc.OpenMessageWindow('TalkSNpc/doc/SP_doc_51_MysteryTour:011', false)
                EventFlowSystemActor.UIShopBuyAppear('cRodly')
                if EventFlowSystemActor.UIResultMenuDecide():
                    EventFlowSystemActor.SetTagFromUIResult(0, 'cItemName')
                    EventFlowSystemActor.SetTagFromSystem(0, 'cFlow', 'cDegit', '', 100)
                    if EventFlowSystemActor.HasLifeSupportPoint('Now', 100):
                        MainNpc.OpenMessageWindow('TalkSNpc/doc/SP_doc_51_MysteryTour:015', false)
                        if EventFlowSystemActor.GeneralTalkChoice2() == 0:
                            EventFlowSystemActor.LifeSupportPointCountDown(-100, false)
                            EventFlowSystemActor.UIShopBuyDisappear()
                            MainNpc.SetDeliveryItem(4, false)
                            MainNpc.OpenMessageWindow('TalkSNpc/doc/SP_doc_51_MysteryTour:016', false)
                            MainNpc.NpcDelivery('Default', 1)
                            EventFlowSystemActor.SetTagFromUIResult(0, 'cItemName')
                            MainNpc.ShopBuyDone(false, false)
                            MainNpc.OpenMessageWindow('TalkSNpc/doc/SP_doc_51_MysteryTour:017', false)
                            fork:
                                branch0:
                                branch1:
                                    EventFlowSystemActor.UISonkatsuPointDisappear()
                                branch2:
                                    EventFlowSystemActor.MessageSuspend()
                        else:
                            run ExchangeCancel
                    else:
                        MainNpc.OpenMessageWindow('TalkSNpc/doc/SP_doc_51_MysteryTour:014', false)
                        run CloseUI
                else:
entrypoint Event18:
                    run CloseUI
                    MainNpc.OpenMessageWindow('TalkSNpc/doc/SP_doc_51_MysteryTour:013', false)
            else:
                MainNpc.OpenMessageWindow('TalkSNpc/doc/SP_doc_51_MysteryTour:012', true)
        elif fEvent2 == 2:
            run sub_Event25
    else:
        event_flags_system['cPlayerTemp:DodTalkSceneFlag'] = true
        MainNpc.OpenMessageWindow('TalkSNpc/doc/SP_doc_51_MysteryTour:001_01', false)
        if not event_flags_system['cPlayer:DocMysterytourExplain1st']:
            MainNpc.OpenMessageWindow('TalkSNpc/doc/SP_doc_51_MysteryTour:001_02', false)
            event_flags_system['cPlayer:DocMysterytourExplain1st'] = true
        MainNpc.OpenMessageWindow('TalkSNpc/doc/SP_doc_51_MysteryTour:001_03', false)
    return

flow sub_Event25:
    MainNpc.OpenMessageWindow('TalkSNpc/doc/SP_doc_51_MysteryTour:008', false)
    return

